#!/bin/bash
# How to use: sudo bash DDL_command.sh
mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch32_w1.pbtxt 2> cifar10_densenet40_k12_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch32_w2.pbtxt 2> cifar10_densenet40_k12_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/cifar10_densenet40_k12_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/cifar10_densenet40_k12_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/cifar10_densenet40_k12_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/cifar10_densenet40_k12_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
mv cifar10_densenet40_k12_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
mv cifar10_densenet40_k12_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
mv cifar10_densenet40_k12_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
mv /benchmarks/cifar10_densenet40_k12_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
mv /benchmarks/cifar10_densenet40_k12_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
mv /benchmarks/cifar10_densenet40_k12_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch64_w1.pbtxt 2> cifar10_densenet40_k12_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch64_w2.pbtxt 2> cifar10_densenet40_k12_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/cifar10_densenet40_k12_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/cifar10_densenet40_k12_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/cifar10_densenet40_k12_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/cifar10_densenet40_k12_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
mv cifar10_densenet40_k12_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
mv cifar10_densenet40_k12_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
mv cifar10_densenet40_k12_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
mv /benchmarks/cifar10_densenet40_k12_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
mv /benchmarks/cifar10_densenet40_k12_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
mv /benchmarks/cifar10_densenet40_k12_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch128_w1.pbtxt 2> cifar10_densenet40_k12_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch128_w2.pbtxt 2> cifar10_densenet40_k12_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/cifar10_densenet40_k12_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/cifar10_densenet40_k12_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/cifar10_densenet40_k12_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/cifar10_densenet40_k12_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
mv cifar10_densenet40_k12_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
mv cifar10_densenet40_k12_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
mv cifar10_densenet40_k12_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
mv /benchmarks/cifar10_densenet40_k12_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
mv /benchmarks/cifar10_densenet40_k12_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
mv /benchmarks/cifar10_densenet40_k12_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch256_w1.pbtxt 2> cifar10_densenet40_k12_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch256_w2.pbtxt 2> cifar10_densenet40_k12_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/cifar10_densenet40_k12_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/cifar10_densenet40_k12_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/cifar10_densenet40_k12_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/cifar10_densenet40_k12_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
mv cifar10_densenet40_k12_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
mv cifar10_densenet40_k12_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
mv cifar10_densenet40_k12_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
mv /benchmarks/cifar10_densenet40_k12_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
mv /benchmarks/cifar10_densenet40_k12_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
mv /benchmarks/cifar10_densenet40_k12_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch512_w1.pbtxt 2> cifar10_densenet40_k12_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch512_w2.pbtxt 2> cifar10_densenet40_k12_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/cifar10_densenet40_k12_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/cifar10_densenet40_k12_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/cifar10_densenet40_k12_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/cifar10_densenet40_k12_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
mv cifar10_densenet40_k12_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
mv cifar10_densenet40_k12_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
mv cifar10_densenet40_k12_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
mv /benchmarks/cifar10_densenet40_k12_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
mv /benchmarks/cifar10_densenet40_k12_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
mv /benchmarks/cifar10_densenet40_k12_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_use_fp16_w1.pbtxt 2> cifar10_densenet40_k12_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_use_fp16_w2.pbtxt 2> cifar10_densenet40_k12_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/cifar10_densenet40_k12_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/cifar10_densenet40_k12_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/cifar10_densenet40_k12_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/cifar10_densenet40_k12_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
mv cifar10_densenet40_k12_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
mv cifar10_densenet40_k12_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
mv cifar10_densenet40_k12_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
mv /benchmarks/cifar10_densenet40_k12_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
mv /benchmarks/cifar10_densenet40_k12_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
mv /benchmarks/cifar10_densenet40_k12_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_optMomentum_w1.pbtxt 2> cifar10_densenet40_k12_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_optMomentum_w2.pbtxt 2> cifar10_densenet40_k12_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/cifar10_densenet40_k12_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/cifar10_densenet40_k12_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/cifar10_densenet40_k12_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/cifar10_densenet40_k12_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
mv cifar10_densenet40_k12_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
mv cifar10_densenet40_k12_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
mv cifar10_densenet40_k12_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
mv /benchmarks/cifar10_densenet40_k12_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
mv /benchmarks/cifar10_densenet40_k12_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
mv /benchmarks/cifar10_densenet40_k12_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w1.pbtxt 2> cifar10_densenet40_k12_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w2.pbtxt 2> cifar10_densenet40_k12_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/cifar10_densenet40_k12_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/cifar10_densenet40_k12_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/cifar10_densenet40_k12_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/cifar10_densenet40_k12_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
mv cifar10_densenet40_k12_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
mv cifar10_densenet40_k12_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
mv cifar10_densenet40_k12_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
mv /benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
mv /benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
mv /benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_dataFormat_w1.pbtxt 2> cifar10_densenet40_k12_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_dataFormat_w2.pbtxt 2> cifar10_densenet40_k12_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/cifar10_densenet40_k12_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/cifar10_densenet40_k12_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/cifar10_densenet40_k12_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/cifar10_densenet40_k12_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
mv cifar10_densenet40_k12_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
mv cifar10_densenet40_k12_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
mv cifar10_densenet40_k12_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
mv /benchmarks/cifar10_densenet40_k12_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
mv /benchmarks/cifar10_densenet40_k12_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
mv /benchmarks/cifar10_densenet40_k12_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_winograd_w1.pbtxt 2> cifar10_densenet40_k12_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_winograd_w2.pbtxt 2> cifar10_densenet40_k12_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/cifar10_densenet40_k12_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/cifar10_densenet40_k12_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/cifar10_densenet40_k12_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/cifar10_densenet40_k12_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
mv cifar10_densenet40_k12_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
mv cifar10_densenet40_k12_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
mv cifar10_densenet40_k12_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
mv /benchmarks/cifar10_densenet40_k12_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
mv /benchmarks/cifar10_densenet40_k12_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
mv /benchmarks/cifar10_densenet40_k12_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_xla_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_xla_w1.pbtxt 2> cifar10_densenet40_k12_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_xla_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_xla_w2.pbtxt 2> cifar10_densenet40_k12_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/cifar10_densenet40_k12_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/cifar10_densenet40_k12_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/cifar10_densenet40_k12_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/cifar10_densenet40_k12_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
mv cifar10_densenet40_k12_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
mv cifar10_densenet40_k12_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
mv cifar10_densenet40_k12_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
mv /benchmarks/cifar10_densenet40_k12_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
mv /benchmarks/cifar10_densenet40_k12_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
mv /benchmarks/cifar10_densenet40_k12_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch32_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch32_w1.pbtxt 2> cifar10_densenet40_k12_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch32_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch32_w2.pbtxt 2> cifar10_densenet40_k12_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/cifar10_densenet40_k12_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/cifar10_densenet40_k12_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/cifar10_densenet40_k12_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/cifar10_densenet40_k12_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
mv cifar10_densenet40_k12_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
mv cifar10_densenet40_k12_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
mv cifar10_densenet40_k12_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
mv /benchmarks/cifar10_densenet40_k12_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
mv /benchmarks/cifar10_densenet40_k12_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
mv /benchmarks/cifar10_densenet40_k12_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch64_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch64_w1.pbtxt 2> cifar10_densenet40_k12_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch64_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch64_w2.pbtxt 2> cifar10_densenet40_k12_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/cifar10_densenet40_k12_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/cifar10_densenet40_k12_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/cifar10_densenet40_k12_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/cifar10_densenet40_k12_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
mv cifar10_densenet40_k12_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
mv cifar10_densenet40_k12_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
mv cifar10_densenet40_k12_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
mv /benchmarks/cifar10_densenet40_k12_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
mv /benchmarks/cifar10_densenet40_k12_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
mv /benchmarks/cifar10_densenet40_k12_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch128_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch128_w1.pbtxt 2> cifar10_densenet40_k12_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch128_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch128_w2.pbtxt 2> cifar10_densenet40_k12_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/cifar10_densenet40_k12_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/cifar10_densenet40_k12_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/cifar10_densenet40_k12_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/cifar10_densenet40_k12_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
mv cifar10_densenet40_k12_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
mv cifar10_densenet40_k12_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
mv cifar10_densenet40_k12_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
mv /benchmarks/cifar10_densenet40_k12_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
mv /benchmarks/cifar10_densenet40_k12_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
mv /benchmarks/cifar10_densenet40_k12_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch256_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch256_w1.pbtxt 2> cifar10_densenet40_k12_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch256_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch256_w2.pbtxt 2> cifar10_densenet40_k12_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/cifar10_densenet40_k12_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/cifar10_densenet40_k12_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/cifar10_densenet40_k12_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/cifar10_densenet40_k12_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
mv cifar10_densenet40_k12_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
mv cifar10_densenet40_k12_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
mv cifar10_densenet40_k12_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
mv /benchmarks/cifar10_densenet40_k12_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
mv /benchmarks/cifar10_densenet40_k12_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
mv /benchmarks/cifar10_densenet40_k12_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch512_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch512_w1.pbtxt 2> cifar10_densenet40_k12_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch512_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch512_w2.pbtxt 2> cifar10_densenet40_k12_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/cifar10_densenet40_k12_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/cifar10_densenet40_k12_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/cifar10_densenet40_k12_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/cifar10_densenet40_k12_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
mv cifar10_densenet40_k12_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
mv cifar10_densenet40_k12_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
mv cifar10_densenet40_k12_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
mv /benchmarks/cifar10_densenet40_k12_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
mv /benchmarks/cifar10_densenet40_k12_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
mv /benchmarks/cifar10_densenet40_k12_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_use_fp16_w1.pbtxt 2> cifar10_densenet40_k12_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_use_fp16_w2.pbtxt 2> cifar10_densenet40_k12_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/cifar10_densenet40_k12_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/cifar10_densenet40_k12_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/cifar10_densenet40_k12_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/cifar10_densenet40_k12_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
mv cifar10_densenet40_k12_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
mv cifar10_densenet40_k12_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
mv cifar10_densenet40_k12_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
mv /benchmarks/cifar10_densenet40_k12_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
mv /benchmarks/cifar10_densenet40_k12_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
mv /benchmarks/cifar10_densenet40_k12_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_optMomentum_w1.pbtxt 2> cifar10_densenet40_k12_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_optMomentum_w2.pbtxt 2> cifar10_densenet40_k12_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/cifar10_densenet40_k12_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/cifar10_densenet40_k12_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/cifar10_densenet40_k12_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/cifar10_densenet40_k12_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
mv cifar10_densenet40_k12_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
mv cifar10_densenet40_k12_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
mv cifar10_densenet40_k12_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
mv /benchmarks/cifar10_densenet40_k12_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
mv /benchmarks/cifar10_densenet40_k12_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
mv /benchmarks/cifar10_densenet40_k12_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_optRmsprop_w1.pbtxt 2> cifar10_densenet40_k12_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_optRmsprop_w2.pbtxt 2> cifar10_densenet40_k12_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/cifar10_densenet40_k12_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/cifar10_densenet40_k12_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/cifar10_densenet40_k12_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/cifar10_densenet40_k12_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
mv cifar10_densenet40_k12_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
mv cifar10_densenet40_k12_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
mv cifar10_densenet40_k12_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
mv /benchmarks/cifar10_densenet40_k12_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
mv /benchmarks/cifar10_densenet40_k12_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
mv /benchmarks/cifar10_densenet40_k12_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_dataFormat_w1.pbtxt 2> cifar10_densenet40_k12_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_dataFormat_w2.pbtxt 2> cifar10_densenet40_k12_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/cifar10_densenet40_k12_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/cifar10_densenet40_k12_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/cifar10_densenet40_k12_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/cifar10_densenet40_k12_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
mv cifar10_densenet40_k12_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
mv cifar10_densenet40_k12_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
mv cifar10_densenet40_k12_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
mv /benchmarks/cifar10_densenet40_k12_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
mv /benchmarks/cifar10_densenet40_k12_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
mv /benchmarks/cifar10_densenet40_k12_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_winograd_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_winograd_w1.pbtxt 2> cifar10_densenet40_k12_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_winograd_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_winograd_w2.pbtxt 2> cifar10_densenet40_k12_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/cifar10_densenet40_k12_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/cifar10_densenet40_k12_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/cifar10_densenet40_k12_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/cifar10_densenet40_k12_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
mv cifar10_densenet40_k12_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
mv cifar10_densenet40_k12_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
mv cifar10_densenet40_k12_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
mv /benchmarks/cifar10_densenet40_k12_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
mv /benchmarks/cifar10_densenet40_k12_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
mv /benchmarks/cifar10_densenet40_k12_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_xla_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_xla_w1.pbtxt 2> cifar10_densenet40_k12_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_xla_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_xla_w2.pbtxt 2> cifar10_densenet40_k12_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/cifar10_densenet40_k12_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/cifar10_densenet40_k12_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/cifar10_densenet40_k12_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/cifar10_densenet40_k12_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
mv cifar10_densenet40_k12_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
mv cifar10_densenet40_k12_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
mv cifar10_densenet40_k12_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
mv /benchmarks/cifar10_densenet40_k12_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
mv /benchmarks/cifar10_densenet40_k12_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
mv /benchmarks/cifar10_densenet40_k12_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch32_w1.pbtxt 2> cifar10_densenet100_k12_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch32_w2.pbtxt 2> cifar10_densenet100_k12_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/cifar10_densenet100_k12_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/cifar10_densenet100_k12_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/cifar10_densenet100_k12_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/cifar10_densenet100_k12_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
mv cifar10_densenet100_k12_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
mv cifar10_densenet100_k12_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
mv cifar10_densenet100_k12_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
mv /benchmarks/cifar10_densenet100_k12_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
mv /benchmarks/cifar10_densenet100_k12_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
mv /benchmarks/cifar10_densenet100_k12_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch64_w1.pbtxt 2> cifar10_densenet100_k12_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch64_w2.pbtxt 2> cifar10_densenet100_k12_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/cifar10_densenet100_k12_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/cifar10_densenet100_k12_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/cifar10_densenet100_k12_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/cifar10_densenet100_k12_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
mv cifar10_densenet100_k12_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
mv cifar10_densenet100_k12_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
mv cifar10_densenet100_k12_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
mv /benchmarks/cifar10_densenet100_k12_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
mv /benchmarks/cifar10_densenet100_k12_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
mv /benchmarks/cifar10_densenet100_k12_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch128_w1.pbtxt 2> cifar10_densenet100_k12_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch128_w2.pbtxt 2> cifar10_densenet100_k12_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/cifar10_densenet100_k12_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/cifar10_densenet100_k12_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/cifar10_densenet100_k12_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/cifar10_densenet100_k12_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
mv cifar10_densenet100_k12_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
mv cifar10_densenet100_k12_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
mv cifar10_densenet100_k12_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
mv /benchmarks/cifar10_densenet100_k12_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
mv /benchmarks/cifar10_densenet100_k12_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
mv /benchmarks/cifar10_densenet100_k12_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch256_w1.pbtxt 2> cifar10_densenet100_k12_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch256_w2.pbtxt 2> cifar10_densenet100_k12_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/cifar10_densenet100_k12_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/cifar10_densenet100_k12_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/cifar10_densenet100_k12_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/cifar10_densenet100_k12_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
mv cifar10_densenet100_k12_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
mv cifar10_densenet100_k12_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
mv cifar10_densenet100_k12_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
mv /benchmarks/cifar10_densenet100_k12_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
mv /benchmarks/cifar10_densenet100_k12_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
mv /benchmarks/cifar10_densenet100_k12_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch512_w1.pbtxt 2> cifar10_densenet100_k12_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch512_w2.pbtxt 2> cifar10_densenet100_k12_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/cifar10_densenet100_k12_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/cifar10_densenet100_k12_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/cifar10_densenet100_k12_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/cifar10_densenet100_k12_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
mv cifar10_densenet100_k12_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
mv cifar10_densenet100_k12_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
mv cifar10_densenet100_k12_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
mv /benchmarks/cifar10_densenet100_k12_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
mv /benchmarks/cifar10_densenet100_k12_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
mv /benchmarks/cifar10_densenet100_k12_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_use_fp16_w1.pbtxt 2> cifar10_densenet100_k12_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_use_fp16_w2.pbtxt 2> cifar10_densenet100_k12_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/cifar10_densenet100_k12_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/cifar10_densenet100_k12_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/cifar10_densenet100_k12_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/cifar10_densenet100_k12_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
mv cifar10_densenet100_k12_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
mv cifar10_densenet100_k12_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
mv cifar10_densenet100_k12_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
mv /benchmarks/cifar10_densenet100_k12_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
mv /benchmarks/cifar10_densenet100_k12_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
mv /benchmarks/cifar10_densenet100_k12_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_optMomentum_w1.pbtxt 2> cifar10_densenet100_k12_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_optMomentum_w2.pbtxt 2> cifar10_densenet100_k12_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/cifar10_densenet100_k12_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/cifar10_densenet100_k12_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/cifar10_densenet100_k12_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/cifar10_densenet100_k12_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
mv cifar10_densenet100_k12_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
mv cifar10_densenet100_k12_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
mv cifar10_densenet100_k12_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
mv /benchmarks/cifar10_densenet100_k12_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
mv /benchmarks/cifar10_densenet100_k12_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
mv /benchmarks/cifar10_densenet100_k12_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w1.pbtxt 2> cifar10_densenet100_k12_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w2.pbtxt 2> cifar10_densenet100_k12_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/cifar10_densenet100_k12_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/cifar10_densenet100_k12_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/cifar10_densenet100_k12_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/cifar10_densenet100_k12_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
mv cifar10_densenet100_k12_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
mv cifar10_densenet100_k12_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
mv cifar10_densenet100_k12_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
mv /benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
mv /benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
mv /benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_dataFormat_w1.pbtxt 2> cifar10_densenet100_k12_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_dataFormat_w2.pbtxt 2> cifar10_densenet100_k12_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/cifar10_densenet100_k12_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/cifar10_densenet100_k12_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/cifar10_densenet100_k12_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/cifar10_densenet100_k12_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
mv cifar10_densenet100_k12_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
mv cifar10_densenet100_k12_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
mv cifar10_densenet100_k12_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
mv /benchmarks/cifar10_densenet100_k12_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
mv /benchmarks/cifar10_densenet100_k12_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
mv /benchmarks/cifar10_densenet100_k12_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_winograd_w1.pbtxt 2> cifar10_densenet100_k12_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_winograd_w2.pbtxt 2> cifar10_densenet100_k12_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/cifar10_densenet100_k12_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/cifar10_densenet100_k12_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/cifar10_densenet100_k12_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/cifar10_densenet100_k12_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
mv cifar10_densenet100_k12_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
mv cifar10_densenet100_k12_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
mv cifar10_densenet100_k12_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
mv /benchmarks/cifar10_densenet100_k12_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
mv /benchmarks/cifar10_densenet100_k12_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
mv /benchmarks/cifar10_densenet100_k12_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_xla_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_xla_w1.pbtxt 2> cifar10_densenet100_k12_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_xla_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_xla_w2.pbtxt 2> cifar10_densenet100_k12_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/cifar10_densenet100_k12_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/cifar10_densenet100_k12_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/cifar10_densenet100_k12_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/cifar10_densenet100_k12_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
mv cifar10_densenet100_k12_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
mv cifar10_densenet100_k12_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
mv cifar10_densenet100_k12_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
mv /benchmarks/cifar10_densenet100_k12_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
mv /benchmarks/cifar10_densenet100_k12_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
mv /benchmarks/cifar10_densenet100_k12_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch32_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch32_w1.pbtxt 2> cifar10_densenet100_k12_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch32_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch32_w2.pbtxt 2> cifar10_densenet100_k12_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/cifar10_densenet100_k12_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/cifar10_densenet100_k12_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/cifar10_densenet100_k12_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/cifar10_densenet100_k12_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
mv cifar10_densenet100_k12_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
mv cifar10_densenet100_k12_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
mv cifar10_densenet100_k12_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
mv /benchmarks/cifar10_densenet100_k12_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
mv /benchmarks/cifar10_densenet100_k12_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
mv /benchmarks/cifar10_densenet100_k12_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch64_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch64_w1.pbtxt 2> cifar10_densenet100_k12_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch64_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch64_w2.pbtxt 2> cifar10_densenet100_k12_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/cifar10_densenet100_k12_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/cifar10_densenet100_k12_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/cifar10_densenet100_k12_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/cifar10_densenet100_k12_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
mv cifar10_densenet100_k12_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
mv cifar10_densenet100_k12_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
mv cifar10_densenet100_k12_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
mv /benchmarks/cifar10_densenet100_k12_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
mv /benchmarks/cifar10_densenet100_k12_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
mv /benchmarks/cifar10_densenet100_k12_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch128_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch128_w1.pbtxt 2> cifar10_densenet100_k12_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch128_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch128_w2.pbtxt 2> cifar10_densenet100_k12_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/cifar10_densenet100_k12_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/cifar10_densenet100_k12_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/cifar10_densenet100_k12_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/cifar10_densenet100_k12_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
mv cifar10_densenet100_k12_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
mv cifar10_densenet100_k12_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
mv cifar10_densenet100_k12_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
mv /benchmarks/cifar10_densenet100_k12_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
mv /benchmarks/cifar10_densenet100_k12_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
mv /benchmarks/cifar10_densenet100_k12_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch256_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch256_w1.pbtxt 2> cifar10_densenet100_k12_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch256_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch256_w2.pbtxt 2> cifar10_densenet100_k12_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/cifar10_densenet100_k12_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/cifar10_densenet100_k12_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/cifar10_densenet100_k12_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/cifar10_densenet100_k12_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
mv cifar10_densenet100_k12_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
mv cifar10_densenet100_k12_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
mv cifar10_densenet100_k12_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
mv /benchmarks/cifar10_densenet100_k12_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
mv /benchmarks/cifar10_densenet100_k12_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
mv /benchmarks/cifar10_densenet100_k12_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch512_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch512_w1.pbtxt 2> cifar10_densenet100_k12_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch512_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch512_w2.pbtxt 2> cifar10_densenet100_k12_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/cifar10_densenet100_k12_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/cifar10_densenet100_k12_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/cifar10_densenet100_k12_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/cifar10_densenet100_k12_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
mv cifar10_densenet100_k12_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
mv cifar10_densenet100_k12_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
mv cifar10_densenet100_k12_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
mv /benchmarks/cifar10_densenet100_k12_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
mv /benchmarks/cifar10_densenet100_k12_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
mv /benchmarks/cifar10_densenet100_k12_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_use_fp16_w1.pbtxt 2> cifar10_densenet100_k12_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_use_fp16_w2.pbtxt 2> cifar10_densenet100_k12_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/cifar10_densenet100_k12_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/cifar10_densenet100_k12_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/cifar10_densenet100_k12_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/cifar10_densenet100_k12_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
mv cifar10_densenet100_k12_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
mv cifar10_densenet100_k12_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
mv cifar10_densenet100_k12_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
mv /benchmarks/cifar10_densenet100_k12_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
mv /benchmarks/cifar10_densenet100_k12_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
mv /benchmarks/cifar10_densenet100_k12_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_optMomentum_w1.pbtxt 2> cifar10_densenet100_k12_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_optMomentum_w2.pbtxt 2> cifar10_densenet100_k12_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/cifar10_densenet100_k12_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/cifar10_densenet100_k12_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/cifar10_densenet100_k12_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/cifar10_densenet100_k12_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
mv cifar10_densenet100_k12_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
mv cifar10_densenet100_k12_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
mv cifar10_densenet100_k12_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
mv /benchmarks/cifar10_densenet100_k12_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
mv /benchmarks/cifar10_densenet100_k12_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
mv /benchmarks/cifar10_densenet100_k12_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_optRmsprop_w1.pbtxt 2> cifar10_densenet100_k12_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_optRmsprop_w2.pbtxt 2> cifar10_densenet100_k12_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/cifar10_densenet100_k12_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/cifar10_densenet100_k12_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/cifar10_densenet100_k12_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/cifar10_densenet100_k12_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
mv cifar10_densenet100_k12_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
mv cifar10_densenet100_k12_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
mv cifar10_densenet100_k12_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
mv /benchmarks/cifar10_densenet100_k12_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
mv /benchmarks/cifar10_densenet100_k12_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
mv /benchmarks/cifar10_densenet100_k12_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_dataFormat_w1.pbtxt 2> cifar10_densenet100_k12_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_dataFormat_w2.pbtxt 2> cifar10_densenet100_k12_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/cifar10_densenet100_k12_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/cifar10_densenet100_k12_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/cifar10_densenet100_k12_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/cifar10_densenet100_k12_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
mv cifar10_densenet100_k12_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
mv cifar10_densenet100_k12_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
mv cifar10_densenet100_k12_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
mv /benchmarks/cifar10_densenet100_k12_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
mv /benchmarks/cifar10_densenet100_k12_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
mv /benchmarks/cifar10_densenet100_k12_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_winograd_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_winograd_w1.pbtxt 2> cifar10_densenet100_k12_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_winograd_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_winograd_w2.pbtxt 2> cifar10_densenet100_k12_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/cifar10_densenet100_k12_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/cifar10_densenet100_k12_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/cifar10_densenet100_k12_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/cifar10_densenet100_k12_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
mv cifar10_densenet100_k12_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
mv cifar10_densenet100_k12_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
mv cifar10_densenet100_k12_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
mv /benchmarks/cifar10_densenet100_k12_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
mv /benchmarks/cifar10_densenet100_k12_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
mv /benchmarks/cifar10_densenet100_k12_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_xla_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_xla_w1.pbtxt 2> cifar10_densenet100_k12_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_xla_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_xla_w2.pbtxt 2> cifar10_densenet100_k12_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/cifar10_densenet100_k12_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/cifar10_densenet100_k12_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/cifar10_densenet100_k12_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/cifar10_densenet100_k12_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
mv cifar10_densenet100_k12_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
mv cifar10_densenet100_k12_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
mv cifar10_densenet100_k12_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
mv /benchmarks/cifar10_densenet100_k12_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
mv /benchmarks/cifar10_densenet100_k12_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
mv /benchmarks/cifar10_densenet100_k12_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch32_w1.pbtxt 2> cifar10_densenet100_k24_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch32_w2.pbtxt 2> cifar10_densenet100_k24_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/cifar10_densenet100_k24_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/cifar10_densenet100_k24_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/cifar10_densenet100_k24_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/cifar10_densenet100_k24_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
mv cifar10_densenet100_k24_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
mv cifar10_densenet100_k24_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
mv cifar10_densenet100_k24_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
mv /benchmarks/cifar10_densenet100_k24_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
mv /benchmarks/cifar10_densenet100_k24_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
mv /benchmarks/cifar10_densenet100_k24_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch64_w1.pbtxt 2> cifar10_densenet100_k24_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch64_w2.pbtxt 2> cifar10_densenet100_k24_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/cifar10_densenet100_k24_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/cifar10_densenet100_k24_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/cifar10_densenet100_k24_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/cifar10_densenet100_k24_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
mv cifar10_densenet100_k24_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
mv cifar10_densenet100_k24_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
mv cifar10_densenet100_k24_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
mv /benchmarks/cifar10_densenet100_k24_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
mv /benchmarks/cifar10_densenet100_k24_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
mv /benchmarks/cifar10_densenet100_k24_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch128_w1.pbtxt 2> cifar10_densenet100_k24_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch128_w2.pbtxt 2> cifar10_densenet100_k24_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/cifar10_densenet100_k24_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/cifar10_densenet100_k24_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/cifar10_densenet100_k24_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/cifar10_densenet100_k24_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
mv cifar10_densenet100_k24_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
mv cifar10_densenet100_k24_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
mv cifar10_densenet100_k24_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
mv /benchmarks/cifar10_densenet100_k24_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
mv /benchmarks/cifar10_densenet100_k24_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
mv /benchmarks/cifar10_densenet100_k24_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch256_w1.pbtxt 2> cifar10_densenet100_k24_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch256_w2.pbtxt 2> cifar10_densenet100_k24_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/cifar10_densenet100_k24_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/cifar10_densenet100_k24_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/cifar10_densenet100_k24_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/cifar10_densenet100_k24_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
mv cifar10_densenet100_k24_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
mv cifar10_densenet100_k24_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
mv cifar10_densenet100_k24_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
mv /benchmarks/cifar10_densenet100_k24_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
mv /benchmarks/cifar10_densenet100_k24_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
mv /benchmarks/cifar10_densenet100_k24_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch512_w1.pbtxt 2> cifar10_densenet100_k24_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch512_w2.pbtxt 2> cifar10_densenet100_k24_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/cifar10_densenet100_k24_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/cifar10_densenet100_k24_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/cifar10_densenet100_k24_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/cifar10_densenet100_k24_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
mv cifar10_densenet100_k24_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
mv cifar10_densenet100_k24_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
mv cifar10_densenet100_k24_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
mv /benchmarks/cifar10_densenet100_k24_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
mv /benchmarks/cifar10_densenet100_k24_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
mv /benchmarks/cifar10_densenet100_k24_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_use_fp16_w1.pbtxt 2> cifar10_densenet100_k24_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_use_fp16_w2.pbtxt 2> cifar10_densenet100_k24_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/cifar10_densenet100_k24_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/cifar10_densenet100_k24_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/cifar10_densenet100_k24_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/cifar10_densenet100_k24_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
mv cifar10_densenet100_k24_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
mv cifar10_densenet100_k24_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
mv cifar10_densenet100_k24_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
mv /benchmarks/cifar10_densenet100_k24_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
mv /benchmarks/cifar10_densenet100_k24_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
mv /benchmarks/cifar10_densenet100_k24_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_optMomentum_w1.pbtxt 2> cifar10_densenet100_k24_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_optMomentum_w2.pbtxt 2> cifar10_densenet100_k24_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/cifar10_densenet100_k24_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/cifar10_densenet100_k24_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/cifar10_densenet100_k24_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/cifar10_densenet100_k24_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
mv cifar10_densenet100_k24_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
mv cifar10_densenet100_k24_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
mv cifar10_densenet100_k24_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
mv /benchmarks/cifar10_densenet100_k24_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
mv /benchmarks/cifar10_densenet100_k24_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
mv /benchmarks/cifar10_densenet100_k24_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w1.pbtxt 2> cifar10_densenet100_k24_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w2.pbtxt 2> cifar10_densenet100_k24_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/cifar10_densenet100_k24_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/cifar10_densenet100_k24_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/cifar10_densenet100_k24_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/cifar10_densenet100_k24_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
mv cifar10_densenet100_k24_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
mv cifar10_densenet100_k24_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
mv cifar10_densenet100_k24_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
mv /benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
mv /benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
mv /benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_dataFormat_w1.pbtxt 2> cifar10_densenet100_k24_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_dataFormat_w2.pbtxt 2> cifar10_densenet100_k24_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/cifar10_densenet100_k24_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/cifar10_densenet100_k24_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/cifar10_densenet100_k24_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/cifar10_densenet100_k24_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
mv cifar10_densenet100_k24_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
mv cifar10_densenet100_k24_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
mv cifar10_densenet100_k24_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
mv /benchmarks/cifar10_densenet100_k24_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
mv /benchmarks/cifar10_densenet100_k24_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
mv /benchmarks/cifar10_densenet100_k24_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_winograd_w1.pbtxt 2> cifar10_densenet100_k24_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_winograd_w2.pbtxt 2> cifar10_densenet100_k24_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/cifar10_densenet100_k24_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/cifar10_densenet100_k24_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/cifar10_densenet100_k24_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/cifar10_densenet100_k24_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
mv cifar10_densenet100_k24_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
mv cifar10_densenet100_k24_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
mv cifar10_densenet100_k24_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
mv /benchmarks/cifar10_densenet100_k24_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
mv /benchmarks/cifar10_densenet100_k24_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
mv /benchmarks/cifar10_densenet100_k24_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_xla_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_xla_w1.pbtxt 2> cifar10_densenet100_k24_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_xla_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_xla_w2.pbtxt 2> cifar10_densenet100_k24_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/cifar10_densenet100_k24_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/cifar10_densenet100_k24_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/cifar10_densenet100_k24_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/cifar10_densenet100_k24_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
mv cifar10_densenet100_k24_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
mv cifar10_densenet100_k24_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
mv cifar10_densenet100_k24_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
mv /benchmarks/cifar10_densenet100_k24_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
mv /benchmarks/cifar10_densenet100_k24_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
mv /benchmarks/cifar10_densenet100_k24_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch32_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch32_w1.pbtxt 2> cifar10_densenet100_k24_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch32_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch32_w2.pbtxt 2> cifar10_densenet100_k24_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/cifar10_densenet100_k24_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/cifar10_densenet100_k24_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/cifar10_densenet100_k24_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/cifar10_densenet100_k24_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
mv cifar10_densenet100_k24_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
mv cifar10_densenet100_k24_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
mv cifar10_densenet100_k24_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
mv /benchmarks/cifar10_densenet100_k24_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
mv /benchmarks/cifar10_densenet100_k24_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
mv /benchmarks/cifar10_densenet100_k24_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch64_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch64_w1.pbtxt 2> cifar10_densenet100_k24_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch64_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch64_w2.pbtxt 2> cifar10_densenet100_k24_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/cifar10_densenet100_k24_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/cifar10_densenet100_k24_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/cifar10_densenet100_k24_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/cifar10_densenet100_k24_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
mv cifar10_densenet100_k24_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
mv cifar10_densenet100_k24_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
mv cifar10_densenet100_k24_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
mv /benchmarks/cifar10_densenet100_k24_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
mv /benchmarks/cifar10_densenet100_k24_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
mv /benchmarks/cifar10_densenet100_k24_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch128_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch128_w1.pbtxt 2> cifar10_densenet100_k24_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch128_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch128_w2.pbtxt 2> cifar10_densenet100_k24_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/cifar10_densenet100_k24_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/cifar10_densenet100_k24_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/cifar10_densenet100_k24_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/cifar10_densenet100_k24_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
mv cifar10_densenet100_k24_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
mv cifar10_densenet100_k24_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
mv cifar10_densenet100_k24_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
mv /benchmarks/cifar10_densenet100_k24_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
mv /benchmarks/cifar10_densenet100_k24_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
mv /benchmarks/cifar10_densenet100_k24_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch256_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch256_w1.pbtxt 2> cifar10_densenet100_k24_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch256_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch256_w2.pbtxt 2> cifar10_densenet100_k24_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/cifar10_densenet100_k24_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/cifar10_densenet100_k24_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/cifar10_densenet100_k24_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/cifar10_densenet100_k24_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
mv cifar10_densenet100_k24_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
mv cifar10_densenet100_k24_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
mv cifar10_densenet100_k24_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
mv /benchmarks/cifar10_densenet100_k24_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
mv /benchmarks/cifar10_densenet100_k24_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
mv /benchmarks/cifar10_densenet100_k24_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch512_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch512_w1.pbtxt 2> cifar10_densenet100_k24_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch512_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch512_w2.pbtxt 2> cifar10_densenet100_k24_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/cifar10_densenet100_k24_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/cifar10_densenet100_k24_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/cifar10_densenet100_k24_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/cifar10_densenet100_k24_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
mv cifar10_densenet100_k24_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
mv cifar10_densenet100_k24_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
mv cifar10_densenet100_k24_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
mv /benchmarks/cifar10_densenet100_k24_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
mv /benchmarks/cifar10_densenet100_k24_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
mv /benchmarks/cifar10_densenet100_k24_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_use_fp16_w1.pbtxt 2> cifar10_densenet100_k24_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_use_fp16_w2.pbtxt 2> cifar10_densenet100_k24_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/cifar10_densenet100_k24_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/cifar10_densenet100_k24_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/cifar10_densenet100_k24_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/cifar10_densenet100_k24_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
mv cifar10_densenet100_k24_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
mv cifar10_densenet100_k24_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
mv cifar10_densenet100_k24_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
mv /benchmarks/cifar10_densenet100_k24_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
mv /benchmarks/cifar10_densenet100_k24_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
mv /benchmarks/cifar10_densenet100_k24_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_optMomentum_w1.pbtxt 2> cifar10_densenet100_k24_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_optMomentum_w2.pbtxt 2> cifar10_densenet100_k24_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/cifar10_densenet100_k24_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/cifar10_densenet100_k24_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/cifar10_densenet100_k24_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/cifar10_densenet100_k24_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
mv cifar10_densenet100_k24_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
mv cifar10_densenet100_k24_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
mv cifar10_densenet100_k24_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
mv /benchmarks/cifar10_densenet100_k24_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
mv /benchmarks/cifar10_densenet100_k24_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
mv /benchmarks/cifar10_densenet100_k24_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_optRmsprop_w1.pbtxt 2> cifar10_densenet100_k24_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_optRmsprop_w2.pbtxt 2> cifar10_densenet100_k24_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/cifar10_densenet100_k24_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/cifar10_densenet100_k24_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/cifar10_densenet100_k24_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/cifar10_densenet100_k24_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
mv cifar10_densenet100_k24_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
mv cifar10_densenet100_k24_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
mv cifar10_densenet100_k24_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
mv /benchmarks/cifar10_densenet100_k24_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
mv /benchmarks/cifar10_densenet100_k24_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
mv /benchmarks/cifar10_densenet100_k24_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_dataFormat_w1.pbtxt 2> cifar10_densenet100_k24_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_dataFormat_w2.pbtxt 2> cifar10_densenet100_k24_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/cifar10_densenet100_k24_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/cifar10_densenet100_k24_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/cifar10_densenet100_k24_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/cifar10_densenet100_k24_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
mv cifar10_densenet100_k24_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
mv cifar10_densenet100_k24_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
mv cifar10_densenet100_k24_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
mv /benchmarks/cifar10_densenet100_k24_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
mv /benchmarks/cifar10_densenet100_k24_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
mv /benchmarks/cifar10_densenet100_k24_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_winograd_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_winograd_w1.pbtxt 2> cifar10_densenet100_k24_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_winograd_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_winograd_w2.pbtxt 2> cifar10_densenet100_k24_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/cifar10_densenet100_k24_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/cifar10_densenet100_k24_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/cifar10_densenet100_k24_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/cifar10_densenet100_k24_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
mv cifar10_densenet100_k24_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
mv cifar10_densenet100_k24_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
mv cifar10_densenet100_k24_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
mv /benchmarks/cifar10_densenet100_k24_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
mv /benchmarks/cifar10_densenet100_k24_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
mv /benchmarks/cifar10_densenet100_k24_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_xla_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_xla_w1.pbtxt 2> cifar10_densenet100_k24_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_xla_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_xla_w2.pbtxt 2> cifar10_densenet100_k24_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/cifar10_densenet100_k24_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/cifar10_densenet100_k24_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/cifar10_densenet100_k24_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/cifar10_densenet100_k24_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
mv cifar10_densenet100_k24_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
mv cifar10_densenet100_k24_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
mv cifar10_densenet100_k24_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
mv /benchmarks/cifar10_densenet100_k24_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
mv /benchmarks/cifar10_densenet100_k24_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
mv /benchmarks/cifar10_densenet100_k24_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch32_w1.pbtxt 2> cifar10_resnet20_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch32_w2.pbtxt 2> cifar10_resnet20_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/cifar10_resnet20_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/cifar10_resnet20_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/cifar10_resnet20_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/cifar10_resnet20_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
mv cifar10_resnet20_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
mv cifar10_resnet20_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
mv cifar10_resnet20_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
mv /benchmarks/cifar10_resnet20_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
mv /benchmarks/cifar10_resnet20_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
mv /benchmarks/cifar10_resnet20_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch64_w1.pbtxt 2> cifar10_resnet20_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch64_w2.pbtxt 2> cifar10_resnet20_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/cifar10_resnet20_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/cifar10_resnet20_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/cifar10_resnet20_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/cifar10_resnet20_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
mv cifar10_resnet20_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
mv cifar10_resnet20_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
mv cifar10_resnet20_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
mv /benchmarks/cifar10_resnet20_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
mv /benchmarks/cifar10_resnet20_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
mv /benchmarks/cifar10_resnet20_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch128_w1.pbtxt 2> cifar10_resnet20_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch128_w2.pbtxt 2> cifar10_resnet20_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/cifar10_resnet20_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/cifar10_resnet20_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/cifar10_resnet20_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/cifar10_resnet20_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
mv cifar10_resnet20_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
mv cifar10_resnet20_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
mv cifar10_resnet20_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
mv /benchmarks/cifar10_resnet20_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
mv /benchmarks/cifar10_resnet20_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
mv /benchmarks/cifar10_resnet20_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch256_w1.pbtxt 2> cifar10_resnet20_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch256_w2.pbtxt 2> cifar10_resnet20_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/cifar10_resnet20_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/cifar10_resnet20_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/cifar10_resnet20_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/cifar10_resnet20_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
mv cifar10_resnet20_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
mv cifar10_resnet20_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
mv cifar10_resnet20_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
mv /benchmarks/cifar10_resnet20_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
mv /benchmarks/cifar10_resnet20_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
mv /benchmarks/cifar10_resnet20_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch512_w1.pbtxt 2> cifar10_resnet20_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch512_w2.pbtxt 2> cifar10_resnet20_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/cifar10_resnet20_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/cifar10_resnet20_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/cifar10_resnet20_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/cifar10_resnet20_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
mv cifar10_resnet20_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
mv cifar10_resnet20_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
mv cifar10_resnet20_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
mv /benchmarks/cifar10_resnet20_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
mv /benchmarks/cifar10_resnet20_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
mv /benchmarks/cifar10_resnet20_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_use_fp16_w1.pbtxt 2> cifar10_resnet20_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_use_fp16_w2.pbtxt 2> cifar10_resnet20_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/cifar10_resnet20_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/cifar10_resnet20_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/cifar10_resnet20_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/cifar10_resnet20_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
mv cifar10_resnet20_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
mv cifar10_resnet20_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
mv cifar10_resnet20_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
mv /benchmarks/cifar10_resnet20_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
mv /benchmarks/cifar10_resnet20_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
mv /benchmarks/cifar10_resnet20_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_optMomentum_w1.pbtxt 2> cifar10_resnet20_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_optMomentum_w2.pbtxt 2> cifar10_resnet20_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/cifar10_resnet20_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/cifar10_resnet20_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/cifar10_resnet20_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/cifar10_resnet20_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
mv cifar10_resnet20_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
mv cifar10_resnet20_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
mv cifar10_resnet20_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
mv /benchmarks/cifar10_resnet20_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
mv /benchmarks/cifar10_resnet20_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
mv /benchmarks/cifar10_resnet20_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet20_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet20_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/cifar10_resnet20_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/cifar10_resnet20_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/cifar10_resnet20_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/cifar10_resnet20_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
mv cifar10_resnet20_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
mv cifar10_resnet20_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
mv cifar10_resnet20_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
mv /benchmarks/cifar10_resnet20_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
mv /benchmarks/cifar10_resnet20_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
mv /benchmarks/cifar10_resnet20_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_dataFormat_w1.pbtxt 2> cifar10_resnet20_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_dataFormat_w2.pbtxt 2> cifar10_resnet20_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/cifar10_resnet20_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/cifar10_resnet20_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/cifar10_resnet20_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/cifar10_resnet20_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
mv cifar10_resnet20_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
mv cifar10_resnet20_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
mv cifar10_resnet20_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
mv /benchmarks/cifar10_resnet20_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
mv /benchmarks/cifar10_resnet20_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
mv /benchmarks/cifar10_resnet20_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_winograd_w1.pbtxt 2> cifar10_resnet20_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_winograd_w2.pbtxt 2> cifar10_resnet20_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/cifar10_resnet20_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/cifar10_resnet20_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/cifar10_resnet20_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/cifar10_resnet20_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
mv cifar10_resnet20_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
mv cifar10_resnet20_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
mv cifar10_resnet20_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
mv /benchmarks/cifar10_resnet20_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
mv /benchmarks/cifar10_resnet20_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
mv /benchmarks/cifar10_resnet20_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_xla_w1.pbtxt 2> cifar10_resnet20_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_xla_w2.pbtxt 2> cifar10_resnet20_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/cifar10_resnet20_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/cifar10_resnet20_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/cifar10_resnet20_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/cifar10_resnet20_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
mv cifar10_resnet20_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
mv cifar10_resnet20_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
mv cifar10_resnet20_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
mv /benchmarks/cifar10_resnet20_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
mv /benchmarks/cifar10_resnet20_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
mv /benchmarks/cifar10_resnet20_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_batch32_w1.pbtxt 2> cifar10_resnet20_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_batch32_w2.pbtxt 2> cifar10_resnet20_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/cifar10_resnet20_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/cifar10_resnet20_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/cifar10_resnet20_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/cifar10_resnet20_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
mv cifar10_resnet20_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
mv cifar10_resnet20_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
mv cifar10_resnet20_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
mv /benchmarks/cifar10_resnet20_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
mv /benchmarks/cifar10_resnet20_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
mv /benchmarks/cifar10_resnet20_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_batch64_w1.pbtxt 2> cifar10_resnet20_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_batch64_w2.pbtxt 2> cifar10_resnet20_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/cifar10_resnet20_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/cifar10_resnet20_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/cifar10_resnet20_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/cifar10_resnet20_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
mv cifar10_resnet20_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
mv cifar10_resnet20_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
mv cifar10_resnet20_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
mv /benchmarks/cifar10_resnet20_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
mv /benchmarks/cifar10_resnet20_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
mv /benchmarks/cifar10_resnet20_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_batch128_w1.pbtxt 2> cifar10_resnet20_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_batch128_w2.pbtxt 2> cifar10_resnet20_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/cifar10_resnet20_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/cifar10_resnet20_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/cifar10_resnet20_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/cifar10_resnet20_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
mv cifar10_resnet20_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
mv cifar10_resnet20_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
mv cifar10_resnet20_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
mv /benchmarks/cifar10_resnet20_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
mv /benchmarks/cifar10_resnet20_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
mv /benchmarks/cifar10_resnet20_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_batch256_w1.pbtxt 2> cifar10_resnet20_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_batch256_w2.pbtxt 2> cifar10_resnet20_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/cifar10_resnet20_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/cifar10_resnet20_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/cifar10_resnet20_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/cifar10_resnet20_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
mv cifar10_resnet20_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
mv cifar10_resnet20_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
mv cifar10_resnet20_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
mv /benchmarks/cifar10_resnet20_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
mv /benchmarks/cifar10_resnet20_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
mv /benchmarks/cifar10_resnet20_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_batch512_w1.pbtxt 2> cifar10_resnet20_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_batch512_w2.pbtxt 2> cifar10_resnet20_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/cifar10_resnet20_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/cifar10_resnet20_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/cifar10_resnet20_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/cifar10_resnet20_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
mv cifar10_resnet20_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
mv cifar10_resnet20_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
mv cifar10_resnet20_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
mv /benchmarks/cifar10_resnet20_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
mv /benchmarks/cifar10_resnet20_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
mv /benchmarks/cifar10_resnet20_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_use_fp16_w1.pbtxt 2> cifar10_resnet20_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_use_fp16_w2.pbtxt 2> cifar10_resnet20_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/cifar10_resnet20_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/cifar10_resnet20_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/cifar10_resnet20_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/cifar10_resnet20_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
mv cifar10_resnet20_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
mv cifar10_resnet20_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
mv cifar10_resnet20_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
mv /benchmarks/cifar10_resnet20_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
mv /benchmarks/cifar10_resnet20_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
mv /benchmarks/cifar10_resnet20_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_optMomentum_w1.pbtxt 2> cifar10_resnet20_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_optMomentum_w2.pbtxt 2> cifar10_resnet20_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/cifar10_resnet20_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/cifar10_resnet20_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/cifar10_resnet20_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/cifar10_resnet20_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
mv cifar10_resnet20_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
mv cifar10_resnet20_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
mv cifar10_resnet20_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
mv /benchmarks/cifar10_resnet20_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
mv /benchmarks/cifar10_resnet20_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
mv /benchmarks/cifar10_resnet20_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_optRmsprop_w1.pbtxt 2> cifar10_resnet20_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_optRmsprop_w2.pbtxt 2> cifar10_resnet20_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/cifar10_resnet20_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/cifar10_resnet20_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/cifar10_resnet20_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/cifar10_resnet20_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
mv cifar10_resnet20_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
mv cifar10_resnet20_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
mv cifar10_resnet20_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
mv /benchmarks/cifar10_resnet20_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
mv /benchmarks/cifar10_resnet20_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
mv /benchmarks/cifar10_resnet20_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_dataFormat_w1.pbtxt 2> cifar10_resnet20_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_dataFormat_w2.pbtxt 2> cifar10_resnet20_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/cifar10_resnet20_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/cifar10_resnet20_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/cifar10_resnet20_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/cifar10_resnet20_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
mv cifar10_resnet20_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
mv cifar10_resnet20_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
mv cifar10_resnet20_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
mv /benchmarks/cifar10_resnet20_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
mv /benchmarks/cifar10_resnet20_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
mv /benchmarks/cifar10_resnet20_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_winograd_w1.pbtxt 2> cifar10_resnet20_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_winograd_w2.pbtxt 2> cifar10_resnet20_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/cifar10_resnet20_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/cifar10_resnet20_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/cifar10_resnet20_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/cifar10_resnet20_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
mv cifar10_resnet20_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
mv cifar10_resnet20_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
mv cifar10_resnet20_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
mv /benchmarks/cifar10_resnet20_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
mv /benchmarks/cifar10_resnet20_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
mv /benchmarks/cifar10_resnet20_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_xla_w1.pbtxt 2> cifar10_resnet20_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_xla_w2.pbtxt 2> cifar10_resnet20_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/cifar10_resnet20_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/cifar10_resnet20_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/cifar10_resnet20_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/cifar10_resnet20_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
mv cifar10_resnet20_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
mv cifar10_resnet20_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
mv cifar10_resnet20_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
mv /benchmarks/cifar10_resnet20_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
mv /benchmarks/cifar10_resnet20_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
mv /benchmarks/cifar10_resnet20_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch32_w1.pbtxt 2> cifar10_resnet20_v2_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch32_w2.pbtxt 2> cifar10_resnet20_v2_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/cifar10_resnet20_v2_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/cifar10_resnet20_v2_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/cifar10_resnet20_v2_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/cifar10_resnet20_v2_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
mv cifar10_resnet20_v2_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
mv cifar10_resnet20_v2_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
mv cifar10_resnet20_v2_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
mv /benchmarks/cifar10_resnet20_v2_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
mv /benchmarks/cifar10_resnet20_v2_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
mv /benchmarks/cifar10_resnet20_v2_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch64_w1.pbtxt 2> cifar10_resnet20_v2_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch64_w2.pbtxt 2> cifar10_resnet20_v2_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/cifar10_resnet20_v2_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/cifar10_resnet20_v2_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/cifar10_resnet20_v2_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/cifar10_resnet20_v2_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
mv cifar10_resnet20_v2_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
mv cifar10_resnet20_v2_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
mv cifar10_resnet20_v2_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
mv /benchmarks/cifar10_resnet20_v2_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
mv /benchmarks/cifar10_resnet20_v2_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
mv /benchmarks/cifar10_resnet20_v2_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch128_w1.pbtxt 2> cifar10_resnet20_v2_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch128_w2.pbtxt 2> cifar10_resnet20_v2_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/cifar10_resnet20_v2_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/cifar10_resnet20_v2_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/cifar10_resnet20_v2_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/cifar10_resnet20_v2_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
mv cifar10_resnet20_v2_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
mv cifar10_resnet20_v2_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
mv cifar10_resnet20_v2_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
mv /benchmarks/cifar10_resnet20_v2_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
mv /benchmarks/cifar10_resnet20_v2_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
mv /benchmarks/cifar10_resnet20_v2_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch256_w1.pbtxt 2> cifar10_resnet20_v2_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch256_w2.pbtxt 2> cifar10_resnet20_v2_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/cifar10_resnet20_v2_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/cifar10_resnet20_v2_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/cifar10_resnet20_v2_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/cifar10_resnet20_v2_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
mv cifar10_resnet20_v2_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
mv cifar10_resnet20_v2_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
mv cifar10_resnet20_v2_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
mv /benchmarks/cifar10_resnet20_v2_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
mv /benchmarks/cifar10_resnet20_v2_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
mv /benchmarks/cifar10_resnet20_v2_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch512_w1.pbtxt 2> cifar10_resnet20_v2_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch512_w2.pbtxt 2> cifar10_resnet20_v2_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/cifar10_resnet20_v2_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/cifar10_resnet20_v2_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/cifar10_resnet20_v2_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/cifar10_resnet20_v2_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
mv cifar10_resnet20_v2_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
mv cifar10_resnet20_v2_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
mv cifar10_resnet20_v2_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
mv /benchmarks/cifar10_resnet20_v2_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
mv /benchmarks/cifar10_resnet20_v2_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
mv /benchmarks/cifar10_resnet20_v2_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_use_fp16_w1.pbtxt 2> cifar10_resnet20_v2_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_use_fp16_w2.pbtxt 2> cifar10_resnet20_v2_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/cifar10_resnet20_v2_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/cifar10_resnet20_v2_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/cifar10_resnet20_v2_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/cifar10_resnet20_v2_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
mv cifar10_resnet20_v2_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
mv cifar10_resnet20_v2_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
mv cifar10_resnet20_v2_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet20_v2_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet20_v2_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet20_v2_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_optMomentum_w1.pbtxt 2> cifar10_resnet20_v2_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_optMomentum_w2.pbtxt 2> cifar10_resnet20_v2_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/cifar10_resnet20_v2_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/cifar10_resnet20_v2_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/cifar10_resnet20_v2_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/cifar10_resnet20_v2_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
mv cifar10_resnet20_v2_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
mv cifar10_resnet20_v2_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
mv cifar10_resnet20_v2_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet20_v2_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet20_v2_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet20_v2_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet20_v2_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet20_v2_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/cifar10_resnet20_v2_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/cifar10_resnet20_v2_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/cifar10_resnet20_v2_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/cifar10_resnet20_v2_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
mv cifar10_resnet20_v2_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
mv cifar10_resnet20_v2_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
mv cifar10_resnet20_v2_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_dataFormat_w1.pbtxt 2> cifar10_resnet20_v2_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_dataFormat_w2.pbtxt 2> cifar10_resnet20_v2_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/cifar10_resnet20_v2_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/cifar10_resnet20_v2_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/cifar10_resnet20_v2_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/cifar10_resnet20_v2_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
mv cifar10_resnet20_v2_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
mv cifar10_resnet20_v2_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
mv cifar10_resnet20_v2_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet20_v2_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet20_v2_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet20_v2_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_winograd_w1.pbtxt 2> cifar10_resnet20_v2_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_winograd_w2.pbtxt 2> cifar10_resnet20_v2_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/cifar10_resnet20_v2_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/cifar10_resnet20_v2_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/cifar10_resnet20_v2_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/cifar10_resnet20_v2_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
mv cifar10_resnet20_v2_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
mv cifar10_resnet20_v2_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
mv cifar10_resnet20_v2_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
mv /benchmarks/cifar10_resnet20_v2_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
mv /benchmarks/cifar10_resnet20_v2_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
mv /benchmarks/cifar10_resnet20_v2_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_xla_w1.pbtxt 2> cifar10_resnet20_v2_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_xla_w2.pbtxt 2> cifar10_resnet20_v2_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/cifar10_resnet20_v2_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/cifar10_resnet20_v2_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/cifar10_resnet20_v2_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/cifar10_resnet20_v2_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
mv cifar10_resnet20_v2_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
mv cifar10_resnet20_v2_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
mv cifar10_resnet20_v2_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
mv /benchmarks/cifar10_resnet20_v2_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
mv /benchmarks/cifar10_resnet20_v2_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
mv /benchmarks/cifar10_resnet20_v2_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch32_w1.pbtxt 2> cifar10_resnet20_v2_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch32_w2.pbtxt 2> cifar10_resnet20_v2_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/cifar10_resnet20_v2_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/cifar10_resnet20_v2_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/cifar10_resnet20_v2_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/cifar10_resnet20_v2_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
mv cifar10_resnet20_v2_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
mv cifar10_resnet20_v2_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
mv cifar10_resnet20_v2_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
mv /benchmarks/cifar10_resnet20_v2_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
mv /benchmarks/cifar10_resnet20_v2_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
mv /benchmarks/cifar10_resnet20_v2_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch64_w1.pbtxt 2> cifar10_resnet20_v2_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch64_w2.pbtxt 2> cifar10_resnet20_v2_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/cifar10_resnet20_v2_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/cifar10_resnet20_v2_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/cifar10_resnet20_v2_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/cifar10_resnet20_v2_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
mv cifar10_resnet20_v2_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
mv cifar10_resnet20_v2_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
mv cifar10_resnet20_v2_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
mv /benchmarks/cifar10_resnet20_v2_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
mv /benchmarks/cifar10_resnet20_v2_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
mv /benchmarks/cifar10_resnet20_v2_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch128_w1.pbtxt 2> cifar10_resnet20_v2_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch128_w2.pbtxt 2> cifar10_resnet20_v2_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/cifar10_resnet20_v2_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/cifar10_resnet20_v2_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/cifar10_resnet20_v2_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/cifar10_resnet20_v2_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
mv cifar10_resnet20_v2_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
mv cifar10_resnet20_v2_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
mv cifar10_resnet20_v2_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
mv /benchmarks/cifar10_resnet20_v2_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
mv /benchmarks/cifar10_resnet20_v2_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
mv /benchmarks/cifar10_resnet20_v2_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch256_w1.pbtxt 2> cifar10_resnet20_v2_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch256_w2.pbtxt 2> cifar10_resnet20_v2_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/cifar10_resnet20_v2_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/cifar10_resnet20_v2_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/cifar10_resnet20_v2_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/cifar10_resnet20_v2_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
mv cifar10_resnet20_v2_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
mv cifar10_resnet20_v2_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
mv cifar10_resnet20_v2_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
mv /benchmarks/cifar10_resnet20_v2_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
mv /benchmarks/cifar10_resnet20_v2_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
mv /benchmarks/cifar10_resnet20_v2_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch512_w1.pbtxt 2> cifar10_resnet20_v2_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch512_w2.pbtxt 2> cifar10_resnet20_v2_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/cifar10_resnet20_v2_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/cifar10_resnet20_v2_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/cifar10_resnet20_v2_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/cifar10_resnet20_v2_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
mv cifar10_resnet20_v2_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
mv cifar10_resnet20_v2_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
mv cifar10_resnet20_v2_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
mv /benchmarks/cifar10_resnet20_v2_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
mv /benchmarks/cifar10_resnet20_v2_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
mv /benchmarks/cifar10_resnet20_v2_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_use_fp16_w1.pbtxt 2> cifar10_resnet20_v2_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_use_fp16_w2.pbtxt 2> cifar10_resnet20_v2_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/cifar10_resnet20_v2_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/cifar10_resnet20_v2_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/cifar10_resnet20_v2_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/cifar10_resnet20_v2_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
mv cifar10_resnet20_v2_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
mv cifar10_resnet20_v2_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
mv cifar10_resnet20_v2_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet20_v2_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet20_v2_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet20_v2_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_optMomentum_w1.pbtxt 2> cifar10_resnet20_v2_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_optMomentum_w2.pbtxt 2> cifar10_resnet20_v2_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/cifar10_resnet20_v2_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/cifar10_resnet20_v2_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/cifar10_resnet20_v2_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/cifar10_resnet20_v2_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
mv cifar10_resnet20_v2_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
mv cifar10_resnet20_v2_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
mv cifar10_resnet20_v2_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet20_v2_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet20_v2_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet20_v2_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_optRmsprop_w1.pbtxt 2> cifar10_resnet20_v2_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_optRmsprop_w2.pbtxt 2> cifar10_resnet20_v2_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/cifar10_resnet20_v2_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/cifar10_resnet20_v2_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/cifar10_resnet20_v2_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/cifar10_resnet20_v2_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
mv cifar10_resnet20_v2_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
mv cifar10_resnet20_v2_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
mv cifar10_resnet20_v2_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet20_v2_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet20_v2_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet20_v2_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_dataFormat_w1.pbtxt 2> cifar10_resnet20_v2_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_dataFormat_w2.pbtxt 2> cifar10_resnet20_v2_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/cifar10_resnet20_v2_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/cifar10_resnet20_v2_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/cifar10_resnet20_v2_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/cifar10_resnet20_v2_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
mv cifar10_resnet20_v2_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
mv cifar10_resnet20_v2_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
mv cifar10_resnet20_v2_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet20_v2_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet20_v2_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet20_v2_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_winograd_w1.pbtxt 2> cifar10_resnet20_v2_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_winograd_w2.pbtxt 2> cifar10_resnet20_v2_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/cifar10_resnet20_v2_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/cifar10_resnet20_v2_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/cifar10_resnet20_v2_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/cifar10_resnet20_v2_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
mv cifar10_resnet20_v2_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
mv cifar10_resnet20_v2_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
mv cifar10_resnet20_v2_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
mv /benchmarks/cifar10_resnet20_v2_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
mv /benchmarks/cifar10_resnet20_v2_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
mv /benchmarks/cifar10_resnet20_v2_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_xla_w1.pbtxt 2> cifar10_resnet20_v2_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_xla_w2.pbtxt 2> cifar10_resnet20_v2_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/cifar10_resnet20_v2_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/cifar10_resnet20_v2_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/cifar10_resnet20_v2_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/cifar10_resnet20_v2_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
mv cifar10_resnet20_v2_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
mv cifar10_resnet20_v2_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
mv cifar10_resnet20_v2_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
mv /benchmarks/cifar10_resnet20_v2_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
mv /benchmarks/cifar10_resnet20_v2_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
mv /benchmarks/cifar10_resnet20_v2_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch32_w1.pbtxt 2> cifar10_resnet32_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch32_w2.pbtxt 2> cifar10_resnet32_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/cifar10_resnet32_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/cifar10_resnet32_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/cifar10_resnet32_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/cifar10_resnet32_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
mv cifar10_resnet32_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
mv cifar10_resnet32_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
mv cifar10_resnet32_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
mv /benchmarks/cifar10_resnet32_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
mv /benchmarks/cifar10_resnet32_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
mv /benchmarks/cifar10_resnet32_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch64_w1.pbtxt 2> cifar10_resnet32_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch64_w2.pbtxt 2> cifar10_resnet32_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/cifar10_resnet32_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/cifar10_resnet32_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/cifar10_resnet32_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/cifar10_resnet32_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
mv cifar10_resnet32_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
mv cifar10_resnet32_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
mv cifar10_resnet32_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
mv /benchmarks/cifar10_resnet32_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
mv /benchmarks/cifar10_resnet32_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
mv /benchmarks/cifar10_resnet32_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch128_w1.pbtxt 2> cifar10_resnet32_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch128_w2.pbtxt 2> cifar10_resnet32_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/cifar10_resnet32_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/cifar10_resnet32_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/cifar10_resnet32_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/cifar10_resnet32_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
mv cifar10_resnet32_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
mv cifar10_resnet32_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
mv cifar10_resnet32_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
mv /benchmarks/cifar10_resnet32_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
mv /benchmarks/cifar10_resnet32_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
mv /benchmarks/cifar10_resnet32_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch256_w1.pbtxt 2> cifar10_resnet32_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch256_w2.pbtxt 2> cifar10_resnet32_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/cifar10_resnet32_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/cifar10_resnet32_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/cifar10_resnet32_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/cifar10_resnet32_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
mv cifar10_resnet32_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
mv cifar10_resnet32_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
mv cifar10_resnet32_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
mv /benchmarks/cifar10_resnet32_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
mv /benchmarks/cifar10_resnet32_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
mv /benchmarks/cifar10_resnet32_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch512_w1.pbtxt 2> cifar10_resnet32_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch512_w2.pbtxt 2> cifar10_resnet32_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/cifar10_resnet32_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/cifar10_resnet32_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/cifar10_resnet32_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/cifar10_resnet32_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
mv cifar10_resnet32_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
mv cifar10_resnet32_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
mv cifar10_resnet32_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
mv /benchmarks/cifar10_resnet32_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
mv /benchmarks/cifar10_resnet32_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
mv /benchmarks/cifar10_resnet32_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_use_fp16_w1.pbtxt 2> cifar10_resnet32_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_use_fp16_w2.pbtxt 2> cifar10_resnet32_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/cifar10_resnet32_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/cifar10_resnet32_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/cifar10_resnet32_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/cifar10_resnet32_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
mv cifar10_resnet32_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
mv cifar10_resnet32_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
mv cifar10_resnet32_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
mv /benchmarks/cifar10_resnet32_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
mv /benchmarks/cifar10_resnet32_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
mv /benchmarks/cifar10_resnet32_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_optMomentum_w1.pbtxt 2> cifar10_resnet32_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_optMomentum_w2.pbtxt 2> cifar10_resnet32_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/cifar10_resnet32_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/cifar10_resnet32_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/cifar10_resnet32_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/cifar10_resnet32_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
mv cifar10_resnet32_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
mv cifar10_resnet32_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
mv cifar10_resnet32_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
mv /benchmarks/cifar10_resnet32_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
mv /benchmarks/cifar10_resnet32_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
mv /benchmarks/cifar10_resnet32_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet32_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet32_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/cifar10_resnet32_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/cifar10_resnet32_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/cifar10_resnet32_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/cifar10_resnet32_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
mv cifar10_resnet32_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
mv cifar10_resnet32_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
mv cifar10_resnet32_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
mv /benchmarks/cifar10_resnet32_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
mv /benchmarks/cifar10_resnet32_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
mv /benchmarks/cifar10_resnet32_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_dataFormat_w1.pbtxt 2> cifar10_resnet32_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_dataFormat_w2.pbtxt 2> cifar10_resnet32_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/cifar10_resnet32_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/cifar10_resnet32_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/cifar10_resnet32_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/cifar10_resnet32_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
mv cifar10_resnet32_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
mv cifar10_resnet32_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
mv cifar10_resnet32_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
mv /benchmarks/cifar10_resnet32_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
mv /benchmarks/cifar10_resnet32_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
mv /benchmarks/cifar10_resnet32_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_winograd_w1.pbtxt 2> cifar10_resnet32_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_winograd_w2.pbtxt 2> cifar10_resnet32_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/cifar10_resnet32_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/cifar10_resnet32_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/cifar10_resnet32_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/cifar10_resnet32_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
mv cifar10_resnet32_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
mv cifar10_resnet32_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
mv cifar10_resnet32_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
mv /benchmarks/cifar10_resnet32_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
mv /benchmarks/cifar10_resnet32_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
mv /benchmarks/cifar10_resnet32_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_xla_w1.pbtxt 2> cifar10_resnet32_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_xla_w2.pbtxt 2> cifar10_resnet32_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/cifar10_resnet32_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/cifar10_resnet32_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/cifar10_resnet32_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/cifar10_resnet32_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
mv cifar10_resnet32_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
mv cifar10_resnet32_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
mv cifar10_resnet32_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
mv /benchmarks/cifar10_resnet32_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
mv /benchmarks/cifar10_resnet32_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
mv /benchmarks/cifar10_resnet32_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_batch32_w1.pbtxt 2> cifar10_resnet32_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_batch32_w2.pbtxt 2> cifar10_resnet32_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/cifar10_resnet32_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/cifar10_resnet32_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/cifar10_resnet32_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/cifar10_resnet32_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
mv cifar10_resnet32_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
mv cifar10_resnet32_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
mv cifar10_resnet32_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
mv /benchmarks/cifar10_resnet32_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
mv /benchmarks/cifar10_resnet32_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
mv /benchmarks/cifar10_resnet32_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_batch64_w1.pbtxt 2> cifar10_resnet32_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_batch64_w2.pbtxt 2> cifar10_resnet32_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/cifar10_resnet32_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/cifar10_resnet32_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/cifar10_resnet32_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/cifar10_resnet32_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
mv cifar10_resnet32_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
mv cifar10_resnet32_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
mv cifar10_resnet32_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
mv /benchmarks/cifar10_resnet32_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
mv /benchmarks/cifar10_resnet32_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
mv /benchmarks/cifar10_resnet32_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_batch128_w1.pbtxt 2> cifar10_resnet32_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_batch128_w2.pbtxt 2> cifar10_resnet32_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/cifar10_resnet32_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/cifar10_resnet32_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/cifar10_resnet32_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/cifar10_resnet32_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
mv cifar10_resnet32_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
mv cifar10_resnet32_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
mv cifar10_resnet32_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
mv /benchmarks/cifar10_resnet32_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
mv /benchmarks/cifar10_resnet32_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
mv /benchmarks/cifar10_resnet32_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_batch256_w1.pbtxt 2> cifar10_resnet32_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_batch256_w2.pbtxt 2> cifar10_resnet32_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/cifar10_resnet32_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/cifar10_resnet32_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/cifar10_resnet32_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/cifar10_resnet32_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
mv cifar10_resnet32_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
mv cifar10_resnet32_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
mv cifar10_resnet32_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
mv /benchmarks/cifar10_resnet32_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
mv /benchmarks/cifar10_resnet32_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
mv /benchmarks/cifar10_resnet32_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_batch512_w1.pbtxt 2> cifar10_resnet32_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_batch512_w2.pbtxt 2> cifar10_resnet32_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/cifar10_resnet32_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/cifar10_resnet32_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/cifar10_resnet32_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/cifar10_resnet32_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
mv cifar10_resnet32_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
mv cifar10_resnet32_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
mv cifar10_resnet32_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
mv /benchmarks/cifar10_resnet32_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
mv /benchmarks/cifar10_resnet32_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
mv /benchmarks/cifar10_resnet32_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_use_fp16_w1.pbtxt 2> cifar10_resnet32_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_use_fp16_w2.pbtxt 2> cifar10_resnet32_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/cifar10_resnet32_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/cifar10_resnet32_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/cifar10_resnet32_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/cifar10_resnet32_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
mv cifar10_resnet32_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
mv cifar10_resnet32_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
mv cifar10_resnet32_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
mv /benchmarks/cifar10_resnet32_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
mv /benchmarks/cifar10_resnet32_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
mv /benchmarks/cifar10_resnet32_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_optMomentum_w1.pbtxt 2> cifar10_resnet32_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_optMomentum_w2.pbtxt 2> cifar10_resnet32_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/cifar10_resnet32_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/cifar10_resnet32_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/cifar10_resnet32_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/cifar10_resnet32_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
mv cifar10_resnet32_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
mv cifar10_resnet32_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
mv cifar10_resnet32_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
mv /benchmarks/cifar10_resnet32_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
mv /benchmarks/cifar10_resnet32_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
mv /benchmarks/cifar10_resnet32_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_optRmsprop_w1.pbtxt 2> cifar10_resnet32_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_optRmsprop_w2.pbtxt 2> cifar10_resnet32_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/cifar10_resnet32_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/cifar10_resnet32_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/cifar10_resnet32_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/cifar10_resnet32_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
mv cifar10_resnet32_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
mv cifar10_resnet32_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
mv cifar10_resnet32_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
mv /benchmarks/cifar10_resnet32_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
mv /benchmarks/cifar10_resnet32_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
mv /benchmarks/cifar10_resnet32_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_dataFormat_w1.pbtxt 2> cifar10_resnet32_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_dataFormat_w2.pbtxt 2> cifar10_resnet32_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/cifar10_resnet32_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/cifar10_resnet32_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/cifar10_resnet32_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/cifar10_resnet32_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
mv cifar10_resnet32_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
mv cifar10_resnet32_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
mv cifar10_resnet32_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
mv /benchmarks/cifar10_resnet32_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
mv /benchmarks/cifar10_resnet32_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
mv /benchmarks/cifar10_resnet32_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_winograd_w1.pbtxt 2> cifar10_resnet32_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_winograd_w2.pbtxt 2> cifar10_resnet32_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/cifar10_resnet32_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/cifar10_resnet32_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/cifar10_resnet32_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/cifar10_resnet32_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
mv cifar10_resnet32_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
mv cifar10_resnet32_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
mv cifar10_resnet32_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
mv /benchmarks/cifar10_resnet32_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
mv /benchmarks/cifar10_resnet32_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
mv /benchmarks/cifar10_resnet32_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_xla_w1.pbtxt 2> cifar10_resnet32_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_xla_w2.pbtxt 2> cifar10_resnet32_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/cifar10_resnet32_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/cifar10_resnet32_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/cifar10_resnet32_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/cifar10_resnet32_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
mv cifar10_resnet32_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
mv cifar10_resnet32_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
mv cifar10_resnet32_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
mv /benchmarks/cifar10_resnet32_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
mv /benchmarks/cifar10_resnet32_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
mv /benchmarks/cifar10_resnet32_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch32_w1.pbtxt 2> cifar10_resnet32_v2_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch32_w2.pbtxt 2> cifar10_resnet32_v2_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/cifar10_resnet32_v2_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/cifar10_resnet32_v2_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/cifar10_resnet32_v2_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/cifar10_resnet32_v2_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
mv cifar10_resnet32_v2_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
mv cifar10_resnet32_v2_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
mv cifar10_resnet32_v2_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
mv /benchmarks/cifar10_resnet32_v2_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
mv /benchmarks/cifar10_resnet32_v2_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
mv /benchmarks/cifar10_resnet32_v2_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch64_w1.pbtxt 2> cifar10_resnet32_v2_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch64_w2.pbtxt 2> cifar10_resnet32_v2_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/cifar10_resnet32_v2_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/cifar10_resnet32_v2_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/cifar10_resnet32_v2_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/cifar10_resnet32_v2_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
mv cifar10_resnet32_v2_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
mv cifar10_resnet32_v2_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
mv cifar10_resnet32_v2_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
mv /benchmarks/cifar10_resnet32_v2_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
mv /benchmarks/cifar10_resnet32_v2_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
mv /benchmarks/cifar10_resnet32_v2_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch128_w1.pbtxt 2> cifar10_resnet32_v2_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch128_w2.pbtxt 2> cifar10_resnet32_v2_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/cifar10_resnet32_v2_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/cifar10_resnet32_v2_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/cifar10_resnet32_v2_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/cifar10_resnet32_v2_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
mv cifar10_resnet32_v2_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
mv cifar10_resnet32_v2_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
mv cifar10_resnet32_v2_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
mv /benchmarks/cifar10_resnet32_v2_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
mv /benchmarks/cifar10_resnet32_v2_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
mv /benchmarks/cifar10_resnet32_v2_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch256_w1.pbtxt 2> cifar10_resnet32_v2_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch256_w2.pbtxt 2> cifar10_resnet32_v2_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/cifar10_resnet32_v2_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/cifar10_resnet32_v2_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/cifar10_resnet32_v2_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/cifar10_resnet32_v2_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
mv cifar10_resnet32_v2_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
mv cifar10_resnet32_v2_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
mv cifar10_resnet32_v2_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
mv /benchmarks/cifar10_resnet32_v2_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
mv /benchmarks/cifar10_resnet32_v2_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
mv /benchmarks/cifar10_resnet32_v2_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch512_w1.pbtxt 2> cifar10_resnet32_v2_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch512_w2.pbtxt 2> cifar10_resnet32_v2_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/cifar10_resnet32_v2_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/cifar10_resnet32_v2_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/cifar10_resnet32_v2_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/cifar10_resnet32_v2_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
mv cifar10_resnet32_v2_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
mv cifar10_resnet32_v2_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
mv cifar10_resnet32_v2_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
mv /benchmarks/cifar10_resnet32_v2_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
mv /benchmarks/cifar10_resnet32_v2_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
mv /benchmarks/cifar10_resnet32_v2_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_use_fp16_w1.pbtxt 2> cifar10_resnet32_v2_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_use_fp16_w2.pbtxt 2> cifar10_resnet32_v2_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/cifar10_resnet32_v2_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/cifar10_resnet32_v2_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/cifar10_resnet32_v2_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/cifar10_resnet32_v2_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
mv cifar10_resnet32_v2_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
mv cifar10_resnet32_v2_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
mv cifar10_resnet32_v2_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet32_v2_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet32_v2_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet32_v2_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_optMomentum_w1.pbtxt 2> cifar10_resnet32_v2_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_optMomentum_w2.pbtxt 2> cifar10_resnet32_v2_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/cifar10_resnet32_v2_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/cifar10_resnet32_v2_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/cifar10_resnet32_v2_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/cifar10_resnet32_v2_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
mv cifar10_resnet32_v2_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
mv cifar10_resnet32_v2_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
mv cifar10_resnet32_v2_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet32_v2_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet32_v2_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet32_v2_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet32_v2_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet32_v2_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/cifar10_resnet32_v2_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/cifar10_resnet32_v2_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/cifar10_resnet32_v2_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/cifar10_resnet32_v2_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
mv cifar10_resnet32_v2_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
mv cifar10_resnet32_v2_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
mv cifar10_resnet32_v2_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_dataFormat_w1.pbtxt 2> cifar10_resnet32_v2_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_dataFormat_w2.pbtxt 2> cifar10_resnet32_v2_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/cifar10_resnet32_v2_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/cifar10_resnet32_v2_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/cifar10_resnet32_v2_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/cifar10_resnet32_v2_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
mv cifar10_resnet32_v2_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
mv cifar10_resnet32_v2_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
mv cifar10_resnet32_v2_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet32_v2_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet32_v2_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet32_v2_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_winograd_w1.pbtxt 2> cifar10_resnet32_v2_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_winograd_w2.pbtxt 2> cifar10_resnet32_v2_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/cifar10_resnet32_v2_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/cifar10_resnet32_v2_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/cifar10_resnet32_v2_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/cifar10_resnet32_v2_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
mv cifar10_resnet32_v2_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
mv cifar10_resnet32_v2_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
mv cifar10_resnet32_v2_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
mv /benchmarks/cifar10_resnet32_v2_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
mv /benchmarks/cifar10_resnet32_v2_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
mv /benchmarks/cifar10_resnet32_v2_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_xla_w1.pbtxt 2> cifar10_resnet32_v2_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_xla_w2.pbtxt 2> cifar10_resnet32_v2_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/cifar10_resnet32_v2_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/cifar10_resnet32_v2_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/cifar10_resnet32_v2_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/cifar10_resnet32_v2_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
mv cifar10_resnet32_v2_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
mv cifar10_resnet32_v2_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
mv cifar10_resnet32_v2_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
mv /benchmarks/cifar10_resnet32_v2_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
mv /benchmarks/cifar10_resnet32_v2_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
mv /benchmarks/cifar10_resnet32_v2_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch32_w1.pbtxt 2> cifar10_resnet32_v2_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch32_w2.pbtxt 2> cifar10_resnet32_v2_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/cifar10_resnet32_v2_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/cifar10_resnet32_v2_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/cifar10_resnet32_v2_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/cifar10_resnet32_v2_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
mv cifar10_resnet32_v2_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
mv cifar10_resnet32_v2_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
mv cifar10_resnet32_v2_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
mv /benchmarks/cifar10_resnet32_v2_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
mv /benchmarks/cifar10_resnet32_v2_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
mv /benchmarks/cifar10_resnet32_v2_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch64_w1.pbtxt 2> cifar10_resnet32_v2_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch64_w2.pbtxt 2> cifar10_resnet32_v2_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/cifar10_resnet32_v2_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/cifar10_resnet32_v2_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/cifar10_resnet32_v2_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/cifar10_resnet32_v2_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
mv cifar10_resnet32_v2_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
mv cifar10_resnet32_v2_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
mv cifar10_resnet32_v2_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
mv /benchmarks/cifar10_resnet32_v2_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
mv /benchmarks/cifar10_resnet32_v2_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
mv /benchmarks/cifar10_resnet32_v2_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch128_w1.pbtxt 2> cifar10_resnet32_v2_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch128_w2.pbtxt 2> cifar10_resnet32_v2_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/cifar10_resnet32_v2_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/cifar10_resnet32_v2_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/cifar10_resnet32_v2_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/cifar10_resnet32_v2_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
mv cifar10_resnet32_v2_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
mv cifar10_resnet32_v2_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
mv cifar10_resnet32_v2_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
mv /benchmarks/cifar10_resnet32_v2_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
mv /benchmarks/cifar10_resnet32_v2_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
mv /benchmarks/cifar10_resnet32_v2_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch256_w1.pbtxt 2> cifar10_resnet32_v2_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch256_w2.pbtxt 2> cifar10_resnet32_v2_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/cifar10_resnet32_v2_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/cifar10_resnet32_v2_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/cifar10_resnet32_v2_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/cifar10_resnet32_v2_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
mv cifar10_resnet32_v2_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
mv cifar10_resnet32_v2_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
mv cifar10_resnet32_v2_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
mv /benchmarks/cifar10_resnet32_v2_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
mv /benchmarks/cifar10_resnet32_v2_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
mv /benchmarks/cifar10_resnet32_v2_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch512_w1.pbtxt 2> cifar10_resnet32_v2_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch512_w2.pbtxt 2> cifar10_resnet32_v2_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/cifar10_resnet32_v2_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/cifar10_resnet32_v2_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/cifar10_resnet32_v2_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/cifar10_resnet32_v2_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
mv cifar10_resnet32_v2_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
mv cifar10_resnet32_v2_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
mv cifar10_resnet32_v2_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
mv /benchmarks/cifar10_resnet32_v2_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
mv /benchmarks/cifar10_resnet32_v2_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
mv /benchmarks/cifar10_resnet32_v2_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_use_fp16_w1.pbtxt 2> cifar10_resnet32_v2_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_use_fp16_w2.pbtxt 2> cifar10_resnet32_v2_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/cifar10_resnet32_v2_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/cifar10_resnet32_v2_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/cifar10_resnet32_v2_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/cifar10_resnet32_v2_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
mv cifar10_resnet32_v2_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
mv cifar10_resnet32_v2_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
mv cifar10_resnet32_v2_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet32_v2_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet32_v2_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet32_v2_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_optMomentum_w1.pbtxt 2> cifar10_resnet32_v2_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_optMomentum_w2.pbtxt 2> cifar10_resnet32_v2_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/cifar10_resnet32_v2_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/cifar10_resnet32_v2_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/cifar10_resnet32_v2_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/cifar10_resnet32_v2_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
mv cifar10_resnet32_v2_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
mv cifar10_resnet32_v2_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
mv cifar10_resnet32_v2_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet32_v2_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet32_v2_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet32_v2_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_optRmsprop_w1.pbtxt 2> cifar10_resnet32_v2_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_optRmsprop_w2.pbtxt 2> cifar10_resnet32_v2_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/cifar10_resnet32_v2_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/cifar10_resnet32_v2_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/cifar10_resnet32_v2_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/cifar10_resnet32_v2_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
mv cifar10_resnet32_v2_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
mv cifar10_resnet32_v2_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
mv cifar10_resnet32_v2_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet32_v2_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet32_v2_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet32_v2_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_dataFormat_w1.pbtxt 2> cifar10_resnet32_v2_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_dataFormat_w2.pbtxt 2> cifar10_resnet32_v2_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/cifar10_resnet32_v2_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/cifar10_resnet32_v2_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/cifar10_resnet32_v2_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/cifar10_resnet32_v2_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
mv cifar10_resnet32_v2_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
mv cifar10_resnet32_v2_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
mv cifar10_resnet32_v2_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet32_v2_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet32_v2_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet32_v2_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_winograd_w1.pbtxt 2> cifar10_resnet32_v2_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_winograd_w2.pbtxt 2> cifar10_resnet32_v2_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/cifar10_resnet32_v2_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/cifar10_resnet32_v2_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/cifar10_resnet32_v2_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/cifar10_resnet32_v2_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
mv cifar10_resnet32_v2_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
mv cifar10_resnet32_v2_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
mv cifar10_resnet32_v2_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
mv /benchmarks/cifar10_resnet32_v2_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
mv /benchmarks/cifar10_resnet32_v2_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
mv /benchmarks/cifar10_resnet32_v2_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_xla_w1.pbtxt 2> cifar10_resnet32_v2_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_xla_w2.pbtxt 2> cifar10_resnet32_v2_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/cifar10_resnet32_v2_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/cifar10_resnet32_v2_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/cifar10_resnet32_v2_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/cifar10_resnet32_v2_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
mv cifar10_resnet32_v2_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
mv cifar10_resnet32_v2_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
mv cifar10_resnet32_v2_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
mv /benchmarks/cifar10_resnet32_v2_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
mv /benchmarks/cifar10_resnet32_v2_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
mv /benchmarks/cifar10_resnet32_v2_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch32_w1.pbtxt 2> cifar10_resnet44_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch32_w2.pbtxt 2> cifar10_resnet44_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/cifar10_resnet44_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/cifar10_resnet44_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/cifar10_resnet44_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/cifar10_resnet44_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
mv cifar10_resnet44_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
mv cifar10_resnet44_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
mv cifar10_resnet44_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
mv /benchmarks/cifar10_resnet44_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
mv /benchmarks/cifar10_resnet44_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
mv /benchmarks/cifar10_resnet44_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch64_w1.pbtxt 2> cifar10_resnet44_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch64_w2.pbtxt 2> cifar10_resnet44_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/cifar10_resnet44_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/cifar10_resnet44_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/cifar10_resnet44_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/cifar10_resnet44_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
mv cifar10_resnet44_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
mv cifar10_resnet44_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
mv cifar10_resnet44_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
mv /benchmarks/cifar10_resnet44_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
mv /benchmarks/cifar10_resnet44_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
mv /benchmarks/cifar10_resnet44_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch128_w1.pbtxt 2> cifar10_resnet44_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch128_w2.pbtxt 2> cifar10_resnet44_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/cifar10_resnet44_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/cifar10_resnet44_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/cifar10_resnet44_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/cifar10_resnet44_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
mv cifar10_resnet44_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
mv cifar10_resnet44_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
mv cifar10_resnet44_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
mv /benchmarks/cifar10_resnet44_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
mv /benchmarks/cifar10_resnet44_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
mv /benchmarks/cifar10_resnet44_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch256_w1.pbtxt 2> cifar10_resnet44_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch256_w2.pbtxt 2> cifar10_resnet44_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/cifar10_resnet44_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/cifar10_resnet44_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/cifar10_resnet44_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/cifar10_resnet44_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
mv cifar10_resnet44_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
mv cifar10_resnet44_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
mv cifar10_resnet44_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
mv /benchmarks/cifar10_resnet44_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
mv /benchmarks/cifar10_resnet44_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
mv /benchmarks/cifar10_resnet44_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch512_w1.pbtxt 2> cifar10_resnet44_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch512_w2.pbtxt 2> cifar10_resnet44_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/cifar10_resnet44_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/cifar10_resnet44_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/cifar10_resnet44_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/cifar10_resnet44_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
mv cifar10_resnet44_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
mv cifar10_resnet44_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
mv cifar10_resnet44_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
mv /benchmarks/cifar10_resnet44_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
mv /benchmarks/cifar10_resnet44_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
mv /benchmarks/cifar10_resnet44_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_use_fp16_w1.pbtxt 2> cifar10_resnet44_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_use_fp16_w2.pbtxt 2> cifar10_resnet44_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/cifar10_resnet44_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/cifar10_resnet44_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/cifar10_resnet44_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/cifar10_resnet44_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
mv cifar10_resnet44_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
mv cifar10_resnet44_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
mv cifar10_resnet44_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
mv /benchmarks/cifar10_resnet44_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
mv /benchmarks/cifar10_resnet44_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
mv /benchmarks/cifar10_resnet44_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_optMomentum_w1.pbtxt 2> cifar10_resnet44_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_optMomentum_w2.pbtxt 2> cifar10_resnet44_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/cifar10_resnet44_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/cifar10_resnet44_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/cifar10_resnet44_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/cifar10_resnet44_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
mv cifar10_resnet44_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
mv cifar10_resnet44_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
mv cifar10_resnet44_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
mv /benchmarks/cifar10_resnet44_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
mv /benchmarks/cifar10_resnet44_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
mv /benchmarks/cifar10_resnet44_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet44_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet44_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/cifar10_resnet44_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/cifar10_resnet44_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/cifar10_resnet44_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/cifar10_resnet44_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
mv cifar10_resnet44_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
mv cifar10_resnet44_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
mv cifar10_resnet44_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
mv /benchmarks/cifar10_resnet44_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
mv /benchmarks/cifar10_resnet44_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
mv /benchmarks/cifar10_resnet44_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_dataFormat_w1.pbtxt 2> cifar10_resnet44_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_dataFormat_w2.pbtxt 2> cifar10_resnet44_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/cifar10_resnet44_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/cifar10_resnet44_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/cifar10_resnet44_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/cifar10_resnet44_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
mv cifar10_resnet44_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
mv cifar10_resnet44_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
mv cifar10_resnet44_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
mv /benchmarks/cifar10_resnet44_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
mv /benchmarks/cifar10_resnet44_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
mv /benchmarks/cifar10_resnet44_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_winograd_w1.pbtxt 2> cifar10_resnet44_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_winograd_w2.pbtxt 2> cifar10_resnet44_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/cifar10_resnet44_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/cifar10_resnet44_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/cifar10_resnet44_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/cifar10_resnet44_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
mv cifar10_resnet44_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
mv cifar10_resnet44_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
mv cifar10_resnet44_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
mv /benchmarks/cifar10_resnet44_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
mv /benchmarks/cifar10_resnet44_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
mv /benchmarks/cifar10_resnet44_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_xla_w1.pbtxt 2> cifar10_resnet44_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_xla_w2.pbtxt 2> cifar10_resnet44_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/cifar10_resnet44_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/cifar10_resnet44_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/cifar10_resnet44_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/cifar10_resnet44_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
mv cifar10_resnet44_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
mv cifar10_resnet44_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
mv cifar10_resnet44_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
mv /benchmarks/cifar10_resnet44_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
mv /benchmarks/cifar10_resnet44_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
mv /benchmarks/cifar10_resnet44_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_batch32_w1.pbtxt 2> cifar10_resnet44_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_batch32_w2.pbtxt 2> cifar10_resnet44_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/cifar10_resnet44_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/cifar10_resnet44_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/cifar10_resnet44_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/cifar10_resnet44_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
mv cifar10_resnet44_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
mv cifar10_resnet44_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
mv cifar10_resnet44_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
mv /benchmarks/cifar10_resnet44_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
mv /benchmarks/cifar10_resnet44_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
mv /benchmarks/cifar10_resnet44_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_batch64_w1.pbtxt 2> cifar10_resnet44_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_batch64_w2.pbtxt 2> cifar10_resnet44_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/cifar10_resnet44_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/cifar10_resnet44_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/cifar10_resnet44_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/cifar10_resnet44_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
mv cifar10_resnet44_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
mv cifar10_resnet44_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
mv cifar10_resnet44_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
mv /benchmarks/cifar10_resnet44_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
mv /benchmarks/cifar10_resnet44_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
mv /benchmarks/cifar10_resnet44_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_batch128_w1.pbtxt 2> cifar10_resnet44_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_batch128_w2.pbtxt 2> cifar10_resnet44_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/cifar10_resnet44_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/cifar10_resnet44_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/cifar10_resnet44_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/cifar10_resnet44_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
mv cifar10_resnet44_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
mv cifar10_resnet44_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
mv cifar10_resnet44_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
mv /benchmarks/cifar10_resnet44_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
mv /benchmarks/cifar10_resnet44_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
mv /benchmarks/cifar10_resnet44_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_batch256_w1.pbtxt 2> cifar10_resnet44_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_batch256_w2.pbtxt 2> cifar10_resnet44_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/cifar10_resnet44_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/cifar10_resnet44_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/cifar10_resnet44_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/cifar10_resnet44_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
mv cifar10_resnet44_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
mv cifar10_resnet44_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
mv cifar10_resnet44_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
mv /benchmarks/cifar10_resnet44_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
mv /benchmarks/cifar10_resnet44_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
mv /benchmarks/cifar10_resnet44_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_batch512_w1.pbtxt 2> cifar10_resnet44_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_batch512_w2.pbtxt 2> cifar10_resnet44_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/cifar10_resnet44_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/cifar10_resnet44_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/cifar10_resnet44_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/cifar10_resnet44_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
mv cifar10_resnet44_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
mv cifar10_resnet44_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
mv cifar10_resnet44_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
mv /benchmarks/cifar10_resnet44_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
mv /benchmarks/cifar10_resnet44_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
mv /benchmarks/cifar10_resnet44_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_use_fp16_w1.pbtxt 2> cifar10_resnet44_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_use_fp16_w2.pbtxt 2> cifar10_resnet44_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/cifar10_resnet44_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/cifar10_resnet44_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/cifar10_resnet44_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/cifar10_resnet44_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
mv cifar10_resnet44_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
mv cifar10_resnet44_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
mv cifar10_resnet44_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
mv /benchmarks/cifar10_resnet44_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
mv /benchmarks/cifar10_resnet44_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
mv /benchmarks/cifar10_resnet44_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_optMomentum_w1.pbtxt 2> cifar10_resnet44_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_optMomentum_w2.pbtxt 2> cifar10_resnet44_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/cifar10_resnet44_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/cifar10_resnet44_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/cifar10_resnet44_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/cifar10_resnet44_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
mv cifar10_resnet44_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
mv cifar10_resnet44_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
mv cifar10_resnet44_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
mv /benchmarks/cifar10_resnet44_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
mv /benchmarks/cifar10_resnet44_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
mv /benchmarks/cifar10_resnet44_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_optRmsprop_w1.pbtxt 2> cifar10_resnet44_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_optRmsprop_w2.pbtxt 2> cifar10_resnet44_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/cifar10_resnet44_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/cifar10_resnet44_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/cifar10_resnet44_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/cifar10_resnet44_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
mv cifar10_resnet44_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
mv cifar10_resnet44_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
mv cifar10_resnet44_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
mv /benchmarks/cifar10_resnet44_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
mv /benchmarks/cifar10_resnet44_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
mv /benchmarks/cifar10_resnet44_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_dataFormat_w1.pbtxt 2> cifar10_resnet44_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_dataFormat_w2.pbtxt 2> cifar10_resnet44_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/cifar10_resnet44_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/cifar10_resnet44_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/cifar10_resnet44_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/cifar10_resnet44_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
mv cifar10_resnet44_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
mv cifar10_resnet44_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
mv cifar10_resnet44_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
mv /benchmarks/cifar10_resnet44_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
mv /benchmarks/cifar10_resnet44_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
mv /benchmarks/cifar10_resnet44_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_winograd_w1.pbtxt 2> cifar10_resnet44_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_winograd_w2.pbtxt 2> cifar10_resnet44_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/cifar10_resnet44_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/cifar10_resnet44_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/cifar10_resnet44_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/cifar10_resnet44_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
mv cifar10_resnet44_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
mv cifar10_resnet44_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
mv cifar10_resnet44_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
mv /benchmarks/cifar10_resnet44_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
mv /benchmarks/cifar10_resnet44_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
mv /benchmarks/cifar10_resnet44_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_xla_w1.pbtxt 2> cifar10_resnet44_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_xla_w2.pbtxt 2> cifar10_resnet44_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/cifar10_resnet44_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/cifar10_resnet44_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/cifar10_resnet44_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/cifar10_resnet44_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
mv cifar10_resnet44_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
mv cifar10_resnet44_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
mv cifar10_resnet44_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
mv /benchmarks/cifar10_resnet44_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
mv /benchmarks/cifar10_resnet44_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
mv /benchmarks/cifar10_resnet44_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch32_w1.pbtxt 2> cifar10_resnet44_v2_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch32_w2.pbtxt 2> cifar10_resnet44_v2_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/cifar10_resnet44_v2_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/cifar10_resnet44_v2_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/cifar10_resnet44_v2_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/cifar10_resnet44_v2_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
mv cifar10_resnet44_v2_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
mv cifar10_resnet44_v2_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
mv cifar10_resnet44_v2_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
mv /benchmarks/cifar10_resnet44_v2_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
mv /benchmarks/cifar10_resnet44_v2_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
mv /benchmarks/cifar10_resnet44_v2_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch64_w1.pbtxt 2> cifar10_resnet44_v2_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch64_w2.pbtxt 2> cifar10_resnet44_v2_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/cifar10_resnet44_v2_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/cifar10_resnet44_v2_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/cifar10_resnet44_v2_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/cifar10_resnet44_v2_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
mv cifar10_resnet44_v2_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
mv cifar10_resnet44_v2_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
mv cifar10_resnet44_v2_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
mv /benchmarks/cifar10_resnet44_v2_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
mv /benchmarks/cifar10_resnet44_v2_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
mv /benchmarks/cifar10_resnet44_v2_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch128_w1.pbtxt 2> cifar10_resnet44_v2_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch128_w2.pbtxt 2> cifar10_resnet44_v2_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/cifar10_resnet44_v2_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/cifar10_resnet44_v2_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/cifar10_resnet44_v2_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/cifar10_resnet44_v2_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
mv cifar10_resnet44_v2_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
mv cifar10_resnet44_v2_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
mv cifar10_resnet44_v2_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
mv /benchmarks/cifar10_resnet44_v2_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
mv /benchmarks/cifar10_resnet44_v2_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
mv /benchmarks/cifar10_resnet44_v2_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch256_w1.pbtxt 2> cifar10_resnet44_v2_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch256_w2.pbtxt 2> cifar10_resnet44_v2_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/cifar10_resnet44_v2_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/cifar10_resnet44_v2_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/cifar10_resnet44_v2_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/cifar10_resnet44_v2_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
mv cifar10_resnet44_v2_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
mv cifar10_resnet44_v2_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
mv cifar10_resnet44_v2_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
mv /benchmarks/cifar10_resnet44_v2_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
mv /benchmarks/cifar10_resnet44_v2_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
mv /benchmarks/cifar10_resnet44_v2_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch512_w1.pbtxt 2> cifar10_resnet44_v2_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch512_w2.pbtxt 2> cifar10_resnet44_v2_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/cifar10_resnet44_v2_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/cifar10_resnet44_v2_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/cifar10_resnet44_v2_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/cifar10_resnet44_v2_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
mv cifar10_resnet44_v2_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
mv cifar10_resnet44_v2_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
mv cifar10_resnet44_v2_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
mv /benchmarks/cifar10_resnet44_v2_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
mv /benchmarks/cifar10_resnet44_v2_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
mv /benchmarks/cifar10_resnet44_v2_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_use_fp16_w1.pbtxt 2> cifar10_resnet44_v2_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_use_fp16_w2.pbtxt 2> cifar10_resnet44_v2_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/cifar10_resnet44_v2_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/cifar10_resnet44_v2_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/cifar10_resnet44_v2_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/cifar10_resnet44_v2_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
mv cifar10_resnet44_v2_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
mv cifar10_resnet44_v2_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
mv cifar10_resnet44_v2_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet44_v2_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet44_v2_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet44_v2_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_optMomentum_w1.pbtxt 2> cifar10_resnet44_v2_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_optMomentum_w2.pbtxt 2> cifar10_resnet44_v2_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/cifar10_resnet44_v2_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/cifar10_resnet44_v2_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/cifar10_resnet44_v2_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/cifar10_resnet44_v2_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
mv cifar10_resnet44_v2_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
mv cifar10_resnet44_v2_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
mv cifar10_resnet44_v2_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet44_v2_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet44_v2_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet44_v2_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet44_v2_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet44_v2_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/cifar10_resnet44_v2_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/cifar10_resnet44_v2_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/cifar10_resnet44_v2_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/cifar10_resnet44_v2_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
mv cifar10_resnet44_v2_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
mv cifar10_resnet44_v2_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
mv cifar10_resnet44_v2_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_dataFormat_w1.pbtxt 2> cifar10_resnet44_v2_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_dataFormat_w2.pbtxt 2> cifar10_resnet44_v2_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/cifar10_resnet44_v2_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/cifar10_resnet44_v2_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/cifar10_resnet44_v2_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/cifar10_resnet44_v2_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
mv cifar10_resnet44_v2_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
mv cifar10_resnet44_v2_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
mv cifar10_resnet44_v2_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet44_v2_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet44_v2_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet44_v2_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_winograd_w1.pbtxt 2> cifar10_resnet44_v2_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_winograd_w2.pbtxt 2> cifar10_resnet44_v2_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/cifar10_resnet44_v2_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/cifar10_resnet44_v2_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/cifar10_resnet44_v2_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/cifar10_resnet44_v2_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
mv cifar10_resnet44_v2_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
mv cifar10_resnet44_v2_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
mv cifar10_resnet44_v2_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
mv /benchmarks/cifar10_resnet44_v2_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
mv /benchmarks/cifar10_resnet44_v2_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
mv /benchmarks/cifar10_resnet44_v2_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_xla_w1.pbtxt 2> cifar10_resnet44_v2_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_xla_w2.pbtxt 2> cifar10_resnet44_v2_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/cifar10_resnet44_v2_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/cifar10_resnet44_v2_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/cifar10_resnet44_v2_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/cifar10_resnet44_v2_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
mv cifar10_resnet44_v2_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
mv cifar10_resnet44_v2_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
mv cifar10_resnet44_v2_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
mv /benchmarks/cifar10_resnet44_v2_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
mv /benchmarks/cifar10_resnet44_v2_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
mv /benchmarks/cifar10_resnet44_v2_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch32_w1.pbtxt 2> cifar10_resnet44_v2_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch32_w2.pbtxt 2> cifar10_resnet44_v2_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/cifar10_resnet44_v2_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/cifar10_resnet44_v2_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/cifar10_resnet44_v2_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/cifar10_resnet44_v2_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
mv cifar10_resnet44_v2_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
mv cifar10_resnet44_v2_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
mv cifar10_resnet44_v2_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
mv /benchmarks/cifar10_resnet44_v2_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
mv /benchmarks/cifar10_resnet44_v2_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
mv /benchmarks/cifar10_resnet44_v2_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch64_w1.pbtxt 2> cifar10_resnet44_v2_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch64_w2.pbtxt 2> cifar10_resnet44_v2_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/cifar10_resnet44_v2_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/cifar10_resnet44_v2_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/cifar10_resnet44_v2_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/cifar10_resnet44_v2_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
mv cifar10_resnet44_v2_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
mv cifar10_resnet44_v2_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
mv cifar10_resnet44_v2_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
mv /benchmarks/cifar10_resnet44_v2_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
mv /benchmarks/cifar10_resnet44_v2_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
mv /benchmarks/cifar10_resnet44_v2_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch128_w1.pbtxt 2> cifar10_resnet44_v2_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch128_w2.pbtxt 2> cifar10_resnet44_v2_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/cifar10_resnet44_v2_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/cifar10_resnet44_v2_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/cifar10_resnet44_v2_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/cifar10_resnet44_v2_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
mv cifar10_resnet44_v2_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
mv cifar10_resnet44_v2_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
mv cifar10_resnet44_v2_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
mv /benchmarks/cifar10_resnet44_v2_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
mv /benchmarks/cifar10_resnet44_v2_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
mv /benchmarks/cifar10_resnet44_v2_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch256_w1.pbtxt 2> cifar10_resnet44_v2_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch256_w2.pbtxt 2> cifar10_resnet44_v2_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/cifar10_resnet44_v2_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/cifar10_resnet44_v2_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/cifar10_resnet44_v2_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/cifar10_resnet44_v2_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
mv cifar10_resnet44_v2_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
mv cifar10_resnet44_v2_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
mv cifar10_resnet44_v2_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
mv /benchmarks/cifar10_resnet44_v2_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
mv /benchmarks/cifar10_resnet44_v2_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
mv /benchmarks/cifar10_resnet44_v2_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch512_w1.pbtxt 2> cifar10_resnet44_v2_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch512_w2.pbtxt 2> cifar10_resnet44_v2_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/cifar10_resnet44_v2_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/cifar10_resnet44_v2_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/cifar10_resnet44_v2_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/cifar10_resnet44_v2_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
mv cifar10_resnet44_v2_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
mv cifar10_resnet44_v2_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
mv cifar10_resnet44_v2_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
mv /benchmarks/cifar10_resnet44_v2_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
mv /benchmarks/cifar10_resnet44_v2_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
mv /benchmarks/cifar10_resnet44_v2_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_use_fp16_w1.pbtxt 2> cifar10_resnet44_v2_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_use_fp16_w2.pbtxt 2> cifar10_resnet44_v2_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/cifar10_resnet44_v2_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/cifar10_resnet44_v2_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/cifar10_resnet44_v2_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/cifar10_resnet44_v2_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
mv cifar10_resnet44_v2_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
mv cifar10_resnet44_v2_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
mv cifar10_resnet44_v2_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet44_v2_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet44_v2_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet44_v2_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_optMomentum_w1.pbtxt 2> cifar10_resnet44_v2_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_optMomentum_w2.pbtxt 2> cifar10_resnet44_v2_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/cifar10_resnet44_v2_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/cifar10_resnet44_v2_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/cifar10_resnet44_v2_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/cifar10_resnet44_v2_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
mv cifar10_resnet44_v2_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
mv cifar10_resnet44_v2_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
mv cifar10_resnet44_v2_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet44_v2_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet44_v2_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet44_v2_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_optRmsprop_w1.pbtxt 2> cifar10_resnet44_v2_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_optRmsprop_w2.pbtxt 2> cifar10_resnet44_v2_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/cifar10_resnet44_v2_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/cifar10_resnet44_v2_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/cifar10_resnet44_v2_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/cifar10_resnet44_v2_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
mv cifar10_resnet44_v2_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
mv cifar10_resnet44_v2_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
mv cifar10_resnet44_v2_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet44_v2_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet44_v2_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet44_v2_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_dataFormat_w1.pbtxt 2> cifar10_resnet44_v2_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_dataFormat_w2.pbtxt 2> cifar10_resnet44_v2_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/cifar10_resnet44_v2_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/cifar10_resnet44_v2_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/cifar10_resnet44_v2_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/cifar10_resnet44_v2_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
mv cifar10_resnet44_v2_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
mv cifar10_resnet44_v2_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
mv cifar10_resnet44_v2_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet44_v2_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet44_v2_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet44_v2_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_winograd_w1.pbtxt 2> cifar10_resnet44_v2_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_winograd_w2.pbtxt 2> cifar10_resnet44_v2_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/cifar10_resnet44_v2_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/cifar10_resnet44_v2_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/cifar10_resnet44_v2_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/cifar10_resnet44_v2_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
mv cifar10_resnet44_v2_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
mv cifar10_resnet44_v2_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
mv cifar10_resnet44_v2_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
mv /benchmarks/cifar10_resnet44_v2_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
mv /benchmarks/cifar10_resnet44_v2_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
mv /benchmarks/cifar10_resnet44_v2_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_xla_w1.pbtxt 2> cifar10_resnet44_v2_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_xla_w2.pbtxt 2> cifar10_resnet44_v2_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/cifar10_resnet44_v2_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/cifar10_resnet44_v2_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/cifar10_resnet44_v2_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/cifar10_resnet44_v2_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
mv cifar10_resnet44_v2_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
mv cifar10_resnet44_v2_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
mv cifar10_resnet44_v2_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
mv /benchmarks/cifar10_resnet44_v2_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
mv /benchmarks/cifar10_resnet44_v2_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
mv /benchmarks/cifar10_resnet44_v2_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch32_w1.pbtxt 2> cifar10_resnet56_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch32_w2.pbtxt 2> cifar10_resnet56_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/cifar10_resnet56_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/cifar10_resnet56_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/cifar10_resnet56_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/cifar10_resnet56_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
mv cifar10_resnet56_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
mv cifar10_resnet56_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
mv cifar10_resnet56_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
mv /benchmarks/cifar10_resnet56_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
mv /benchmarks/cifar10_resnet56_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
mv /benchmarks/cifar10_resnet56_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch64_w1.pbtxt 2> cifar10_resnet56_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch64_w2.pbtxt 2> cifar10_resnet56_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/cifar10_resnet56_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/cifar10_resnet56_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/cifar10_resnet56_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/cifar10_resnet56_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
mv cifar10_resnet56_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
mv cifar10_resnet56_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
mv cifar10_resnet56_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
mv /benchmarks/cifar10_resnet56_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
mv /benchmarks/cifar10_resnet56_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
mv /benchmarks/cifar10_resnet56_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch128_w1.pbtxt 2> cifar10_resnet56_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch128_w2.pbtxt 2> cifar10_resnet56_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/cifar10_resnet56_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/cifar10_resnet56_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/cifar10_resnet56_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/cifar10_resnet56_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
mv cifar10_resnet56_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
mv cifar10_resnet56_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
mv cifar10_resnet56_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
mv /benchmarks/cifar10_resnet56_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
mv /benchmarks/cifar10_resnet56_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
mv /benchmarks/cifar10_resnet56_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch256_w1.pbtxt 2> cifar10_resnet56_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch256_w2.pbtxt 2> cifar10_resnet56_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/cifar10_resnet56_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/cifar10_resnet56_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/cifar10_resnet56_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/cifar10_resnet56_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
mv cifar10_resnet56_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
mv cifar10_resnet56_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
mv cifar10_resnet56_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
mv /benchmarks/cifar10_resnet56_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
mv /benchmarks/cifar10_resnet56_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
mv /benchmarks/cifar10_resnet56_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch512_w1.pbtxt 2> cifar10_resnet56_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch512_w2.pbtxt 2> cifar10_resnet56_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/cifar10_resnet56_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/cifar10_resnet56_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/cifar10_resnet56_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/cifar10_resnet56_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
mv cifar10_resnet56_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
mv cifar10_resnet56_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
mv cifar10_resnet56_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
mv /benchmarks/cifar10_resnet56_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
mv /benchmarks/cifar10_resnet56_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
mv /benchmarks/cifar10_resnet56_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_use_fp16_w1.pbtxt 2> cifar10_resnet56_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_use_fp16_w2.pbtxt 2> cifar10_resnet56_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/cifar10_resnet56_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/cifar10_resnet56_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/cifar10_resnet56_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/cifar10_resnet56_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
mv cifar10_resnet56_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
mv cifar10_resnet56_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
mv cifar10_resnet56_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
mv /benchmarks/cifar10_resnet56_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
mv /benchmarks/cifar10_resnet56_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
mv /benchmarks/cifar10_resnet56_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_optMomentum_w1.pbtxt 2> cifar10_resnet56_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_optMomentum_w2.pbtxt 2> cifar10_resnet56_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/cifar10_resnet56_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/cifar10_resnet56_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/cifar10_resnet56_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/cifar10_resnet56_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
mv cifar10_resnet56_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
mv cifar10_resnet56_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
mv cifar10_resnet56_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
mv /benchmarks/cifar10_resnet56_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
mv /benchmarks/cifar10_resnet56_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
mv /benchmarks/cifar10_resnet56_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet56_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet56_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/cifar10_resnet56_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/cifar10_resnet56_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/cifar10_resnet56_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/cifar10_resnet56_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
mv cifar10_resnet56_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
mv cifar10_resnet56_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
mv cifar10_resnet56_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
mv /benchmarks/cifar10_resnet56_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
mv /benchmarks/cifar10_resnet56_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
mv /benchmarks/cifar10_resnet56_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_dataFormat_w1.pbtxt 2> cifar10_resnet56_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_dataFormat_w2.pbtxt 2> cifar10_resnet56_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/cifar10_resnet56_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/cifar10_resnet56_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/cifar10_resnet56_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/cifar10_resnet56_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
mv cifar10_resnet56_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
mv cifar10_resnet56_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
mv cifar10_resnet56_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
mv /benchmarks/cifar10_resnet56_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
mv /benchmarks/cifar10_resnet56_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
mv /benchmarks/cifar10_resnet56_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_winograd_w1.pbtxt 2> cifar10_resnet56_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_winograd_w2.pbtxt 2> cifar10_resnet56_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/cifar10_resnet56_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/cifar10_resnet56_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/cifar10_resnet56_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/cifar10_resnet56_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
mv cifar10_resnet56_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
mv cifar10_resnet56_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
mv cifar10_resnet56_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
mv /benchmarks/cifar10_resnet56_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
mv /benchmarks/cifar10_resnet56_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
mv /benchmarks/cifar10_resnet56_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_xla_w1.pbtxt 2> cifar10_resnet56_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_xla_w2.pbtxt 2> cifar10_resnet56_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/cifar10_resnet56_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/cifar10_resnet56_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/cifar10_resnet56_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/cifar10_resnet56_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
mv cifar10_resnet56_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
mv cifar10_resnet56_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
mv cifar10_resnet56_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
mv /benchmarks/cifar10_resnet56_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
mv /benchmarks/cifar10_resnet56_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
mv /benchmarks/cifar10_resnet56_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_batch32_w1.pbtxt 2> cifar10_resnet56_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_batch32_w2.pbtxt 2> cifar10_resnet56_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/cifar10_resnet56_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/cifar10_resnet56_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/cifar10_resnet56_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/cifar10_resnet56_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
mv cifar10_resnet56_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
mv cifar10_resnet56_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
mv cifar10_resnet56_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
mv /benchmarks/cifar10_resnet56_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
mv /benchmarks/cifar10_resnet56_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
mv /benchmarks/cifar10_resnet56_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_batch64_w1.pbtxt 2> cifar10_resnet56_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_batch64_w2.pbtxt 2> cifar10_resnet56_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/cifar10_resnet56_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/cifar10_resnet56_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/cifar10_resnet56_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/cifar10_resnet56_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
mv cifar10_resnet56_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
mv cifar10_resnet56_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
mv cifar10_resnet56_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
mv /benchmarks/cifar10_resnet56_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
mv /benchmarks/cifar10_resnet56_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
mv /benchmarks/cifar10_resnet56_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_batch128_w1.pbtxt 2> cifar10_resnet56_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_batch128_w2.pbtxt 2> cifar10_resnet56_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/cifar10_resnet56_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/cifar10_resnet56_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/cifar10_resnet56_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/cifar10_resnet56_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
mv cifar10_resnet56_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
mv cifar10_resnet56_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
mv cifar10_resnet56_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
mv /benchmarks/cifar10_resnet56_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
mv /benchmarks/cifar10_resnet56_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
mv /benchmarks/cifar10_resnet56_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_batch256_w1.pbtxt 2> cifar10_resnet56_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_batch256_w2.pbtxt 2> cifar10_resnet56_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/cifar10_resnet56_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/cifar10_resnet56_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/cifar10_resnet56_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/cifar10_resnet56_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
mv cifar10_resnet56_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
mv cifar10_resnet56_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
mv cifar10_resnet56_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
mv /benchmarks/cifar10_resnet56_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
mv /benchmarks/cifar10_resnet56_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
mv /benchmarks/cifar10_resnet56_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_batch512_w1.pbtxt 2> cifar10_resnet56_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_batch512_w2.pbtxt 2> cifar10_resnet56_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/cifar10_resnet56_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/cifar10_resnet56_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/cifar10_resnet56_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/cifar10_resnet56_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
mv cifar10_resnet56_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
mv cifar10_resnet56_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
mv cifar10_resnet56_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
mv /benchmarks/cifar10_resnet56_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
mv /benchmarks/cifar10_resnet56_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
mv /benchmarks/cifar10_resnet56_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_use_fp16_w1.pbtxt 2> cifar10_resnet56_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_use_fp16_w2.pbtxt 2> cifar10_resnet56_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/cifar10_resnet56_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/cifar10_resnet56_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/cifar10_resnet56_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/cifar10_resnet56_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
mv cifar10_resnet56_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
mv cifar10_resnet56_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
mv cifar10_resnet56_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
mv /benchmarks/cifar10_resnet56_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
mv /benchmarks/cifar10_resnet56_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
mv /benchmarks/cifar10_resnet56_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_optMomentum_w1.pbtxt 2> cifar10_resnet56_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_optMomentum_w2.pbtxt 2> cifar10_resnet56_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/cifar10_resnet56_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/cifar10_resnet56_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/cifar10_resnet56_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/cifar10_resnet56_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
mv cifar10_resnet56_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
mv cifar10_resnet56_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
mv cifar10_resnet56_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
mv /benchmarks/cifar10_resnet56_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
mv /benchmarks/cifar10_resnet56_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
mv /benchmarks/cifar10_resnet56_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_optRmsprop_w1.pbtxt 2> cifar10_resnet56_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_optRmsprop_w2.pbtxt 2> cifar10_resnet56_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/cifar10_resnet56_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/cifar10_resnet56_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/cifar10_resnet56_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/cifar10_resnet56_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
mv cifar10_resnet56_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
mv cifar10_resnet56_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
mv cifar10_resnet56_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
mv /benchmarks/cifar10_resnet56_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
mv /benchmarks/cifar10_resnet56_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
mv /benchmarks/cifar10_resnet56_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_dataFormat_w1.pbtxt 2> cifar10_resnet56_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_dataFormat_w2.pbtxt 2> cifar10_resnet56_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/cifar10_resnet56_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/cifar10_resnet56_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/cifar10_resnet56_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/cifar10_resnet56_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
mv cifar10_resnet56_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
mv cifar10_resnet56_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
mv cifar10_resnet56_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
mv /benchmarks/cifar10_resnet56_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
mv /benchmarks/cifar10_resnet56_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
mv /benchmarks/cifar10_resnet56_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_winograd_w1.pbtxt 2> cifar10_resnet56_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_winograd_w2.pbtxt 2> cifar10_resnet56_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/cifar10_resnet56_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/cifar10_resnet56_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/cifar10_resnet56_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/cifar10_resnet56_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
mv cifar10_resnet56_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
mv cifar10_resnet56_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
mv cifar10_resnet56_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
mv /benchmarks/cifar10_resnet56_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
mv /benchmarks/cifar10_resnet56_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
mv /benchmarks/cifar10_resnet56_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_xla_w1.pbtxt 2> cifar10_resnet56_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_xla_w2.pbtxt 2> cifar10_resnet56_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/cifar10_resnet56_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/cifar10_resnet56_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/cifar10_resnet56_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/cifar10_resnet56_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
mv cifar10_resnet56_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
mv cifar10_resnet56_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
mv cifar10_resnet56_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
mv /benchmarks/cifar10_resnet56_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
mv /benchmarks/cifar10_resnet56_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
mv /benchmarks/cifar10_resnet56_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch32_w1.pbtxt 2> cifar10_resnet56_v2_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch32_w2.pbtxt 2> cifar10_resnet56_v2_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/cifar10_resnet56_v2_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/cifar10_resnet56_v2_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/cifar10_resnet56_v2_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/cifar10_resnet56_v2_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
mv cifar10_resnet56_v2_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
mv cifar10_resnet56_v2_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
mv cifar10_resnet56_v2_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
mv /benchmarks/cifar10_resnet56_v2_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
mv /benchmarks/cifar10_resnet56_v2_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
mv /benchmarks/cifar10_resnet56_v2_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch64_w1.pbtxt 2> cifar10_resnet56_v2_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch64_w2.pbtxt 2> cifar10_resnet56_v2_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/cifar10_resnet56_v2_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/cifar10_resnet56_v2_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/cifar10_resnet56_v2_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/cifar10_resnet56_v2_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
mv cifar10_resnet56_v2_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
mv cifar10_resnet56_v2_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
mv cifar10_resnet56_v2_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
mv /benchmarks/cifar10_resnet56_v2_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
mv /benchmarks/cifar10_resnet56_v2_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
mv /benchmarks/cifar10_resnet56_v2_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch128_w1.pbtxt 2> cifar10_resnet56_v2_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch128_w2.pbtxt 2> cifar10_resnet56_v2_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/cifar10_resnet56_v2_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/cifar10_resnet56_v2_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/cifar10_resnet56_v2_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/cifar10_resnet56_v2_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
mv cifar10_resnet56_v2_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
mv cifar10_resnet56_v2_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
mv cifar10_resnet56_v2_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
mv /benchmarks/cifar10_resnet56_v2_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
mv /benchmarks/cifar10_resnet56_v2_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
mv /benchmarks/cifar10_resnet56_v2_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch256_w1.pbtxt 2> cifar10_resnet56_v2_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch256_w2.pbtxt 2> cifar10_resnet56_v2_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/cifar10_resnet56_v2_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/cifar10_resnet56_v2_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/cifar10_resnet56_v2_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/cifar10_resnet56_v2_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
mv cifar10_resnet56_v2_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
mv cifar10_resnet56_v2_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
mv cifar10_resnet56_v2_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
mv /benchmarks/cifar10_resnet56_v2_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
mv /benchmarks/cifar10_resnet56_v2_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
mv /benchmarks/cifar10_resnet56_v2_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch512_w1.pbtxt 2> cifar10_resnet56_v2_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch512_w2.pbtxt 2> cifar10_resnet56_v2_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/cifar10_resnet56_v2_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/cifar10_resnet56_v2_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/cifar10_resnet56_v2_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/cifar10_resnet56_v2_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
mv cifar10_resnet56_v2_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
mv cifar10_resnet56_v2_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
mv cifar10_resnet56_v2_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
mv /benchmarks/cifar10_resnet56_v2_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
mv /benchmarks/cifar10_resnet56_v2_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
mv /benchmarks/cifar10_resnet56_v2_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_use_fp16_w1.pbtxt 2> cifar10_resnet56_v2_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_use_fp16_w2.pbtxt 2> cifar10_resnet56_v2_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/cifar10_resnet56_v2_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/cifar10_resnet56_v2_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/cifar10_resnet56_v2_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/cifar10_resnet56_v2_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
mv cifar10_resnet56_v2_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
mv cifar10_resnet56_v2_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
mv cifar10_resnet56_v2_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet56_v2_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet56_v2_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet56_v2_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_optMomentum_w1.pbtxt 2> cifar10_resnet56_v2_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_optMomentum_w2.pbtxt 2> cifar10_resnet56_v2_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/cifar10_resnet56_v2_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/cifar10_resnet56_v2_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/cifar10_resnet56_v2_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/cifar10_resnet56_v2_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
mv cifar10_resnet56_v2_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
mv cifar10_resnet56_v2_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
mv cifar10_resnet56_v2_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet56_v2_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet56_v2_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet56_v2_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet56_v2_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet56_v2_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/cifar10_resnet56_v2_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/cifar10_resnet56_v2_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/cifar10_resnet56_v2_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/cifar10_resnet56_v2_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
mv cifar10_resnet56_v2_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
mv cifar10_resnet56_v2_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
mv cifar10_resnet56_v2_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_dataFormat_w1.pbtxt 2> cifar10_resnet56_v2_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_dataFormat_w2.pbtxt 2> cifar10_resnet56_v2_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/cifar10_resnet56_v2_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/cifar10_resnet56_v2_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/cifar10_resnet56_v2_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/cifar10_resnet56_v2_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
mv cifar10_resnet56_v2_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
mv cifar10_resnet56_v2_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
mv cifar10_resnet56_v2_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet56_v2_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet56_v2_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet56_v2_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_winograd_w1.pbtxt 2> cifar10_resnet56_v2_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_winograd_w2.pbtxt 2> cifar10_resnet56_v2_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/cifar10_resnet56_v2_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/cifar10_resnet56_v2_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/cifar10_resnet56_v2_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/cifar10_resnet56_v2_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
mv cifar10_resnet56_v2_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
mv cifar10_resnet56_v2_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
mv cifar10_resnet56_v2_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
mv /benchmarks/cifar10_resnet56_v2_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
mv /benchmarks/cifar10_resnet56_v2_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
mv /benchmarks/cifar10_resnet56_v2_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_xla_w1.pbtxt 2> cifar10_resnet56_v2_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_xla_w2.pbtxt 2> cifar10_resnet56_v2_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/cifar10_resnet56_v2_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/cifar10_resnet56_v2_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/cifar10_resnet56_v2_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/cifar10_resnet56_v2_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
mv cifar10_resnet56_v2_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
mv cifar10_resnet56_v2_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
mv cifar10_resnet56_v2_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
mv /benchmarks/cifar10_resnet56_v2_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
mv /benchmarks/cifar10_resnet56_v2_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
mv /benchmarks/cifar10_resnet56_v2_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch32_w1.pbtxt 2> cifar10_resnet56_v2_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch32_w2.pbtxt 2> cifar10_resnet56_v2_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/cifar10_resnet56_v2_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/cifar10_resnet56_v2_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/cifar10_resnet56_v2_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/cifar10_resnet56_v2_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
mv cifar10_resnet56_v2_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
mv cifar10_resnet56_v2_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
mv cifar10_resnet56_v2_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
mv /benchmarks/cifar10_resnet56_v2_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
mv /benchmarks/cifar10_resnet56_v2_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
mv /benchmarks/cifar10_resnet56_v2_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch64_w1.pbtxt 2> cifar10_resnet56_v2_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch64_w2.pbtxt 2> cifar10_resnet56_v2_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/cifar10_resnet56_v2_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/cifar10_resnet56_v2_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/cifar10_resnet56_v2_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/cifar10_resnet56_v2_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
mv cifar10_resnet56_v2_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
mv cifar10_resnet56_v2_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
mv cifar10_resnet56_v2_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
mv /benchmarks/cifar10_resnet56_v2_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
mv /benchmarks/cifar10_resnet56_v2_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
mv /benchmarks/cifar10_resnet56_v2_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch128_w1.pbtxt 2> cifar10_resnet56_v2_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch128_w2.pbtxt 2> cifar10_resnet56_v2_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/cifar10_resnet56_v2_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/cifar10_resnet56_v2_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/cifar10_resnet56_v2_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/cifar10_resnet56_v2_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
mv cifar10_resnet56_v2_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
mv cifar10_resnet56_v2_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
mv cifar10_resnet56_v2_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
mv /benchmarks/cifar10_resnet56_v2_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
mv /benchmarks/cifar10_resnet56_v2_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
mv /benchmarks/cifar10_resnet56_v2_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch256_w1.pbtxt 2> cifar10_resnet56_v2_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch256_w2.pbtxt 2> cifar10_resnet56_v2_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/cifar10_resnet56_v2_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/cifar10_resnet56_v2_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/cifar10_resnet56_v2_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/cifar10_resnet56_v2_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
mv cifar10_resnet56_v2_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
mv cifar10_resnet56_v2_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
mv cifar10_resnet56_v2_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
mv /benchmarks/cifar10_resnet56_v2_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
mv /benchmarks/cifar10_resnet56_v2_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
mv /benchmarks/cifar10_resnet56_v2_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch512_w1.pbtxt 2> cifar10_resnet56_v2_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch512_w2.pbtxt 2> cifar10_resnet56_v2_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/cifar10_resnet56_v2_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/cifar10_resnet56_v2_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/cifar10_resnet56_v2_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/cifar10_resnet56_v2_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
mv cifar10_resnet56_v2_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
mv cifar10_resnet56_v2_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
mv cifar10_resnet56_v2_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
mv /benchmarks/cifar10_resnet56_v2_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
mv /benchmarks/cifar10_resnet56_v2_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
mv /benchmarks/cifar10_resnet56_v2_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_use_fp16_w1.pbtxt 2> cifar10_resnet56_v2_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_use_fp16_w2.pbtxt 2> cifar10_resnet56_v2_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/cifar10_resnet56_v2_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/cifar10_resnet56_v2_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/cifar10_resnet56_v2_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/cifar10_resnet56_v2_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
mv cifar10_resnet56_v2_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
mv cifar10_resnet56_v2_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
mv cifar10_resnet56_v2_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet56_v2_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet56_v2_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet56_v2_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_optMomentum_w1.pbtxt 2> cifar10_resnet56_v2_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_optMomentum_w2.pbtxt 2> cifar10_resnet56_v2_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/cifar10_resnet56_v2_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/cifar10_resnet56_v2_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/cifar10_resnet56_v2_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/cifar10_resnet56_v2_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
mv cifar10_resnet56_v2_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
mv cifar10_resnet56_v2_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
mv cifar10_resnet56_v2_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet56_v2_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet56_v2_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet56_v2_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_optRmsprop_w1.pbtxt 2> cifar10_resnet56_v2_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_optRmsprop_w2.pbtxt 2> cifar10_resnet56_v2_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/cifar10_resnet56_v2_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/cifar10_resnet56_v2_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/cifar10_resnet56_v2_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/cifar10_resnet56_v2_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
mv cifar10_resnet56_v2_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
mv cifar10_resnet56_v2_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
mv cifar10_resnet56_v2_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet56_v2_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet56_v2_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet56_v2_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_dataFormat_w1.pbtxt 2> cifar10_resnet56_v2_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_dataFormat_w2.pbtxt 2> cifar10_resnet56_v2_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/cifar10_resnet56_v2_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/cifar10_resnet56_v2_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/cifar10_resnet56_v2_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/cifar10_resnet56_v2_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
mv cifar10_resnet56_v2_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
mv cifar10_resnet56_v2_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
mv cifar10_resnet56_v2_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet56_v2_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet56_v2_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet56_v2_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_winograd_w1.pbtxt 2> cifar10_resnet56_v2_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_winograd_w2.pbtxt 2> cifar10_resnet56_v2_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/cifar10_resnet56_v2_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/cifar10_resnet56_v2_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/cifar10_resnet56_v2_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/cifar10_resnet56_v2_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
mv cifar10_resnet56_v2_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
mv cifar10_resnet56_v2_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
mv cifar10_resnet56_v2_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
mv /benchmarks/cifar10_resnet56_v2_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
mv /benchmarks/cifar10_resnet56_v2_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
mv /benchmarks/cifar10_resnet56_v2_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_xla_w1.pbtxt 2> cifar10_resnet56_v2_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_xla_w2.pbtxt 2> cifar10_resnet56_v2_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/cifar10_resnet56_v2_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/cifar10_resnet56_v2_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/cifar10_resnet56_v2_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/cifar10_resnet56_v2_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
mv cifar10_resnet56_v2_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
mv cifar10_resnet56_v2_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
mv cifar10_resnet56_v2_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
mv /benchmarks/cifar10_resnet56_v2_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
mv /benchmarks/cifar10_resnet56_v2_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
mv /benchmarks/cifar10_resnet56_v2_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch32_w1.pbtxt 2> cifar10_resnet110_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch32_w2.pbtxt 2> cifar10_resnet110_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/cifar10_resnet110_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/cifar10_resnet110_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/cifar10_resnet110_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/cifar10_resnet110_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
mv cifar10_resnet110_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
mv cifar10_resnet110_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
mv cifar10_resnet110_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
mv /benchmarks/cifar10_resnet110_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
mv /benchmarks/cifar10_resnet110_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
mv /benchmarks/cifar10_resnet110_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch64_w1.pbtxt 2> cifar10_resnet110_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch64_w2.pbtxt 2> cifar10_resnet110_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/cifar10_resnet110_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/cifar10_resnet110_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/cifar10_resnet110_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/cifar10_resnet110_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
mv cifar10_resnet110_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
mv cifar10_resnet110_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
mv cifar10_resnet110_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
mv /benchmarks/cifar10_resnet110_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
mv /benchmarks/cifar10_resnet110_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
mv /benchmarks/cifar10_resnet110_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch128_w1.pbtxt 2> cifar10_resnet110_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch128_w2.pbtxt 2> cifar10_resnet110_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/cifar10_resnet110_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/cifar10_resnet110_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/cifar10_resnet110_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/cifar10_resnet110_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
mv cifar10_resnet110_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
mv cifar10_resnet110_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
mv cifar10_resnet110_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
mv /benchmarks/cifar10_resnet110_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
mv /benchmarks/cifar10_resnet110_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
mv /benchmarks/cifar10_resnet110_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch256_w1.pbtxt 2> cifar10_resnet110_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch256_w2.pbtxt 2> cifar10_resnet110_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/cifar10_resnet110_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/cifar10_resnet110_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/cifar10_resnet110_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/cifar10_resnet110_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
mv cifar10_resnet110_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
mv cifar10_resnet110_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
mv cifar10_resnet110_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
mv /benchmarks/cifar10_resnet110_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
mv /benchmarks/cifar10_resnet110_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
mv /benchmarks/cifar10_resnet110_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch512_w1.pbtxt 2> cifar10_resnet110_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch512_w2.pbtxt 2> cifar10_resnet110_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/cifar10_resnet110_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/cifar10_resnet110_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/cifar10_resnet110_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/cifar10_resnet110_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
mv cifar10_resnet110_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
mv cifar10_resnet110_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
mv cifar10_resnet110_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
mv /benchmarks/cifar10_resnet110_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
mv /benchmarks/cifar10_resnet110_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
mv /benchmarks/cifar10_resnet110_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_use_fp16_w1.pbtxt 2> cifar10_resnet110_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_use_fp16_w2.pbtxt 2> cifar10_resnet110_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/cifar10_resnet110_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/cifar10_resnet110_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/cifar10_resnet110_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/cifar10_resnet110_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
mv cifar10_resnet110_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
mv cifar10_resnet110_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
mv cifar10_resnet110_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
mv /benchmarks/cifar10_resnet110_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
mv /benchmarks/cifar10_resnet110_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
mv /benchmarks/cifar10_resnet110_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_optMomentum_w1.pbtxt 2> cifar10_resnet110_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_optMomentum_w2.pbtxt 2> cifar10_resnet110_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/cifar10_resnet110_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/cifar10_resnet110_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/cifar10_resnet110_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/cifar10_resnet110_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
mv cifar10_resnet110_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
mv cifar10_resnet110_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
mv cifar10_resnet110_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
mv /benchmarks/cifar10_resnet110_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
mv /benchmarks/cifar10_resnet110_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
mv /benchmarks/cifar10_resnet110_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet110_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet110_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/cifar10_resnet110_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/cifar10_resnet110_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/cifar10_resnet110_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/cifar10_resnet110_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
mv cifar10_resnet110_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
mv cifar10_resnet110_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
mv cifar10_resnet110_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
mv /benchmarks/cifar10_resnet110_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
mv /benchmarks/cifar10_resnet110_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
mv /benchmarks/cifar10_resnet110_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_dataFormat_w1.pbtxt 2> cifar10_resnet110_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_dataFormat_w2.pbtxt 2> cifar10_resnet110_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/cifar10_resnet110_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/cifar10_resnet110_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/cifar10_resnet110_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/cifar10_resnet110_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
mv cifar10_resnet110_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
mv cifar10_resnet110_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
mv cifar10_resnet110_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
mv /benchmarks/cifar10_resnet110_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
mv /benchmarks/cifar10_resnet110_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
mv /benchmarks/cifar10_resnet110_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_winograd_w1.pbtxt 2> cifar10_resnet110_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_winograd_w2.pbtxt 2> cifar10_resnet110_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/cifar10_resnet110_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/cifar10_resnet110_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/cifar10_resnet110_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/cifar10_resnet110_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
mv cifar10_resnet110_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
mv cifar10_resnet110_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
mv cifar10_resnet110_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
mv /benchmarks/cifar10_resnet110_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
mv /benchmarks/cifar10_resnet110_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
mv /benchmarks/cifar10_resnet110_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_xla_w1.pbtxt 2> cifar10_resnet110_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_xla_w2.pbtxt 2> cifar10_resnet110_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/cifar10_resnet110_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/cifar10_resnet110_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/cifar10_resnet110_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/cifar10_resnet110_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
mv cifar10_resnet110_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
mv cifar10_resnet110_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
mv cifar10_resnet110_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
mv /benchmarks/cifar10_resnet110_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
mv /benchmarks/cifar10_resnet110_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
mv /benchmarks/cifar10_resnet110_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_batch32_w1.pbtxt 2> cifar10_resnet110_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_batch32_w2.pbtxt 2> cifar10_resnet110_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/cifar10_resnet110_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/cifar10_resnet110_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/cifar10_resnet110_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/cifar10_resnet110_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
mv cifar10_resnet110_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
mv cifar10_resnet110_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
mv cifar10_resnet110_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
mv /benchmarks/cifar10_resnet110_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
mv /benchmarks/cifar10_resnet110_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
mv /benchmarks/cifar10_resnet110_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_batch64_w1.pbtxt 2> cifar10_resnet110_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_batch64_w2.pbtxt 2> cifar10_resnet110_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/cifar10_resnet110_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/cifar10_resnet110_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/cifar10_resnet110_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/cifar10_resnet110_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
mv cifar10_resnet110_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
mv cifar10_resnet110_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
mv cifar10_resnet110_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
mv /benchmarks/cifar10_resnet110_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
mv /benchmarks/cifar10_resnet110_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
mv /benchmarks/cifar10_resnet110_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_batch128_w1.pbtxt 2> cifar10_resnet110_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_batch128_w2.pbtxt 2> cifar10_resnet110_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/cifar10_resnet110_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/cifar10_resnet110_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/cifar10_resnet110_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/cifar10_resnet110_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
mv cifar10_resnet110_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
mv cifar10_resnet110_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
mv cifar10_resnet110_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
mv /benchmarks/cifar10_resnet110_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
mv /benchmarks/cifar10_resnet110_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
mv /benchmarks/cifar10_resnet110_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_batch256_w1.pbtxt 2> cifar10_resnet110_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_batch256_w2.pbtxt 2> cifar10_resnet110_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/cifar10_resnet110_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/cifar10_resnet110_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/cifar10_resnet110_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/cifar10_resnet110_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
mv cifar10_resnet110_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
mv cifar10_resnet110_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
mv cifar10_resnet110_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
mv /benchmarks/cifar10_resnet110_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
mv /benchmarks/cifar10_resnet110_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
mv /benchmarks/cifar10_resnet110_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_batch512_w1.pbtxt 2> cifar10_resnet110_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_batch512_w2.pbtxt 2> cifar10_resnet110_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/cifar10_resnet110_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/cifar10_resnet110_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/cifar10_resnet110_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/cifar10_resnet110_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
mv cifar10_resnet110_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
mv cifar10_resnet110_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
mv cifar10_resnet110_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
mv /benchmarks/cifar10_resnet110_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
mv /benchmarks/cifar10_resnet110_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
mv /benchmarks/cifar10_resnet110_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_use_fp16_w1.pbtxt 2> cifar10_resnet110_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_use_fp16_w2.pbtxt 2> cifar10_resnet110_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/cifar10_resnet110_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/cifar10_resnet110_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/cifar10_resnet110_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/cifar10_resnet110_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
mv cifar10_resnet110_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
mv cifar10_resnet110_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
mv cifar10_resnet110_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
mv /benchmarks/cifar10_resnet110_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
mv /benchmarks/cifar10_resnet110_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
mv /benchmarks/cifar10_resnet110_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_optMomentum_w1.pbtxt 2> cifar10_resnet110_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_optMomentum_w2.pbtxt 2> cifar10_resnet110_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/cifar10_resnet110_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/cifar10_resnet110_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/cifar10_resnet110_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/cifar10_resnet110_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
mv cifar10_resnet110_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
mv cifar10_resnet110_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
mv cifar10_resnet110_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
mv /benchmarks/cifar10_resnet110_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
mv /benchmarks/cifar10_resnet110_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
mv /benchmarks/cifar10_resnet110_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_optRmsprop_w1.pbtxt 2> cifar10_resnet110_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_optRmsprop_w2.pbtxt 2> cifar10_resnet110_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/cifar10_resnet110_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/cifar10_resnet110_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/cifar10_resnet110_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/cifar10_resnet110_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
mv cifar10_resnet110_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
mv cifar10_resnet110_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
mv cifar10_resnet110_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
mv /benchmarks/cifar10_resnet110_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
mv /benchmarks/cifar10_resnet110_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
mv /benchmarks/cifar10_resnet110_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_dataFormat_w1.pbtxt 2> cifar10_resnet110_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_dataFormat_w2.pbtxt 2> cifar10_resnet110_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/cifar10_resnet110_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/cifar10_resnet110_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/cifar10_resnet110_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/cifar10_resnet110_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
mv cifar10_resnet110_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
mv cifar10_resnet110_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
mv cifar10_resnet110_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
mv /benchmarks/cifar10_resnet110_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
mv /benchmarks/cifar10_resnet110_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
mv /benchmarks/cifar10_resnet110_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_winograd_w1.pbtxt 2> cifar10_resnet110_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_winograd_w2.pbtxt 2> cifar10_resnet110_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/cifar10_resnet110_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/cifar10_resnet110_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/cifar10_resnet110_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/cifar10_resnet110_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
mv cifar10_resnet110_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
mv cifar10_resnet110_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
mv cifar10_resnet110_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
mv /benchmarks/cifar10_resnet110_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
mv /benchmarks/cifar10_resnet110_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
mv /benchmarks/cifar10_resnet110_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_xla_w1.pbtxt 2> cifar10_resnet110_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_xla_w2.pbtxt 2> cifar10_resnet110_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/cifar10_resnet110_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/cifar10_resnet110_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/cifar10_resnet110_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/cifar10_resnet110_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
mv cifar10_resnet110_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
mv cifar10_resnet110_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
mv cifar10_resnet110_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
mv /benchmarks/cifar10_resnet110_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
mv /benchmarks/cifar10_resnet110_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
mv /benchmarks/cifar10_resnet110_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch32_w1.pbtxt 2> cifar10_resnet110_v2_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch32_w2.pbtxt 2> cifar10_resnet110_v2_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/cifar10_resnet110_v2_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/cifar10_resnet110_v2_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/cifar10_resnet110_v2_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/cifar10_resnet110_v2_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
mv cifar10_resnet110_v2_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
mv cifar10_resnet110_v2_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
mv cifar10_resnet110_v2_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
mv /benchmarks/cifar10_resnet110_v2_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
mv /benchmarks/cifar10_resnet110_v2_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
mv /benchmarks/cifar10_resnet110_v2_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch64_w1.pbtxt 2> cifar10_resnet110_v2_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch64_w2.pbtxt 2> cifar10_resnet110_v2_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/cifar10_resnet110_v2_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/cifar10_resnet110_v2_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/cifar10_resnet110_v2_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/cifar10_resnet110_v2_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
mv cifar10_resnet110_v2_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
mv cifar10_resnet110_v2_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
mv cifar10_resnet110_v2_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
mv /benchmarks/cifar10_resnet110_v2_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
mv /benchmarks/cifar10_resnet110_v2_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
mv /benchmarks/cifar10_resnet110_v2_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch128_w1.pbtxt 2> cifar10_resnet110_v2_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch128_w2.pbtxt 2> cifar10_resnet110_v2_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/cifar10_resnet110_v2_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/cifar10_resnet110_v2_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/cifar10_resnet110_v2_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/cifar10_resnet110_v2_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
mv cifar10_resnet110_v2_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
mv cifar10_resnet110_v2_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
mv cifar10_resnet110_v2_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
mv /benchmarks/cifar10_resnet110_v2_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
mv /benchmarks/cifar10_resnet110_v2_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
mv /benchmarks/cifar10_resnet110_v2_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch256_w1.pbtxt 2> cifar10_resnet110_v2_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch256_w2.pbtxt 2> cifar10_resnet110_v2_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/cifar10_resnet110_v2_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/cifar10_resnet110_v2_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/cifar10_resnet110_v2_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/cifar10_resnet110_v2_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
mv cifar10_resnet110_v2_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
mv cifar10_resnet110_v2_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
mv cifar10_resnet110_v2_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
mv /benchmarks/cifar10_resnet110_v2_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
mv /benchmarks/cifar10_resnet110_v2_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
mv /benchmarks/cifar10_resnet110_v2_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch512_w1.pbtxt 2> cifar10_resnet110_v2_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch512_w2.pbtxt 2> cifar10_resnet110_v2_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/cifar10_resnet110_v2_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/cifar10_resnet110_v2_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/cifar10_resnet110_v2_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/cifar10_resnet110_v2_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
mv cifar10_resnet110_v2_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
mv cifar10_resnet110_v2_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
mv cifar10_resnet110_v2_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
mv /benchmarks/cifar10_resnet110_v2_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
mv /benchmarks/cifar10_resnet110_v2_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
mv /benchmarks/cifar10_resnet110_v2_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_use_fp16_w1.pbtxt 2> cifar10_resnet110_v2_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_use_fp16_w2.pbtxt 2> cifar10_resnet110_v2_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/cifar10_resnet110_v2_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/cifar10_resnet110_v2_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/cifar10_resnet110_v2_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/cifar10_resnet110_v2_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
mv cifar10_resnet110_v2_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
mv cifar10_resnet110_v2_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
mv cifar10_resnet110_v2_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet110_v2_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet110_v2_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet110_v2_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_optMomentum_w1.pbtxt 2> cifar10_resnet110_v2_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_optMomentum_w2.pbtxt 2> cifar10_resnet110_v2_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/cifar10_resnet110_v2_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/cifar10_resnet110_v2_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/cifar10_resnet110_v2_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/cifar10_resnet110_v2_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
mv cifar10_resnet110_v2_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
mv cifar10_resnet110_v2_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
mv cifar10_resnet110_v2_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet110_v2_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet110_v2_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet110_v2_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet110_v2_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet110_v2_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/cifar10_resnet110_v2_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/cifar10_resnet110_v2_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/cifar10_resnet110_v2_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/cifar10_resnet110_v2_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
mv cifar10_resnet110_v2_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
mv cifar10_resnet110_v2_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
mv cifar10_resnet110_v2_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_dataFormat_w1.pbtxt 2> cifar10_resnet110_v2_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_dataFormat_w2.pbtxt 2> cifar10_resnet110_v2_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/cifar10_resnet110_v2_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/cifar10_resnet110_v2_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/cifar10_resnet110_v2_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/cifar10_resnet110_v2_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
mv cifar10_resnet110_v2_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
mv cifar10_resnet110_v2_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
mv cifar10_resnet110_v2_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet110_v2_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet110_v2_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet110_v2_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_winograd_w1.pbtxt 2> cifar10_resnet110_v2_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_winograd_w2.pbtxt 2> cifar10_resnet110_v2_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/cifar10_resnet110_v2_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/cifar10_resnet110_v2_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/cifar10_resnet110_v2_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/cifar10_resnet110_v2_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
mv cifar10_resnet110_v2_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
mv cifar10_resnet110_v2_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
mv cifar10_resnet110_v2_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
mv /benchmarks/cifar10_resnet110_v2_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
mv /benchmarks/cifar10_resnet110_v2_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
mv /benchmarks/cifar10_resnet110_v2_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_xla_w1.pbtxt 2> cifar10_resnet110_v2_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_xla_w2.pbtxt 2> cifar10_resnet110_v2_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/cifar10_resnet110_v2_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/cifar10_resnet110_v2_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/cifar10_resnet110_v2_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/cifar10_resnet110_v2_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
mv cifar10_resnet110_v2_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
mv cifar10_resnet110_v2_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
mv cifar10_resnet110_v2_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
mv /benchmarks/cifar10_resnet110_v2_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
mv /benchmarks/cifar10_resnet110_v2_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
mv /benchmarks/cifar10_resnet110_v2_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch32_w1.pbtxt 2> cifar10_resnet110_v2_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch32_w2.pbtxt 2> cifar10_resnet110_v2_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/cifar10_resnet110_v2_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/cifar10_resnet110_v2_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/cifar10_resnet110_v2_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/cifar10_resnet110_v2_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
mv cifar10_resnet110_v2_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
mv cifar10_resnet110_v2_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
mv cifar10_resnet110_v2_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
mv /benchmarks/cifar10_resnet110_v2_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
mv /benchmarks/cifar10_resnet110_v2_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
mv /benchmarks/cifar10_resnet110_v2_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch64_w1.pbtxt 2> cifar10_resnet110_v2_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch64_w2.pbtxt 2> cifar10_resnet110_v2_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/cifar10_resnet110_v2_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/cifar10_resnet110_v2_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/cifar10_resnet110_v2_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/cifar10_resnet110_v2_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
mv cifar10_resnet110_v2_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
mv cifar10_resnet110_v2_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
mv cifar10_resnet110_v2_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
mv /benchmarks/cifar10_resnet110_v2_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
mv /benchmarks/cifar10_resnet110_v2_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
mv /benchmarks/cifar10_resnet110_v2_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch128_w1.pbtxt 2> cifar10_resnet110_v2_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch128_w2.pbtxt 2> cifar10_resnet110_v2_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/cifar10_resnet110_v2_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/cifar10_resnet110_v2_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/cifar10_resnet110_v2_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/cifar10_resnet110_v2_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
mv cifar10_resnet110_v2_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
mv cifar10_resnet110_v2_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
mv cifar10_resnet110_v2_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
mv /benchmarks/cifar10_resnet110_v2_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
mv /benchmarks/cifar10_resnet110_v2_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
mv /benchmarks/cifar10_resnet110_v2_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch256_w1.pbtxt 2> cifar10_resnet110_v2_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch256_w2.pbtxt 2> cifar10_resnet110_v2_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/cifar10_resnet110_v2_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/cifar10_resnet110_v2_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/cifar10_resnet110_v2_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/cifar10_resnet110_v2_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
mv cifar10_resnet110_v2_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
mv cifar10_resnet110_v2_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
mv cifar10_resnet110_v2_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
mv /benchmarks/cifar10_resnet110_v2_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
mv /benchmarks/cifar10_resnet110_v2_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
mv /benchmarks/cifar10_resnet110_v2_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch512_w1.pbtxt 2> cifar10_resnet110_v2_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch512_w2.pbtxt 2> cifar10_resnet110_v2_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/cifar10_resnet110_v2_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/cifar10_resnet110_v2_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/cifar10_resnet110_v2_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/cifar10_resnet110_v2_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
mv cifar10_resnet110_v2_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
mv cifar10_resnet110_v2_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
mv cifar10_resnet110_v2_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
mv /benchmarks/cifar10_resnet110_v2_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
mv /benchmarks/cifar10_resnet110_v2_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
mv /benchmarks/cifar10_resnet110_v2_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_use_fp16_w1.pbtxt 2> cifar10_resnet110_v2_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_use_fp16_w2.pbtxt 2> cifar10_resnet110_v2_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/cifar10_resnet110_v2_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/cifar10_resnet110_v2_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/cifar10_resnet110_v2_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/cifar10_resnet110_v2_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
mv cifar10_resnet110_v2_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
mv cifar10_resnet110_v2_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
mv cifar10_resnet110_v2_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet110_v2_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet110_v2_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet110_v2_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_optMomentum_w1.pbtxt 2> cifar10_resnet110_v2_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_optMomentum_w2.pbtxt 2> cifar10_resnet110_v2_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/cifar10_resnet110_v2_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/cifar10_resnet110_v2_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/cifar10_resnet110_v2_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/cifar10_resnet110_v2_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
mv cifar10_resnet110_v2_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
mv cifar10_resnet110_v2_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
mv cifar10_resnet110_v2_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet110_v2_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet110_v2_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet110_v2_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_optRmsprop_w1.pbtxt 2> cifar10_resnet110_v2_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_optRmsprop_w2.pbtxt 2> cifar10_resnet110_v2_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/cifar10_resnet110_v2_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/cifar10_resnet110_v2_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/cifar10_resnet110_v2_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/cifar10_resnet110_v2_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
mv cifar10_resnet110_v2_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
mv cifar10_resnet110_v2_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
mv cifar10_resnet110_v2_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet110_v2_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet110_v2_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet110_v2_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_dataFormat_w1.pbtxt 2> cifar10_resnet110_v2_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_dataFormat_w2.pbtxt 2> cifar10_resnet110_v2_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/cifar10_resnet110_v2_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/cifar10_resnet110_v2_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/cifar10_resnet110_v2_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/cifar10_resnet110_v2_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
mv cifar10_resnet110_v2_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
mv cifar10_resnet110_v2_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
mv cifar10_resnet110_v2_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet110_v2_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet110_v2_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet110_v2_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_winograd_w1.pbtxt 2> cifar10_resnet110_v2_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_winograd_w2.pbtxt 2> cifar10_resnet110_v2_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/cifar10_resnet110_v2_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/cifar10_resnet110_v2_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/cifar10_resnet110_v2_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/cifar10_resnet110_v2_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
mv cifar10_resnet110_v2_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
mv cifar10_resnet110_v2_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
mv cifar10_resnet110_v2_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
mv /benchmarks/cifar10_resnet110_v2_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
mv /benchmarks/cifar10_resnet110_v2_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
mv /benchmarks/cifar10_resnet110_v2_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_xla_w1.pbtxt 2> cifar10_resnet110_v2_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_xla_w2.pbtxt 2> cifar10_resnet110_v2_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/cifar10_resnet110_v2_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/cifar10_resnet110_v2_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/cifar10_resnet110_v2_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/cifar10_resnet110_v2_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
mv cifar10_resnet110_v2_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
mv cifar10_resnet110_v2_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
mv cifar10_resnet110_v2_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
mv /benchmarks/cifar10_resnet110_v2_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
mv /benchmarks/cifar10_resnet110_v2_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
mv /benchmarks/cifar10_resnet110_v2_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch32_w1.pbtxt 2> cifar10_alexnet_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch32_w2.pbtxt 2> cifar10_alexnet_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/cifar10_alexnet_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/cifar10_alexnet_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/cifar10_alexnet_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/cifar10_alexnet_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
mv cifar10_alexnet_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
mv cifar10_alexnet_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
mv cifar10_alexnet_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
mv /benchmarks/cifar10_alexnet_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
mv /benchmarks/cifar10_alexnet_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
mv /benchmarks/cifar10_alexnet_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch64_w1.pbtxt 2> cifar10_alexnet_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch64_w2.pbtxt 2> cifar10_alexnet_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/cifar10_alexnet_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/cifar10_alexnet_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/cifar10_alexnet_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/cifar10_alexnet_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
mv cifar10_alexnet_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
mv cifar10_alexnet_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
mv cifar10_alexnet_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
mv /benchmarks/cifar10_alexnet_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
mv /benchmarks/cifar10_alexnet_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
mv /benchmarks/cifar10_alexnet_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch128_w1.pbtxt 2> cifar10_alexnet_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch128_w2.pbtxt 2> cifar10_alexnet_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/cifar10_alexnet_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/cifar10_alexnet_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/cifar10_alexnet_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/cifar10_alexnet_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
mv cifar10_alexnet_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
mv cifar10_alexnet_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
mv cifar10_alexnet_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
mv /benchmarks/cifar10_alexnet_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
mv /benchmarks/cifar10_alexnet_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
mv /benchmarks/cifar10_alexnet_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch256_w1.pbtxt 2> cifar10_alexnet_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch256_w2.pbtxt 2> cifar10_alexnet_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/cifar10_alexnet_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/cifar10_alexnet_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/cifar10_alexnet_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/cifar10_alexnet_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
mv cifar10_alexnet_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
mv cifar10_alexnet_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
mv cifar10_alexnet_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
mv /benchmarks/cifar10_alexnet_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
mv /benchmarks/cifar10_alexnet_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
mv /benchmarks/cifar10_alexnet_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch512_w1.pbtxt 2> cifar10_alexnet_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch512_w2.pbtxt 2> cifar10_alexnet_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/cifar10_alexnet_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/cifar10_alexnet_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/cifar10_alexnet_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/cifar10_alexnet_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
mv cifar10_alexnet_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
mv cifar10_alexnet_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
mv cifar10_alexnet_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
mv /benchmarks/cifar10_alexnet_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
mv /benchmarks/cifar10_alexnet_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
mv /benchmarks/cifar10_alexnet_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_use_fp16_w1.pbtxt 2> cifar10_alexnet_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_use_fp16_w2.pbtxt 2> cifar10_alexnet_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/cifar10_alexnet_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/cifar10_alexnet_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/cifar10_alexnet_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/cifar10_alexnet_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
mv cifar10_alexnet_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
mv cifar10_alexnet_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
mv cifar10_alexnet_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
mv /benchmarks/cifar10_alexnet_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
mv /benchmarks/cifar10_alexnet_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
mv /benchmarks/cifar10_alexnet_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_optMomentum_w1.pbtxt 2> cifar10_alexnet_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_optMomentum_w2.pbtxt 2> cifar10_alexnet_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/cifar10_alexnet_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/cifar10_alexnet_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/cifar10_alexnet_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/cifar10_alexnet_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
mv cifar10_alexnet_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
mv cifar10_alexnet_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
mv cifar10_alexnet_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
mv /benchmarks/cifar10_alexnet_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
mv /benchmarks/cifar10_alexnet_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
mv /benchmarks/cifar10_alexnet_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_optRmsprop_w1.pbtxt 2> cifar10_alexnet_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_optRmsprop_w2.pbtxt 2> cifar10_alexnet_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/cifar10_alexnet_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/cifar10_alexnet_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/cifar10_alexnet_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/cifar10_alexnet_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
mv cifar10_alexnet_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
mv cifar10_alexnet_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
mv cifar10_alexnet_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
mv /benchmarks/cifar10_alexnet_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
mv /benchmarks/cifar10_alexnet_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
mv /benchmarks/cifar10_alexnet_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_dataFormat_w1.pbtxt 2> cifar10_alexnet_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_dataFormat_w2.pbtxt 2> cifar10_alexnet_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/cifar10_alexnet_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/cifar10_alexnet_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/cifar10_alexnet_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/cifar10_alexnet_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
mv cifar10_alexnet_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
mv cifar10_alexnet_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
mv cifar10_alexnet_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
mv /benchmarks/cifar10_alexnet_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
mv /benchmarks/cifar10_alexnet_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
mv /benchmarks/cifar10_alexnet_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_winograd_w1.pbtxt 2> cifar10_alexnet_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_winograd_w2.pbtxt 2> cifar10_alexnet_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/cifar10_alexnet_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/cifar10_alexnet_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/cifar10_alexnet_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/cifar10_alexnet_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
mv cifar10_alexnet_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
mv cifar10_alexnet_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
mv cifar10_alexnet_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
mv /benchmarks/cifar10_alexnet_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
mv /benchmarks/cifar10_alexnet_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
mv /benchmarks/cifar10_alexnet_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_xla_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_xla_w1.pbtxt 2> cifar10_alexnet_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_xla_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_xla_w2.pbtxt 2> cifar10_alexnet_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/cifar10_alexnet_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/cifar10_alexnet_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/cifar10_alexnet_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/cifar10_alexnet_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
mv cifar10_alexnet_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
mv cifar10_alexnet_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
mv cifar10_alexnet_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
mv /benchmarks/cifar10_alexnet_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
mv /benchmarks/cifar10_alexnet_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
mv /benchmarks/cifar10_alexnet_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch32_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_batch32_w1.pbtxt 2> cifar10_alexnet_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch32_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_batch32_w2.pbtxt 2> cifar10_alexnet_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/cifar10_alexnet_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/cifar10_alexnet_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/cifar10_alexnet_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/cifar10_alexnet_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
mv cifar10_alexnet_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
mv cifar10_alexnet_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
mv cifar10_alexnet_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
mv /benchmarks/cifar10_alexnet_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
mv /benchmarks/cifar10_alexnet_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
mv /benchmarks/cifar10_alexnet_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch64_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_batch64_w1.pbtxt 2> cifar10_alexnet_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch64_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_batch64_w2.pbtxt 2> cifar10_alexnet_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/cifar10_alexnet_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/cifar10_alexnet_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/cifar10_alexnet_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/cifar10_alexnet_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
mv cifar10_alexnet_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
mv cifar10_alexnet_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
mv cifar10_alexnet_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
mv /benchmarks/cifar10_alexnet_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
mv /benchmarks/cifar10_alexnet_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
mv /benchmarks/cifar10_alexnet_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch128_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_batch128_w1.pbtxt 2> cifar10_alexnet_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch128_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_batch128_w2.pbtxt 2> cifar10_alexnet_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/cifar10_alexnet_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/cifar10_alexnet_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/cifar10_alexnet_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/cifar10_alexnet_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
mv cifar10_alexnet_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
mv cifar10_alexnet_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
mv cifar10_alexnet_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
mv /benchmarks/cifar10_alexnet_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
mv /benchmarks/cifar10_alexnet_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
mv /benchmarks/cifar10_alexnet_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch256_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_batch256_w1.pbtxt 2> cifar10_alexnet_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch256_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_batch256_w2.pbtxt 2> cifar10_alexnet_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/cifar10_alexnet_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/cifar10_alexnet_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/cifar10_alexnet_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/cifar10_alexnet_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
mv cifar10_alexnet_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
mv cifar10_alexnet_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
mv cifar10_alexnet_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
mv /benchmarks/cifar10_alexnet_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
mv /benchmarks/cifar10_alexnet_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
mv /benchmarks/cifar10_alexnet_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch512_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_batch512_w1.pbtxt 2> cifar10_alexnet_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch512_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_batch512_w2.pbtxt 2> cifar10_alexnet_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/cifar10_alexnet_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/cifar10_alexnet_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/cifar10_alexnet_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/cifar10_alexnet_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
mv cifar10_alexnet_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
mv cifar10_alexnet_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
mv cifar10_alexnet_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
mv /benchmarks/cifar10_alexnet_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
mv /benchmarks/cifar10_alexnet_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
mv /benchmarks/cifar10_alexnet_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_use_fp16_w1.pbtxt 2> cifar10_alexnet_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_use_fp16_w2.pbtxt 2> cifar10_alexnet_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/cifar10_alexnet_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/cifar10_alexnet_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/cifar10_alexnet_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/cifar10_alexnet_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
mv cifar10_alexnet_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
mv cifar10_alexnet_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
mv cifar10_alexnet_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
mv /benchmarks/cifar10_alexnet_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
mv /benchmarks/cifar10_alexnet_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
mv /benchmarks/cifar10_alexnet_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_optMomentum_w1.pbtxt 2> cifar10_alexnet_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_optMomentum_w2.pbtxt 2> cifar10_alexnet_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/cifar10_alexnet_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/cifar10_alexnet_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/cifar10_alexnet_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/cifar10_alexnet_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
mv cifar10_alexnet_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
mv cifar10_alexnet_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
mv cifar10_alexnet_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
mv /benchmarks/cifar10_alexnet_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
mv /benchmarks/cifar10_alexnet_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
mv /benchmarks/cifar10_alexnet_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_optRmsprop_w1.pbtxt 2> cifar10_alexnet_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_optRmsprop_w2.pbtxt 2> cifar10_alexnet_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/cifar10_alexnet_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/cifar10_alexnet_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/cifar10_alexnet_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/cifar10_alexnet_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
mv cifar10_alexnet_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
mv cifar10_alexnet_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
mv cifar10_alexnet_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
mv /benchmarks/cifar10_alexnet_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
mv /benchmarks/cifar10_alexnet_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
mv /benchmarks/cifar10_alexnet_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_dataFormat_w1.pbtxt 2> cifar10_alexnet_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_dataFormat_w2.pbtxt 2> cifar10_alexnet_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/cifar10_alexnet_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/cifar10_alexnet_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/cifar10_alexnet_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/cifar10_alexnet_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
mv cifar10_alexnet_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
mv cifar10_alexnet_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
mv cifar10_alexnet_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
mv /benchmarks/cifar10_alexnet_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
mv /benchmarks/cifar10_alexnet_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
mv /benchmarks/cifar10_alexnet_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_winograd_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_winograd_w1.pbtxt 2> cifar10_alexnet_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_winograd_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_winograd_w2.pbtxt 2> cifar10_alexnet_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/cifar10_alexnet_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/cifar10_alexnet_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/cifar10_alexnet_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/cifar10_alexnet_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
mv cifar10_alexnet_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
mv cifar10_alexnet_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
mv cifar10_alexnet_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
mv /benchmarks/cifar10_alexnet_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
mv /benchmarks/cifar10_alexnet_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
mv /benchmarks/cifar10_alexnet_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_xla_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_xla_w1.pbtxt 2> cifar10_alexnet_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_xla_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_xla_w2.pbtxt 2> cifar10_alexnet_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/cifar10_alexnet_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/cifar10_alexnet_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/cifar10_alexnet_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/cifar10_alexnet_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
mv cifar10_alexnet_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
mv cifar10_alexnet_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
mv cifar10_alexnet_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
mv /benchmarks/cifar10_alexnet_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
mv /benchmarks/cifar10_alexnet_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
mv /benchmarks/cifar10_alexnet_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch32_w1.pbtxt 2> cifar10_vgg16_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch32_w2.pbtxt 2> cifar10_vgg16_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/cifar10_vgg16_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/cifar10_vgg16_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/cifar10_vgg16_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/cifar10_vgg16_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
mv cifar10_vgg16_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
mv cifar10_vgg16_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
mv cifar10_vgg16_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
mv /benchmarks/cifar10_vgg16_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
mv /benchmarks/cifar10_vgg16_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
mv /benchmarks/cifar10_vgg16_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch64_w1.pbtxt 2> cifar10_vgg16_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch64_w2.pbtxt 2> cifar10_vgg16_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/cifar10_vgg16_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/cifar10_vgg16_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/cifar10_vgg16_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/cifar10_vgg16_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
mv cifar10_vgg16_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
mv cifar10_vgg16_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
mv cifar10_vgg16_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
mv /benchmarks/cifar10_vgg16_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
mv /benchmarks/cifar10_vgg16_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
mv /benchmarks/cifar10_vgg16_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch128_w1.pbtxt 2> cifar10_vgg16_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch128_w2.pbtxt 2> cifar10_vgg16_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/cifar10_vgg16_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/cifar10_vgg16_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/cifar10_vgg16_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/cifar10_vgg16_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
mv cifar10_vgg16_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
mv cifar10_vgg16_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
mv cifar10_vgg16_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
mv /benchmarks/cifar10_vgg16_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
mv /benchmarks/cifar10_vgg16_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
mv /benchmarks/cifar10_vgg16_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch256_w1.pbtxt 2> cifar10_vgg16_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch256_w2.pbtxt 2> cifar10_vgg16_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/cifar10_vgg16_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/cifar10_vgg16_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/cifar10_vgg16_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/cifar10_vgg16_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
mv cifar10_vgg16_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
mv cifar10_vgg16_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
mv cifar10_vgg16_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
mv /benchmarks/cifar10_vgg16_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
mv /benchmarks/cifar10_vgg16_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
mv /benchmarks/cifar10_vgg16_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch512_w1.pbtxt 2> cifar10_vgg16_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch512_w2.pbtxt 2> cifar10_vgg16_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/cifar10_vgg16_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/cifar10_vgg16_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/cifar10_vgg16_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/cifar10_vgg16_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
mv cifar10_vgg16_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
mv cifar10_vgg16_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
mv cifar10_vgg16_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
mv /benchmarks/cifar10_vgg16_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
mv /benchmarks/cifar10_vgg16_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
mv /benchmarks/cifar10_vgg16_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_use_fp16_w1.pbtxt 2> cifar10_vgg16_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_use_fp16_w2.pbtxt 2> cifar10_vgg16_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/cifar10_vgg16_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/cifar10_vgg16_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/cifar10_vgg16_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/cifar10_vgg16_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
mv cifar10_vgg16_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
mv cifar10_vgg16_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
mv cifar10_vgg16_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
mv /benchmarks/cifar10_vgg16_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
mv /benchmarks/cifar10_vgg16_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
mv /benchmarks/cifar10_vgg16_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_optMomentum_w1.pbtxt 2> cifar10_vgg16_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_optMomentum_w2.pbtxt 2> cifar10_vgg16_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/cifar10_vgg16_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/cifar10_vgg16_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/cifar10_vgg16_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/cifar10_vgg16_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
mv cifar10_vgg16_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
mv cifar10_vgg16_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
mv cifar10_vgg16_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
mv /benchmarks/cifar10_vgg16_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
mv /benchmarks/cifar10_vgg16_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
mv /benchmarks/cifar10_vgg16_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_optRmsprop_w1.pbtxt 2> cifar10_vgg16_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_optRmsprop_w2.pbtxt 2> cifar10_vgg16_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/cifar10_vgg16_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/cifar10_vgg16_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/cifar10_vgg16_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/cifar10_vgg16_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
mv cifar10_vgg16_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
mv cifar10_vgg16_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
mv cifar10_vgg16_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
mv /benchmarks/cifar10_vgg16_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
mv /benchmarks/cifar10_vgg16_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
mv /benchmarks/cifar10_vgg16_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_dataFormat_w1.pbtxt 2> cifar10_vgg16_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_dataFormat_w2.pbtxt 2> cifar10_vgg16_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/cifar10_vgg16_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/cifar10_vgg16_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/cifar10_vgg16_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/cifar10_vgg16_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
mv cifar10_vgg16_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
mv cifar10_vgg16_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
mv cifar10_vgg16_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
mv /benchmarks/cifar10_vgg16_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
mv /benchmarks/cifar10_vgg16_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
mv /benchmarks/cifar10_vgg16_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_winograd_w1.pbtxt 2> cifar10_vgg16_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_winograd_w2.pbtxt 2> cifar10_vgg16_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/cifar10_vgg16_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/cifar10_vgg16_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/cifar10_vgg16_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/cifar10_vgg16_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
mv cifar10_vgg16_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
mv cifar10_vgg16_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
mv cifar10_vgg16_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
mv /benchmarks/cifar10_vgg16_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
mv /benchmarks/cifar10_vgg16_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
mv /benchmarks/cifar10_vgg16_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_xla_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_xla_w1.pbtxt 2> cifar10_vgg16_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_xla_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_xla_w2.pbtxt 2> cifar10_vgg16_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/cifar10_vgg16_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/cifar10_vgg16_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/cifar10_vgg16_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/cifar10_vgg16_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
mv cifar10_vgg16_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
mv cifar10_vgg16_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
mv cifar10_vgg16_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
mv /benchmarks/cifar10_vgg16_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
mv /benchmarks/cifar10_vgg16_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
mv /benchmarks/cifar10_vgg16_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch32_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_batch32_w1.pbtxt 2> cifar10_vgg16_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch32_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_batch32_w2.pbtxt 2> cifar10_vgg16_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/cifar10_vgg16_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/cifar10_vgg16_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/cifar10_vgg16_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/cifar10_vgg16_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
mv cifar10_vgg16_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
mv cifar10_vgg16_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
mv cifar10_vgg16_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
mv /benchmarks/cifar10_vgg16_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
mv /benchmarks/cifar10_vgg16_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
mv /benchmarks/cifar10_vgg16_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch64_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_batch64_w1.pbtxt 2> cifar10_vgg16_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch64_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_batch64_w2.pbtxt 2> cifar10_vgg16_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/cifar10_vgg16_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/cifar10_vgg16_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/cifar10_vgg16_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/cifar10_vgg16_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
mv cifar10_vgg16_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
mv cifar10_vgg16_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
mv cifar10_vgg16_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
mv /benchmarks/cifar10_vgg16_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
mv /benchmarks/cifar10_vgg16_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
mv /benchmarks/cifar10_vgg16_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch128_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_batch128_w1.pbtxt 2> cifar10_vgg16_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch128_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_batch128_w2.pbtxt 2> cifar10_vgg16_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/cifar10_vgg16_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/cifar10_vgg16_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/cifar10_vgg16_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/cifar10_vgg16_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
mv cifar10_vgg16_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
mv cifar10_vgg16_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
mv cifar10_vgg16_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
mv /benchmarks/cifar10_vgg16_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
mv /benchmarks/cifar10_vgg16_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
mv /benchmarks/cifar10_vgg16_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch256_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_batch256_w1.pbtxt 2> cifar10_vgg16_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch256_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_batch256_w2.pbtxt 2> cifar10_vgg16_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/cifar10_vgg16_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/cifar10_vgg16_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/cifar10_vgg16_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/cifar10_vgg16_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
mv cifar10_vgg16_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
mv cifar10_vgg16_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
mv cifar10_vgg16_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
mv /benchmarks/cifar10_vgg16_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
mv /benchmarks/cifar10_vgg16_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
mv /benchmarks/cifar10_vgg16_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch512_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_batch512_w1.pbtxt 2> cifar10_vgg16_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch512_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_batch512_w2.pbtxt 2> cifar10_vgg16_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/cifar10_vgg16_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/cifar10_vgg16_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/cifar10_vgg16_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/cifar10_vgg16_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
mv cifar10_vgg16_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
mv cifar10_vgg16_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
mv cifar10_vgg16_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
mv /benchmarks/cifar10_vgg16_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
mv /benchmarks/cifar10_vgg16_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
mv /benchmarks/cifar10_vgg16_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_use_fp16_w1.pbtxt 2> cifar10_vgg16_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_use_fp16_w2.pbtxt 2> cifar10_vgg16_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/cifar10_vgg16_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/cifar10_vgg16_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/cifar10_vgg16_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/cifar10_vgg16_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
mv cifar10_vgg16_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
mv cifar10_vgg16_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
mv cifar10_vgg16_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
mv /benchmarks/cifar10_vgg16_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
mv /benchmarks/cifar10_vgg16_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
mv /benchmarks/cifar10_vgg16_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_optMomentum_w1.pbtxt 2> cifar10_vgg16_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_optMomentum_w2.pbtxt 2> cifar10_vgg16_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/cifar10_vgg16_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/cifar10_vgg16_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/cifar10_vgg16_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/cifar10_vgg16_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
mv cifar10_vgg16_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
mv cifar10_vgg16_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
mv cifar10_vgg16_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
mv /benchmarks/cifar10_vgg16_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
mv /benchmarks/cifar10_vgg16_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
mv /benchmarks/cifar10_vgg16_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_optRmsprop_w1.pbtxt 2> cifar10_vgg16_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_optRmsprop_w2.pbtxt 2> cifar10_vgg16_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/cifar10_vgg16_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/cifar10_vgg16_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/cifar10_vgg16_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/cifar10_vgg16_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
mv cifar10_vgg16_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
mv cifar10_vgg16_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
mv cifar10_vgg16_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
mv /benchmarks/cifar10_vgg16_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
mv /benchmarks/cifar10_vgg16_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
mv /benchmarks/cifar10_vgg16_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_dataFormat_w1.pbtxt 2> cifar10_vgg16_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_dataFormat_w2.pbtxt 2> cifar10_vgg16_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/cifar10_vgg16_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/cifar10_vgg16_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/cifar10_vgg16_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/cifar10_vgg16_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
mv cifar10_vgg16_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
mv cifar10_vgg16_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
mv cifar10_vgg16_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
mv /benchmarks/cifar10_vgg16_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
mv /benchmarks/cifar10_vgg16_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
mv /benchmarks/cifar10_vgg16_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_winograd_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_winograd_w1.pbtxt 2> cifar10_vgg16_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_winograd_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_winograd_w2.pbtxt 2> cifar10_vgg16_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/cifar10_vgg16_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/cifar10_vgg16_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/cifar10_vgg16_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/cifar10_vgg16_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
mv cifar10_vgg16_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
mv cifar10_vgg16_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
mv cifar10_vgg16_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
mv /benchmarks/cifar10_vgg16_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
mv /benchmarks/cifar10_vgg16_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
mv /benchmarks/cifar10_vgg16_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_xla_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_xla_w1.pbtxt 2> cifar10_vgg16_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_xla_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_xla_w2.pbtxt 2> cifar10_vgg16_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/cifar10_vgg16_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/cifar10_vgg16_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/cifar10_vgg16_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/cifar10_vgg16_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
mv cifar10_vgg16_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
mv cifar10_vgg16_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
mv cifar10_vgg16_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
mv /benchmarks/cifar10_vgg16_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
mv /benchmarks/cifar10_vgg16_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
mv /benchmarks/cifar10_vgg16_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch32_w1.pbtxt 2> cifar10_densenet40_k12_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch32_w2.pbtxt 2> cifar10_densenet40_k12_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/cifar10_densenet40_k12_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/cifar10_densenet40_k12_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/cifar10_densenet40_k12_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/cifar10_densenet40_k12_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
mv cifar10_densenet40_k12_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
mv cifar10_densenet40_k12_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
mv cifar10_densenet40_k12_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
mv /benchmarks/cifar10_densenet40_k12_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
mv /benchmarks/cifar10_densenet40_k12_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/
mv /benchmarks/cifar10_densenet40_k12_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch64_w1.pbtxt 2> cifar10_densenet40_k12_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch64_w2.pbtxt 2> cifar10_densenet40_k12_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/cifar10_densenet40_k12_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/cifar10_densenet40_k12_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/cifar10_densenet40_k12_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/cifar10_densenet40_k12_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
mv cifar10_densenet40_k12_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
mv cifar10_densenet40_k12_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
mv cifar10_densenet40_k12_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
mv /benchmarks/cifar10_densenet40_k12_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
mv /benchmarks/cifar10_densenet40_k12_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/
mv /benchmarks/cifar10_densenet40_k12_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch128_w1.pbtxt 2> cifar10_densenet40_k12_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch128_w2.pbtxt 2> cifar10_densenet40_k12_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/cifar10_densenet40_k12_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/cifar10_densenet40_k12_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/cifar10_densenet40_k12_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/cifar10_densenet40_k12_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
mv cifar10_densenet40_k12_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
mv cifar10_densenet40_k12_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
mv cifar10_densenet40_k12_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
mv /benchmarks/cifar10_densenet40_k12_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
mv /benchmarks/cifar10_densenet40_k12_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/
mv /benchmarks/cifar10_densenet40_k12_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch256_w1.pbtxt 2> cifar10_densenet40_k12_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch256_w2.pbtxt 2> cifar10_densenet40_k12_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/cifar10_densenet40_k12_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/cifar10_densenet40_k12_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/cifar10_densenet40_k12_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/cifar10_densenet40_k12_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
mv cifar10_densenet40_k12_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
mv cifar10_densenet40_k12_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
mv cifar10_densenet40_k12_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
mv /benchmarks/cifar10_densenet40_k12_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
mv /benchmarks/cifar10_densenet40_k12_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/
mv /benchmarks/cifar10_densenet40_k12_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch512_w1.pbtxt 2> cifar10_densenet40_k12_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_batch512_w2.pbtxt 2> cifar10_densenet40_k12_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/cifar10_densenet40_k12_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/cifar10_densenet40_k12_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/cifar10_densenet40_k12_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/cifar10_densenet40_k12_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
mv cifar10_densenet40_k12_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
mv cifar10_densenet40_k12_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
mv cifar10_densenet40_k12_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
mv /benchmarks/cifar10_densenet40_k12_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
mv /benchmarks/cifar10_densenet40_k12_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/
mv /benchmarks/cifar10_densenet40_k12_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_use_fp16_w1.pbtxt 2> cifar10_densenet40_k12_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_use_fp16_w2.pbtxt 2> cifar10_densenet40_k12_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/cifar10_densenet40_k12_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/cifar10_densenet40_k12_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/cifar10_densenet40_k12_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/cifar10_densenet40_k12_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
mv cifar10_densenet40_k12_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
mv cifar10_densenet40_k12_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
mv cifar10_densenet40_k12_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
mv /benchmarks/cifar10_densenet40_k12_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
mv /benchmarks/cifar10_densenet40_k12_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/
mv /benchmarks/cifar10_densenet40_k12_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_optMomentum_w1.pbtxt 2> cifar10_densenet40_k12_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_optMomentum_w2.pbtxt 2> cifar10_densenet40_k12_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/cifar10_densenet40_k12_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/cifar10_densenet40_k12_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/cifar10_densenet40_k12_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/cifar10_densenet40_k12_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
mv cifar10_densenet40_k12_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
mv cifar10_densenet40_k12_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
mv cifar10_densenet40_k12_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
mv /benchmarks/cifar10_densenet40_k12_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
mv /benchmarks/cifar10_densenet40_k12_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/
mv /benchmarks/cifar10_densenet40_k12_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w1.pbtxt 2> cifar10_densenet40_k12_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w2.pbtxt 2> cifar10_densenet40_k12_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/cifar10_densenet40_k12_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/cifar10_densenet40_k12_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/cifar10_densenet40_k12_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/cifar10_densenet40_k12_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
mv cifar10_densenet40_k12_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
mv cifar10_densenet40_k12_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
mv cifar10_densenet40_k12_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
mv /benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
mv /benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/
mv /benchmarks/cifar10_densenet40_k12_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_dataFormat_w1.pbtxt 2> cifar10_densenet40_k12_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_dataFormat_w2.pbtxt 2> cifar10_densenet40_k12_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/cifar10_densenet40_k12_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/cifar10_densenet40_k12_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/cifar10_densenet40_k12_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/cifar10_densenet40_k12_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
mv cifar10_densenet40_k12_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
mv cifar10_densenet40_k12_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
mv cifar10_densenet40_k12_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
mv /benchmarks/cifar10_densenet40_k12_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
mv /benchmarks/cifar10_densenet40_k12_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/
mv /benchmarks/cifar10_densenet40_k12_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_winograd_w1.pbtxt 2> cifar10_densenet40_k12_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_winograd_w2.pbtxt 2> cifar10_densenet40_k12_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/cifar10_densenet40_k12_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/cifar10_densenet40_k12_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/cifar10_densenet40_k12_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/cifar10_densenet40_k12_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
mv cifar10_densenet40_k12_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
mv cifar10_densenet40_k12_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
mv cifar10_densenet40_k12_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
mv /benchmarks/cifar10_densenet40_k12_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
mv /benchmarks/cifar10_densenet40_k12_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/
mv /benchmarks/cifar10_densenet40_k12_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_xla_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_xla_w1.pbtxt 2> cifar10_densenet40_k12_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_sync_xla_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_sync_xla_w2.pbtxt 2> cifar10_densenet40_k12_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/cifar10_densenet40_k12_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/cifar10_densenet40_k12_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/cifar10_densenet40_k12_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/cifar10_densenet40_k12_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
mv cifar10_densenet40_k12_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
mv cifar10_densenet40_k12_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
mv cifar10_densenet40_k12_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
mv /benchmarks/cifar10_densenet40_k12_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
mv /benchmarks/cifar10_densenet40_k12_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/
mv /benchmarks/cifar10_densenet40_k12_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch32_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch32_w1.pbtxt 2> cifar10_densenet40_k12_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch32_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch32_w2.pbtxt 2> cifar10_densenet40_k12_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/cifar10_densenet40_k12_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/cifar10_densenet40_k12_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/cifar10_densenet40_k12_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/cifar10_densenet40_k12_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
mv cifar10_densenet40_k12_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
mv cifar10_densenet40_k12_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
mv cifar10_densenet40_k12_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
mv /benchmarks/cifar10_densenet40_k12_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
mv /benchmarks/cifar10_densenet40_k12_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/
mv /benchmarks/cifar10_densenet40_k12_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch64_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch64_w1.pbtxt 2> cifar10_densenet40_k12_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch64_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch64_w2.pbtxt 2> cifar10_densenet40_k12_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/cifar10_densenet40_k12_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/cifar10_densenet40_k12_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/cifar10_densenet40_k12_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/cifar10_densenet40_k12_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
mv cifar10_densenet40_k12_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
mv cifar10_densenet40_k12_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
mv cifar10_densenet40_k12_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
mv /benchmarks/cifar10_densenet40_k12_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
mv /benchmarks/cifar10_densenet40_k12_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/
mv /benchmarks/cifar10_densenet40_k12_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch128_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch128_w1.pbtxt 2> cifar10_densenet40_k12_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch128_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch128_w2.pbtxt 2> cifar10_densenet40_k12_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/cifar10_densenet40_k12_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/cifar10_densenet40_k12_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/cifar10_densenet40_k12_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/cifar10_densenet40_k12_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
mv cifar10_densenet40_k12_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
mv cifar10_densenet40_k12_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
mv cifar10_densenet40_k12_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
mv /benchmarks/cifar10_densenet40_k12_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
mv /benchmarks/cifar10_densenet40_k12_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/
mv /benchmarks/cifar10_densenet40_k12_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch256_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch256_w1.pbtxt 2> cifar10_densenet40_k12_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch256_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch256_w2.pbtxt 2> cifar10_densenet40_k12_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/cifar10_densenet40_k12_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/cifar10_densenet40_k12_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/cifar10_densenet40_k12_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/cifar10_densenet40_k12_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
mv cifar10_densenet40_k12_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
mv cifar10_densenet40_k12_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
mv cifar10_densenet40_k12_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
mv /benchmarks/cifar10_densenet40_k12_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
mv /benchmarks/cifar10_densenet40_k12_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/
mv /benchmarks/cifar10_densenet40_k12_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch512_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch512_w1.pbtxt 2> cifar10_densenet40_k12_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_batch512_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_batch512_w2.pbtxt 2> cifar10_densenet40_k12_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/cifar10_densenet40_k12_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/cifar10_densenet40_k12_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/cifar10_densenet40_k12_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/cifar10_densenet40_k12_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
mv cifar10_densenet40_k12_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
mv cifar10_densenet40_k12_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
mv cifar10_densenet40_k12_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
mv /benchmarks/cifar10_densenet40_k12_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
mv /benchmarks/cifar10_densenet40_k12_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/
mv /benchmarks/cifar10_densenet40_k12_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_use_fp16_w1.pbtxt 2> cifar10_densenet40_k12_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_use_fp16_w2.pbtxt 2> cifar10_densenet40_k12_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/cifar10_densenet40_k12_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/cifar10_densenet40_k12_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/cifar10_densenet40_k12_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/cifar10_densenet40_k12_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
mv cifar10_densenet40_k12_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
mv cifar10_densenet40_k12_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
mv cifar10_densenet40_k12_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
mv /benchmarks/cifar10_densenet40_k12_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
mv /benchmarks/cifar10_densenet40_k12_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/
mv /benchmarks/cifar10_densenet40_k12_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_optMomentum_w1.pbtxt 2> cifar10_densenet40_k12_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_optMomentum_w2.pbtxt 2> cifar10_densenet40_k12_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/cifar10_densenet40_k12_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/cifar10_densenet40_k12_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/cifar10_densenet40_k12_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/cifar10_densenet40_k12_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
mv cifar10_densenet40_k12_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
mv cifar10_densenet40_k12_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
mv cifar10_densenet40_k12_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
mv /benchmarks/cifar10_densenet40_k12_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
mv /benchmarks/cifar10_densenet40_k12_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/
mv /benchmarks/cifar10_densenet40_k12_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_optRmsprop_w1.pbtxt 2> cifar10_densenet40_k12_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_optRmsprop_w2.pbtxt 2> cifar10_densenet40_k12_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/cifar10_densenet40_k12_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/cifar10_densenet40_k12_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/cifar10_densenet40_k12_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/cifar10_densenet40_k12_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
mv cifar10_densenet40_k12_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
mv cifar10_densenet40_k12_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
mv cifar10_densenet40_k12_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
mv /benchmarks/cifar10_densenet40_k12_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
mv /benchmarks/cifar10_densenet40_k12_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/
mv /benchmarks/cifar10_densenet40_k12_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_dataFormat_w1.pbtxt 2> cifar10_densenet40_k12_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_dataFormat_w2.pbtxt 2> cifar10_densenet40_k12_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/cifar10_densenet40_k12_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/cifar10_densenet40_k12_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/cifar10_densenet40_k12_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/cifar10_densenet40_k12_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
mv cifar10_densenet40_k12_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
mv cifar10_densenet40_k12_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
mv cifar10_densenet40_k12_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
mv /benchmarks/cifar10_densenet40_k12_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
mv /benchmarks/cifar10_densenet40_k12_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/
mv /benchmarks/cifar10_densenet40_k12_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_winograd_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_winograd_w1.pbtxt 2> cifar10_densenet40_k12_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_winograd_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_winograd_w2.pbtxt 2> cifar10_densenet40_k12_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/cifar10_densenet40_k12_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/cifar10_densenet40_k12_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/cifar10_densenet40_k12_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/cifar10_densenet40_k12_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
mv cifar10_densenet40_k12_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
mv cifar10_densenet40_k12_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
mv cifar10_densenet40_k12_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
mv /benchmarks/cifar10_densenet40_k12_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
mv /benchmarks/cifar10_densenet40_k12_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/
mv /benchmarks/cifar10_densenet40_k12_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet40_k12_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_xla_w1.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_xla_w1.pbtxt 2> cifar10_densenet40_k12_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet40_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet40_k12_async_xla_w2.json --graph_file=/benchmarks/cifar10_densenet40_k12_async_xla_w2.pbtxt 2> cifar10_densenet40_k12_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/cifar10_densenet40_k12_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/cifar10_densenet40_k12_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/cifar10_densenet40_k12_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/cifar10_densenet40_k12_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet40_k12_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
mv cifar10_densenet40_k12_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
mv cifar10_densenet40_k12_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
mv cifar10_densenet40_k12_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet40_k12_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
mv /benchmarks/cifar10_densenet40_k12_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
mv /benchmarks/cifar10_densenet40_k12_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/
mv /benchmarks/cifar10_densenet40_k12_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet40_k12_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch32_w1.pbtxt 2> cifar10_densenet100_k12_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch32_w2.pbtxt 2> cifar10_densenet100_k12_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/cifar10_densenet100_k12_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/cifar10_densenet100_k12_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/cifar10_densenet100_k12_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/cifar10_densenet100_k12_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
mv cifar10_densenet100_k12_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
mv cifar10_densenet100_k12_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
mv cifar10_densenet100_k12_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
mv /benchmarks/cifar10_densenet100_k12_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
mv /benchmarks/cifar10_densenet100_k12_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/
mv /benchmarks/cifar10_densenet100_k12_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch64_w1.pbtxt 2> cifar10_densenet100_k12_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch64_w2.pbtxt 2> cifar10_densenet100_k12_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/cifar10_densenet100_k12_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/cifar10_densenet100_k12_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/cifar10_densenet100_k12_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/cifar10_densenet100_k12_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
mv cifar10_densenet100_k12_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
mv cifar10_densenet100_k12_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
mv cifar10_densenet100_k12_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
mv /benchmarks/cifar10_densenet100_k12_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
mv /benchmarks/cifar10_densenet100_k12_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/
mv /benchmarks/cifar10_densenet100_k12_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch128_w1.pbtxt 2> cifar10_densenet100_k12_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch128_w2.pbtxt 2> cifar10_densenet100_k12_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/cifar10_densenet100_k12_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/cifar10_densenet100_k12_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/cifar10_densenet100_k12_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/cifar10_densenet100_k12_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
mv cifar10_densenet100_k12_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
mv cifar10_densenet100_k12_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
mv cifar10_densenet100_k12_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
mv /benchmarks/cifar10_densenet100_k12_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
mv /benchmarks/cifar10_densenet100_k12_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/
mv /benchmarks/cifar10_densenet100_k12_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch256_w1.pbtxt 2> cifar10_densenet100_k12_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch256_w2.pbtxt 2> cifar10_densenet100_k12_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/cifar10_densenet100_k12_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/cifar10_densenet100_k12_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/cifar10_densenet100_k12_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/cifar10_densenet100_k12_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
mv cifar10_densenet100_k12_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
mv cifar10_densenet100_k12_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
mv cifar10_densenet100_k12_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
mv /benchmarks/cifar10_densenet100_k12_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
mv /benchmarks/cifar10_densenet100_k12_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/
mv /benchmarks/cifar10_densenet100_k12_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch512_w1.pbtxt 2> cifar10_densenet100_k12_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_batch512_w2.pbtxt 2> cifar10_densenet100_k12_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/cifar10_densenet100_k12_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/cifar10_densenet100_k12_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/cifar10_densenet100_k12_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/cifar10_densenet100_k12_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
mv cifar10_densenet100_k12_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
mv cifar10_densenet100_k12_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
mv cifar10_densenet100_k12_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
mv /benchmarks/cifar10_densenet100_k12_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
mv /benchmarks/cifar10_densenet100_k12_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/
mv /benchmarks/cifar10_densenet100_k12_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_use_fp16_w1.pbtxt 2> cifar10_densenet100_k12_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_use_fp16_w2.pbtxt 2> cifar10_densenet100_k12_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/cifar10_densenet100_k12_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/cifar10_densenet100_k12_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/cifar10_densenet100_k12_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/cifar10_densenet100_k12_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
mv cifar10_densenet100_k12_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
mv cifar10_densenet100_k12_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
mv cifar10_densenet100_k12_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
mv /benchmarks/cifar10_densenet100_k12_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
mv /benchmarks/cifar10_densenet100_k12_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/
mv /benchmarks/cifar10_densenet100_k12_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_optMomentum_w1.pbtxt 2> cifar10_densenet100_k12_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_optMomentum_w2.pbtxt 2> cifar10_densenet100_k12_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/cifar10_densenet100_k12_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/cifar10_densenet100_k12_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/cifar10_densenet100_k12_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/cifar10_densenet100_k12_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
mv cifar10_densenet100_k12_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
mv cifar10_densenet100_k12_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
mv cifar10_densenet100_k12_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
mv /benchmarks/cifar10_densenet100_k12_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
mv /benchmarks/cifar10_densenet100_k12_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/
mv /benchmarks/cifar10_densenet100_k12_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w1.pbtxt 2> cifar10_densenet100_k12_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w2.pbtxt 2> cifar10_densenet100_k12_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/cifar10_densenet100_k12_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/cifar10_densenet100_k12_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/cifar10_densenet100_k12_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/cifar10_densenet100_k12_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
mv cifar10_densenet100_k12_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
mv cifar10_densenet100_k12_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
mv cifar10_densenet100_k12_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
mv /benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
mv /benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/
mv /benchmarks/cifar10_densenet100_k12_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_dataFormat_w1.pbtxt 2> cifar10_densenet100_k12_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_dataFormat_w2.pbtxt 2> cifar10_densenet100_k12_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/cifar10_densenet100_k12_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/cifar10_densenet100_k12_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/cifar10_densenet100_k12_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/cifar10_densenet100_k12_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
mv cifar10_densenet100_k12_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
mv cifar10_densenet100_k12_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
mv cifar10_densenet100_k12_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
mv /benchmarks/cifar10_densenet100_k12_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
mv /benchmarks/cifar10_densenet100_k12_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/
mv /benchmarks/cifar10_densenet100_k12_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_winograd_w1.pbtxt 2> cifar10_densenet100_k12_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_winograd_w2.pbtxt 2> cifar10_densenet100_k12_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/cifar10_densenet100_k12_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/cifar10_densenet100_k12_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/cifar10_densenet100_k12_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/cifar10_densenet100_k12_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
mv cifar10_densenet100_k12_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
mv cifar10_densenet100_k12_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
mv cifar10_densenet100_k12_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
mv /benchmarks/cifar10_densenet100_k12_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
mv /benchmarks/cifar10_densenet100_k12_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/
mv /benchmarks/cifar10_densenet100_k12_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_xla_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_xla_w1.pbtxt 2> cifar10_densenet100_k12_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_sync_xla_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_sync_xla_w2.pbtxt 2> cifar10_densenet100_k12_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/cifar10_densenet100_k12_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/cifar10_densenet100_k12_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/cifar10_densenet100_k12_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/cifar10_densenet100_k12_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
mv cifar10_densenet100_k12_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
mv cifar10_densenet100_k12_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
mv cifar10_densenet100_k12_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
mv /benchmarks/cifar10_densenet100_k12_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
mv /benchmarks/cifar10_densenet100_k12_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/
mv /benchmarks/cifar10_densenet100_k12_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch32_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch32_w1.pbtxt 2> cifar10_densenet100_k12_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch32_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch32_w2.pbtxt 2> cifar10_densenet100_k12_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/cifar10_densenet100_k12_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/cifar10_densenet100_k12_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/cifar10_densenet100_k12_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/cifar10_densenet100_k12_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
mv cifar10_densenet100_k12_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
mv cifar10_densenet100_k12_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
mv cifar10_densenet100_k12_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
mv /benchmarks/cifar10_densenet100_k12_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
mv /benchmarks/cifar10_densenet100_k12_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/
mv /benchmarks/cifar10_densenet100_k12_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch64_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch64_w1.pbtxt 2> cifar10_densenet100_k12_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch64_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch64_w2.pbtxt 2> cifar10_densenet100_k12_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/cifar10_densenet100_k12_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/cifar10_densenet100_k12_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/cifar10_densenet100_k12_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/cifar10_densenet100_k12_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
mv cifar10_densenet100_k12_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
mv cifar10_densenet100_k12_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
mv cifar10_densenet100_k12_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
mv /benchmarks/cifar10_densenet100_k12_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
mv /benchmarks/cifar10_densenet100_k12_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/
mv /benchmarks/cifar10_densenet100_k12_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch128_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch128_w1.pbtxt 2> cifar10_densenet100_k12_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch128_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch128_w2.pbtxt 2> cifar10_densenet100_k12_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/cifar10_densenet100_k12_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/cifar10_densenet100_k12_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/cifar10_densenet100_k12_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/cifar10_densenet100_k12_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
mv cifar10_densenet100_k12_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
mv cifar10_densenet100_k12_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
mv cifar10_densenet100_k12_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
mv /benchmarks/cifar10_densenet100_k12_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
mv /benchmarks/cifar10_densenet100_k12_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/
mv /benchmarks/cifar10_densenet100_k12_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch256_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch256_w1.pbtxt 2> cifar10_densenet100_k12_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch256_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch256_w2.pbtxt 2> cifar10_densenet100_k12_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/cifar10_densenet100_k12_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/cifar10_densenet100_k12_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/cifar10_densenet100_k12_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/cifar10_densenet100_k12_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
mv cifar10_densenet100_k12_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
mv cifar10_densenet100_k12_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
mv cifar10_densenet100_k12_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
mv /benchmarks/cifar10_densenet100_k12_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
mv /benchmarks/cifar10_densenet100_k12_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/
mv /benchmarks/cifar10_densenet100_k12_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch512_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch512_w1.pbtxt 2> cifar10_densenet100_k12_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_batch512_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_batch512_w2.pbtxt 2> cifar10_densenet100_k12_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/cifar10_densenet100_k12_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/cifar10_densenet100_k12_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/cifar10_densenet100_k12_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/cifar10_densenet100_k12_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
mv cifar10_densenet100_k12_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
mv cifar10_densenet100_k12_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
mv cifar10_densenet100_k12_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
mv /benchmarks/cifar10_densenet100_k12_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
mv /benchmarks/cifar10_densenet100_k12_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/
mv /benchmarks/cifar10_densenet100_k12_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_use_fp16_w1.pbtxt 2> cifar10_densenet100_k12_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_use_fp16_w2.pbtxt 2> cifar10_densenet100_k12_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/cifar10_densenet100_k12_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/cifar10_densenet100_k12_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/cifar10_densenet100_k12_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/cifar10_densenet100_k12_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
mv cifar10_densenet100_k12_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
mv cifar10_densenet100_k12_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
mv cifar10_densenet100_k12_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
mv /benchmarks/cifar10_densenet100_k12_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
mv /benchmarks/cifar10_densenet100_k12_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/
mv /benchmarks/cifar10_densenet100_k12_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_optMomentum_w1.pbtxt 2> cifar10_densenet100_k12_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_optMomentum_w2.pbtxt 2> cifar10_densenet100_k12_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/cifar10_densenet100_k12_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/cifar10_densenet100_k12_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/cifar10_densenet100_k12_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/cifar10_densenet100_k12_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
mv cifar10_densenet100_k12_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
mv cifar10_densenet100_k12_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
mv cifar10_densenet100_k12_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
mv /benchmarks/cifar10_densenet100_k12_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
mv /benchmarks/cifar10_densenet100_k12_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/
mv /benchmarks/cifar10_densenet100_k12_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_optRmsprop_w1.pbtxt 2> cifar10_densenet100_k12_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_optRmsprop_w2.pbtxt 2> cifar10_densenet100_k12_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/cifar10_densenet100_k12_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/cifar10_densenet100_k12_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/cifar10_densenet100_k12_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/cifar10_densenet100_k12_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
mv cifar10_densenet100_k12_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
mv cifar10_densenet100_k12_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
mv cifar10_densenet100_k12_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
mv /benchmarks/cifar10_densenet100_k12_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
mv /benchmarks/cifar10_densenet100_k12_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/
mv /benchmarks/cifar10_densenet100_k12_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_dataFormat_w1.pbtxt 2> cifar10_densenet100_k12_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_dataFormat_w2.pbtxt 2> cifar10_densenet100_k12_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/cifar10_densenet100_k12_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/cifar10_densenet100_k12_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/cifar10_densenet100_k12_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/cifar10_densenet100_k12_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
mv cifar10_densenet100_k12_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
mv cifar10_densenet100_k12_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
mv cifar10_densenet100_k12_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
mv /benchmarks/cifar10_densenet100_k12_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
mv /benchmarks/cifar10_densenet100_k12_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/
mv /benchmarks/cifar10_densenet100_k12_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_winograd_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_winograd_w1.pbtxt 2> cifar10_densenet100_k12_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_winograd_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_winograd_w2.pbtxt 2> cifar10_densenet100_k12_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/cifar10_densenet100_k12_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/cifar10_densenet100_k12_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/cifar10_densenet100_k12_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/cifar10_densenet100_k12_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
mv cifar10_densenet100_k12_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
mv cifar10_densenet100_k12_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
mv cifar10_densenet100_k12_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
mv /benchmarks/cifar10_densenet100_k12_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
mv /benchmarks/cifar10_densenet100_k12_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/
mv /benchmarks/cifar10_densenet100_k12_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k12_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_xla_w1.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_xla_w1.pbtxt 2> cifar10_densenet100_k12_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k12 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k12_async_xla_w2.json --graph_file=/benchmarks/cifar10_densenet100_k12_async_xla_w2.pbtxt 2> cifar10_densenet100_k12_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/cifar10_densenet100_k12_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/cifar10_densenet100_k12_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/cifar10_densenet100_k12_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/cifar10_densenet100_k12_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k12_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
mv cifar10_densenet100_k12_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
mv cifar10_densenet100_k12_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
mv cifar10_densenet100_k12_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k12_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
mv /benchmarks/cifar10_densenet100_k12_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
mv /benchmarks/cifar10_densenet100_k12_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/
mv /benchmarks/cifar10_densenet100_k12_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k12_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch32_w1.pbtxt 2> cifar10_densenet100_k24_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch32_w2.pbtxt 2> cifar10_densenet100_k24_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/cifar10_densenet100_k24_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/cifar10_densenet100_k24_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/cifar10_densenet100_k24_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/cifar10_densenet100_k24_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
mv cifar10_densenet100_k24_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
mv cifar10_densenet100_k24_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
mv cifar10_densenet100_k24_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
mv /benchmarks/cifar10_densenet100_k24_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
mv /benchmarks/cifar10_densenet100_k24_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/
mv /benchmarks/cifar10_densenet100_k24_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch64_w1.pbtxt 2> cifar10_densenet100_k24_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch64_w2.pbtxt 2> cifar10_densenet100_k24_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/cifar10_densenet100_k24_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/cifar10_densenet100_k24_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/cifar10_densenet100_k24_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/cifar10_densenet100_k24_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
mv cifar10_densenet100_k24_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
mv cifar10_densenet100_k24_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
mv cifar10_densenet100_k24_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
mv /benchmarks/cifar10_densenet100_k24_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
mv /benchmarks/cifar10_densenet100_k24_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/
mv /benchmarks/cifar10_densenet100_k24_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch128_w1.pbtxt 2> cifar10_densenet100_k24_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch128_w2.pbtxt 2> cifar10_densenet100_k24_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/cifar10_densenet100_k24_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/cifar10_densenet100_k24_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/cifar10_densenet100_k24_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/cifar10_densenet100_k24_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
mv cifar10_densenet100_k24_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
mv cifar10_densenet100_k24_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
mv cifar10_densenet100_k24_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
mv /benchmarks/cifar10_densenet100_k24_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
mv /benchmarks/cifar10_densenet100_k24_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/
mv /benchmarks/cifar10_densenet100_k24_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch256_w1.pbtxt 2> cifar10_densenet100_k24_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch256_w2.pbtxt 2> cifar10_densenet100_k24_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/cifar10_densenet100_k24_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/cifar10_densenet100_k24_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/cifar10_densenet100_k24_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/cifar10_densenet100_k24_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
mv cifar10_densenet100_k24_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
mv cifar10_densenet100_k24_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
mv cifar10_densenet100_k24_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
mv /benchmarks/cifar10_densenet100_k24_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
mv /benchmarks/cifar10_densenet100_k24_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/
mv /benchmarks/cifar10_densenet100_k24_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch512_w1.pbtxt 2> cifar10_densenet100_k24_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_batch512_w2.pbtxt 2> cifar10_densenet100_k24_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/cifar10_densenet100_k24_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/cifar10_densenet100_k24_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/cifar10_densenet100_k24_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/cifar10_densenet100_k24_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
mv cifar10_densenet100_k24_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
mv cifar10_densenet100_k24_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
mv cifar10_densenet100_k24_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
mv /benchmarks/cifar10_densenet100_k24_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
mv /benchmarks/cifar10_densenet100_k24_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/
mv /benchmarks/cifar10_densenet100_k24_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_use_fp16_w1.pbtxt 2> cifar10_densenet100_k24_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_use_fp16_w2.pbtxt 2> cifar10_densenet100_k24_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/cifar10_densenet100_k24_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/cifar10_densenet100_k24_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/cifar10_densenet100_k24_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/cifar10_densenet100_k24_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
mv cifar10_densenet100_k24_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
mv cifar10_densenet100_k24_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
mv cifar10_densenet100_k24_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
mv /benchmarks/cifar10_densenet100_k24_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
mv /benchmarks/cifar10_densenet100_k24_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/
mv /benchmarks/cifar10_densenet100_k24_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_optMomentum_w1.pbtxt 2> cifar10_densenet100_k24_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_optMomentum_w2.pbtxt 2> cifar10_densenet100_k24_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/cifar10_densenet100_k24_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/cifar10_densenet100_k24_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/cifar10_densenet100_k24_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/cifar10_densenet100_k24_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
mv cifar10_densenet100_k24_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
mv cifar10_densenet100_k24_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
mv cifar10_densenet100_k24_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
mv /benchmarks/cifar10_densenet100_k24_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
mv /benchmarks/cifar10_densenet100_k24_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/
mv /benchmarks/cifar10_densenet100_k24_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w1.pbtxt 2> cifar10_densenet100_k24_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w2.pbtxt 2> cifar10_densenet100_k24_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/cifar10_densenet100_k24_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/cifar10_densenet100_k24_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/cifar10_densenet100_k24_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/cifar10_densenet100_k24_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
mv cifar10_densenet100_k24_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
mv cifar10_densenet100_k24_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
mv cifar10_densenet100_k24_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
mv /benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
mv /benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/
mv /benchmarks/cifar10_densenet100_k24_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_dataFormat_w1.pbtxt 2> cifar10_densenet100_k24_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_dataFormat_w2.pbtxt 2> cifar10_densenet100_k24_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/cifar10_densenet100_k24_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/cifar10_densenet100_k24_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/cifar10_densenet100_k24_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/cifar10_densenet100_k24_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
mv cifar10_densenet100_k24_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
mv cifar10_densenet100_k24_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
mv cifar10_densenet100_k24_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
mv /benchmarks/cifar10_densenet100_k24_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
mv /benchmarks/cifar10_densenet100_k24_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/
mv /benchmarks/cifar10_densenet100_k24_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_winograd_w1.pbtxt 2> cifar10_densenet100_k24_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_winograd_w2.pbtxt 2> cifar10_densenet100_k24_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/cifar10_densenet100_k24_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/cifar10_densenet100_k24_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/cifar10_densenet100_k24_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/cifar10_densenet100_k24_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
mv cifar10_densenet100_k24_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
mv cifar10_densenet100_k24_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
mv cifar10_densenet100_k24_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
mv /benchmarks/cifar10_densenet100_k24_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
mv /benchmarks/cifar10_densenet100_k24_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/
mv /benchmarks/cifar10_densenet100_k24_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_xla_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_xla_w1.pbtxt 2> cifar10_densenet100_k24_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_sync_xla_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_sync_xla_w2.pbtxt 2> cifar10_densenet100_k24_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/cifar10_densenet100_k24_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/cifar10_densenet100_k24_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/cifar10_densenet100_k24_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/cifar10_densenet100_k24_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
mv cifar10_densenet100_k24_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
mv cifar10_densenet100_k24_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
mv cifar10_densenet100_k24_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
mv /benchmarks/cifar10_densenet100_k24_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
mv /benchmarks/cifar10_densenet100_k24_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/
mv /benchmarks/cifar10_densenet100_k24_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch32_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch32_w1.pbtxt 2> cifar10_densenet100_k24_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch32_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch32_w2.pbtxt 2> cifar10_densenet100_k24_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/cifar10_densenet100_k24_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/cifar10_densenet100_k24_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/cifar10_densenet100_k24_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/cifar10_densenet100_k24_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
mv cifar10_densenet100_k24_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
mv cifar10_densenet100_k24_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
mv cifar10_densenet100_k24_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
mv /benchmarks/cifar10_densenet100_k24_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
mv /benchmarks/cifar10_densenet100_k24_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/
mv /benchmarks/cifar10_densenet100_k24_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch64_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch64_w1.pbtxt 2> cifar10_densenet100_k24_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch64_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch64_w2.pbtxt 2> cifar10_densenet100_k24_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/cifar10_densenet100_k24_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/cifar10_densenet100_k24_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/cifar10_densenet100_k24_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/cifar10_densenet100_k24_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
mv cifar10_densenet100_k24_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
mv cifar10_densenet100_k24_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
mv cifar10_densenet100_k24_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
mv /benchmarks/cifar10_densenet100_k24_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
mv /benchmarks/cifar10_densenet100_k24_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/
mv /benchmarks/cifar10_densenet100_k24_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch128_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch128_w1.pbtxt 2> cifar10_densenet100_k24_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch128_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch128_w2.pbtxt 2> cifar10_densenet100_k24_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/cifar10_densenet100_k24_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/cifar10_densenet100_k24_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/cifar10_densenet100_k24_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/cifar10_densenet100_k24_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
mv cifar10_densenet100_k24_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
mv cifar10_densenet100_k24_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
mv cifar10_densenet100_k24_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
mv /benchmarks/cifar10_densenet100_k24_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
mv /benchmarks/cifar10_densenet100_k24_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/
mv /benchmarks/cifar10_densenet100_k24_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch256_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch256_w1.pbtxt 2> cifar10_densenet100_k24_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch256_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch256_w2.pbtxt 2> cifar10_densenet100_k24_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/cifar10_densenet100_k24_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/cifar10_densenet100_k24_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/cifar10_densenet100_k24_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/cifar10_densenet100_k24_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
mv cifar10_densenet100_k24_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
mv cifar10_densenet100_k24_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
mv cifar10_densenet100_k24_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
mv /benchmarks/cifar10_densenet100_k24_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
mv /benchmarks/cifar10_densenet100_k24_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/
mv /benchmarks/cifar10_densenet100_k24_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch512_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch512_w1.pbtxt 2> cifar10_densenet100_k24_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_batch512_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_batch512_w2.pbtxt 2> cifar10_densenet100_k24_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/cifar10_densenet100_k24_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/cifar10_densenet100_k24_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/cifar10_densenet100_k24_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/cifar10_densenet100_k24_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
mv cifar10_densenet100_k24_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
mv cifar10_densenet100_k24_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
mv cifar10_densenet100_k24_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
mv /benchmarks/cifar10_densenet100_k24_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
mv /benchmarks/cifar10_densenet100_k24_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/
mv /benchmarks/cifar10_densenet100_k24_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_use_fp16_w1.pbtxt 2> cifar10_densenet100_k24_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_use_fp16_w2.pbtxt 2> cifar10_densenet100_k24_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/cifar10_densenet100_k24_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/cifar10_densenet100_k24_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/cifar10_densenet100_k24_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/cifar10_densenet100_k24_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
mv cifar10_densenet100_k24_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
mv cifar10_densenet100_k24_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
mv cifar10_densenet100_k24_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
mv /benchmarks/cifar10_densenet100_k24_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
mv /benchmarks/cifar10_densenet100_k24_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/
mv /benchmarks/cifar10_densenet100_k24_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_optMomentum_w1.pbtxt 2> cifar10_densenet100_k24_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_optMomentum_w2.pbtxt 2> cifar10_densenet100_k24_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/cifar10_densenet100_k24_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/cifar10_densenet100_k24_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/cifar10_densenet100_k24_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/cifar10_densenet100_k24_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
mv cifar10_densenet100_k24_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
mv cifar10_densenet100_k24_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
mv cifar10_densenet100_k24_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
mv /benchmarks/cifar10_densenet100_k24_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
mv /benchmarks/cifar10_densenet100_k24_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/
mv /benchmarks/cifar10_densenet100_k24_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_optRmsprop_w1.pbtxt 2> cifar10_densenet100_k24_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_optRmsprop_w2.pbtxt 2> cifar10_densenet100_k24_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/cifar10_densenet100_k24_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/cifar10_densenet100_k24_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/cifar10_densenet100_k24_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/cifar10_densenet100_k24_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
mv cifar10_densenet100_k24_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
mv cifar10_densenet100_k24_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
mv cifar10_densenet100_k24_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
mv /benchmarks/cifar10_densenet100_k24_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
mv /benchmarks/cifar10_densenet100_k24_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/
mv /benchmarks/cifar10_densenet100_k24_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_dataFormat_w1.pbtxt 2> cifar10_densenet100_k24_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_dataFormat_w2.pbtxt 2> cifar10_densenet100_k24_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/cifar10_densenet100_k24_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/cifar10_densenet100_k24_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/cifar10_densenet100_k24_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/cifar10_densenet100_k24_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
mv cifar10_densenet100_k24_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
mv cifar10_densenet100_k24_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
mv cifar10_densenet100_k24_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
mv /benchmarks/cifar10_densenet100_k24_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
mv /benchmarks/cifar10_densenet100_k24_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/
mv /benchmarks/cifar10_densenet100_k24_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_winograd_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_winograd_w1.pbtxt 2> cifar10_densenet100_k24_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_winograd_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_winograd_w2.pbtxt 2> cifar10_densenet100_k24_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/cifar10_densenet100_k24_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/cifar10_densenet100_k24_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/cifar10_densenet100_k24_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/cifar10_densenet100_k24_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
mv cifar10_densenet100_k24_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
mv cifar10_densenet100_k24_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
mv cifar10_densenet100_k24_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
mv /benchmarks/cifar10_densenet100_k24_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
mv /benchmarks/cifar10_densenet100_k24_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/
mv /benchmarks/cifar10_densenet100_k24_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_densenet100_k24_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_xla_w1.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_xla_w1.pbtxt 2> cifar10_densenet100_k24_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=densenet100_k24 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_densenet100_k24_async_xla_w2.json --graph_file=/benchmarks/cifar10_densenet100_k24_async_xla_w2.pbtxt 2> cifar10_densenet100_k24_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/cifar10_densenet100_k24_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/cifar10_densenet100_k24_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/cifar10_densenet100_k24_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/cifar10_densenet100_k24_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_densenet100_k24_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
mv cifar10_densenet100_k24_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
mv cifar10_densenet100_k24_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
mv cifar10_densenet100_k24_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_densenet100_k24_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
mv /benchmarks/cifar10_densenet100_k24_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
mv /benchmarks/cifar10_densenet100_k24_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/
mv /benchmarks/cifar10_densenet100_k24_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_densenet100_k24_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch32_w1.pbtxt 2> cifar10_resnet20_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch32_w2.pbtxt 2> cifar10_resnet20_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/cifar10_resnet20_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/cifar10_resnet20_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/cifar10_resnet20_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/cifar10_resnet20_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
mv cifar10_resnet20_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
mv cifar10_resnet20_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
mv cifar10_resnet20_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
mv /benchmarks/cifar10_resnet20_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
mv /benchmarks/cifar10_resnet20_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/
mv /benchmarks/cifar10_resnet20_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch64_w1.pbtxt 2> cifar10_resnet20_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch64_w2.pbtxt 2> cifar10_resnet20_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/cifar10_resnet20_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/cifar10_resnet20_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/cifar10_resnet20_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/cifar10_resnet20_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
mv cifar10_resnet20_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
mv cifar10_resnet20_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
mv cifar10_resnet20_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
mv /benchmarks/cifar10_resnet20_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
mv /benchmarks/cifar10_resnet20_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/
mv /benchmarks/cifar10_resnet20_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch128_w1.pbtxt 2> cifar10_resnet20_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch128_w2.pbtxt 2> cifar10_resnet20_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/cifar10_resnet20_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/cifar10_resnet20_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/cifar10_resnet20_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/cifar10_resnet20_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
mv cifar10_resnet20_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
mv cifar10_resnet20_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
mv cifar10_resnet20_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
mv /benchmarks/cifar10_resnet20_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
mv /benchmarks/cifar10_resnet20_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/
mv /benchmarks/cifar10_resnet20_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch256_w1.pbtxt 2> cifar10_resnet20_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch256_w2.pbtxt 2> cifar10_resnet20_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/cifar10_resnet20_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/cifar10_resnet20_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/cifar10_resnet20_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/cifar10_resnet20_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
mv cifar10_resnet20_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
mv cifar10_resnet20_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
mv cifar10_resnet20_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
mv /benchmarks/cifar10_resnet20_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
mv /benchmarks/cifar10_resnet20_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/
mv /benchmarks/cifar10_resnet20_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch512_w1.pbtxt 2> cifar10_resnet20_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_batch512_w2.pbtxt 2> cifar10_resnet20_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/cifar10_resnet20_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/cifar10_resnet20_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/cifar10_resnet20_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/cifar10_resnet20_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
mv cifar10_resnet20_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
mv cifar10_resnet20_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
mv cifar10_resnet20_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
mv /benchmarks/cifar10_resnet20_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
mv /benchmarks/cifar10_resnet20_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/
mv /benchmarks/cifar10_resnet20_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_use_fp16_w1.pbtxt 2> cifar10_resnet20_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_use_fp16_w2.pbtxt 2> cifar10_resnet20_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/cifar10_resnet20_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/cifar10_resnet20_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/cifar10_resnet20_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/cifar10_resnet20_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
mv cifar10_resnet20_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
mv cifar10_resnet20_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
mv cifar10_resnet20_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
mv /benchmarks/cifar10_resnet20_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
mv /benchmarks/cifar10_resnet20_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/
mv /benchmarks/cifar10_resnet20_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_optMomentum_w1.pbtxt 2> cifar10_resnet20_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_optMomentum_w2.pbtxt 2> cifar10_resnet20_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/cifar10_resnet20_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/cifar10_resnet20_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/cifar10_resnet20_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/cifar10_resnet20_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
mv cifar10_resnet20_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
mv cifar10_resnet20_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
mv cifar10_resnet20_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
mv /benchmarks/cifar10_resnet20_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
mv /benchmarks/cifar10_resnet20_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/
mv /benchmarks/cifar10_resnet20_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet20_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet20_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/cifar10_resnet20_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/cifar10_resnet20_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/cifar10_resnet20_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/cifar10_resnet20_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
mv cifar10_resnet20_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
mv cifar10_resnet20_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
mv cifar10_resnet20_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
mv /benchmarks/cifar10_resnet20_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
mv /benchmarks/cifar10_resnet20_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/
mv /benchmarks/cifar10_resnet20_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_dataFormat_w1.pbtxt 2> cifar10_resnet20_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_dataFormat_w2.pbtxt 2> cifar10_resnet20_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/cifar10_resnet20_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/cifar10_resnet20_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/cifar10_resnet20_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/cifar10_resnet20_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
mv cifar10_resnet20_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
mv cifar10_resnet20_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
mv cifar10_resnet20_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
mv /benchmarks/cifar10_resnet20_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
mv /benchmarks/cifar10_resnet20_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/
mv /benchmarks/cifar10_resnet20_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_winograd_w1.pbtxt 2> cifar10_resnet20_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_winograd_w2.pbtxt 2> cifar10_resnet20_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/cifar10_resnet20_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/cifar10_resnet20_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/cifar10_resnet20_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/cifar10_resnet20_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
mv cifar10_resnet20_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
mv cifar10_resnet20_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
mv cifar10_resnet20_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
mv /benchmarks/cifar10_resnet20_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
mv /benchmarks/cifar10_resnet20_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/
mv /benchmarks/cifar10_resnet20_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet20_sync_xla_w1.pbtxt 2> cifar10_resnet20_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet20_sync_xla_w2.pbtxt 2> cifar10_resnet20_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/cifar10_resnet20_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/cifar10_resnet20_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/cifar10_resnet20_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/cifar10_resnet20_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
mv cifar10_resnet20_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
mv cifar10_resnet20_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
mv cifar10_resnet20_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
mv /benchmarks/cifar10_resnet20_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
mv /benchmarks/cifar10_resnet20_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/
mv /benchmarks/cifar10_resnet20_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_batch32_w1.pbtxt 2> cifar10_resnet20_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_batch32_w2.pbtxt 2> cifar10_resnet20_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/cifar10_resnet20_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/cifar10_resnet20_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/cifar10_resnet20_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/cifar10_resnet20_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
mv cifar10_resnet20_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
mv cifar10_resnet20_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
mv cifar10_resnet20_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
mv /benchmarks/cifar10_resnet20_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
mv /benchmarks/cifar10_resnet20_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/
mv /benchmarks/cifar10_resnet20_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_batch64_w1.pbtxt 2> cifar10_resnet20_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_batch64_w2.pbtxt 2> cifar10_resnet20_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/cifar10_resnet20_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/cifar10_resnet20_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/cifar10_resnet20_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/cifar10_resnet20_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
mv cifar10_resnet20_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
mv cifar10_resnet20_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
mv cifar10_resnet20_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
mv /benchmarks/cifar10_resnet20_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
mv /benchmarks/cifar10_resnet20_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/
mv /benchmarks/cifar10_resnet20_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_batch128_w1.pbtxt 2> cifar10_resnet20_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_batch128_w2.pbtxt 2> cifar10_resnet20_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/cifar10_resnet20_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/cifar10_resnet20_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/cifar10_resnet20_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/cifar10_resnet20_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
mv cifar10_resnet20_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
mv cifar10_resnet20_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
mv cifar10_resnet20_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
mv /benchmarks/cifar10_resnet20_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
mv /benchmarks/cifar10_resnet20_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/
mv /benchmarks/cifar10_resnet20_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_batch256_w1.pbtxt 2> cifar10_resnet20_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_batch256_w2.pbtxt 2> cifar10_resnet20_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/cifar10_resnet20_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/cifar10_resnet20_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/cifar10_resnet20_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/cifar10_resnet20_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
mv cifar10_resnet20_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
mv cifar10_resnet20_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
mv cifar10_resnet20_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
mv /benchmarks/cifar10_resnet20_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
mv /benchmarks/cifar10_resnet20_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/
mv /benchmarks/cifar10_resnet20_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_batch512_w1.pbtxt 2> cifar10_resnet20_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_batch512_w2.pbtxt 2> cifar10_resnet20_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/cifar10_resnet20_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/cifar10_resnet20_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/cifar10_resnet20_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/cifar10_resnet20_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
mv cifar10_resnet20_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
mv cifar10_resnet20_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
mv cifar10_resnet20_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
mv /benchmarks/cifar10_resnet20_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
mv /benchmarks/cifar10_resnet20_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/
mv /benchmarks/cifar10_resnet20_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_use_fp16_w1.pbtxt 2> cifar10_resnet20_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_use_fp16_w2.pbtxt 2> cifar10_resnet20_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/cifar10_resnet20_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/cifar10_resnet20_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/cifar10_resnet20_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/cifar10_resnet20_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
mv cifar10_resnet20_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
mv cifar10_resnet20_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
mv cifar10_resnet20_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
mv /benchmarks/cifar10_resnet20_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
mv /benchmarks/cifar10_resnet20_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/
mv /benchmarks/cifar10_resnet20_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_optMomentum_w1.pbtxt 2> cifar10_resnet20_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_optMomentum_w2.pbtxt 2> cifar10_resnet20_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/cifar10_resnet20_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/cifar10_resnet20_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/cifar10_resnet20_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/cifar10_resnet20_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
mv cifar10_resnet20_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
mv cifar10_resnet20_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
mv cifar10_resnet20_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
mv /benchmarks/cifar10_resnet20_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
mv /benchmarks/cifar10_resnet20_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/
mv /benchmarks/cifar10_resnet20_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_optRmsprop_w1.pbtxt 2> cifar10_resnet20_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_optRmsprop_w2.pbtxt 2> cifar10_resnet20_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/cifar10_resnet20_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/cifar10_resnet20_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/cifar10_resnet20_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/cifar10_resnet20_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
mv cifar10_resnet20_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
mv cifar10_resnet20_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
mv cifar10_resnet20_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
mv /benchmarks/cifar10_resnet20_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
mv /benchmarks/cifar10_resnet20_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/
mv /benchmarks/cifar10_resnet20_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_dataFormat_w1.pbtxt 2> cifar10_resnet20_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_dataFormat_w2.pbtxt 2> cifar10_resnet20_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/cifar10_resnet20_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/cifar10_resnet20_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/cifar10_resnet20_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/cifar10_resnet20_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
mv cifar10_resnet20_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
mv cifar10_resnet20_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
mv cifar10_resnet20_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
mv /benchmarks/cifar10_resnet20_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
mv /benchmarks/cifar10_resnet20_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/
mv /benchmarks/cifar10_resnet20_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_winograd_w1.pbtxt 2> cifar10_resnet20_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_winograd_w2.pbtxt 2> cifar10_resnet20_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/cifar10_resnet20_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/cifar10_resnet20_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/cifar10_resnet20_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/cifar10_resnet20_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
mv cifar10_resnet20_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
mv cifar10_resnet20_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
mv cifar10_resnet20_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
mv /benchmarks/cifar10_resnet20_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
mv /benchmarks/cifar10_resnet20_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/
mv /benchmarks/cifar10_resnet20_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet20_async_xla_w1.pbtxt 2> cifar10_resnet20_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet20_async_xla_w2.pbtxt 2> cifar10_resnet20_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/cifar10_resnet20_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/cifar10_resnet20_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/cifar10_resnet20_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/cifar10_resnet20_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
mv cifar10_resnet20_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
mv cifar10_resnet20_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
mv cifar10_resnet20_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
mv /benchmarks/cifar10_resnet20_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
mv /benchmarks/cifar10_resnet20_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/
mv /benchmarks/cifar10_resnet20_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch32_w1.pbtxt 2> cifar10_resnet20_v2_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch32_w2.pbtxt 2> cifar10_resnet20_v2_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/cifar10_resnet20_v2_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/cifar10_resnet20_v2_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/cifar10_resnet20_v2_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/cifar10_resnet20_v2_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
mv cifar10_resnet20_v2_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
mv cifar10_resnet20_v2_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
mv cifar10_resnet20_v2_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
mv /benchmarks/cifar10_resnet20_v2_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
mv /benchmarks/cifar10_resnet20_v2_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/
mv /benchmarks/cifar10_resnet20_v2_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch64_w1.pbtxt 2> cifar10_resnet20_v2_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch64_w2.pbtxt 2> cifar10_resnet20_v2_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/cifar10_resnet20_v2_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/cifar10_resnet20_v2_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/cifar10_resnet20_v2_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/cifar10_resnet20_v2_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
mv cifar10_resnet20_v2_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
mv cifar10_resnet20_v2_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
mv cifar10_resnet20_v2_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
mv /benchmarks/cifar10_resnet20_v2_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
mv /benchmarks/cifar10_resnet20_v2_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/
mv /benchmarks/cifar10_resnet20_v2_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch128_w1.pbtxt 2> cifar10_resnet20_v2_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch128_w2.pbtxt 2> cifar10_resnet20_v2_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/cifar10_resnet20_v2_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/cifar10_resnet20_v2_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/cifar10_resnet20_v2_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/cifar10_resnet20_v2_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
mv cifar10_resnet20_v2_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
mv cifar10_resnet20_v2_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
mv cifar10_resnet20_v2_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
mv /benchmarks/cifar10_resnet20_v2_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
mv /benchmarks/cifar10_resnet20_v2_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/
mv /benchmarks/cifar10_resnet20_v2_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch256_w1.pbtxt 2> cifar10_resnet20_v2_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch256_w2.pbtxt 2> cifar10_resnet20_v2_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/cifar10_resnet20_v2_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/cifar10_resnet20_v2_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/cifar10_resnet20_v2_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/cifar10_resnet20_v2_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
mv cifar10_resnet20_v2_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
mv cifar10_resnet20_v2_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
mv cifar10_resnet20_v2_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
mv /benchmarks/cifar10_resnet20_v2_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
mv /benchmarks/cifar10_resnet20_v2_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/
mv /benchmarks/cifar10_resnet20_v2_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch512_w1.pbtxt 2> cifar10_resnet20_v2_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_batch512_w2.pbtxt 2> cifar10_resnet20_v2_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/cifar10_resnet20_v2_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/cifar10_resnet20_v2_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/cifar10_resnet20_v2_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/cifar10_resnet20_v2_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
mv cifar10_resnet20_v2_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
mv cifar10_resnet20_v2_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
mv cifar10_resnet20_v2_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
mv /benchmarks/cifar10_resnet20_v2_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
mv /benchmarks/cifar10_resnet20_v2_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/
mv /benchmarks/cifar10_resnet20_v2_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_use_fp16_w1.pbtxt 2> cifar10_resnet20_v2_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_use_fp16_w2.pbtxt 2> cifar10_resnet20_v2_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/cifar10_resnet20_v2_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/cifar10_resnet20_v2_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/cifar10_resnet20_v2_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/cifar10_resnet20_v2_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
mv cifar10_resnet20_v2_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
mv cifar10_resnet20_v2_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
mv cifar10_resnet20_v2_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet20_v2_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet20_v2_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet20_v2_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_optMomentum_w1.pbtxt 2> cifar10_resnet20_v2_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_optMomentum_w2.pbtxt 2> cifar10_resnet20_v2_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/cifar10_resnet20_v2_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/cifar10_resnet20_v2_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/cifar10_resnet20_v2_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/cifar10_resnet20_v2_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
mv cifar10_resnet20_v2_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
mv cifar10_resnet20_v2_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
mv cifar10_resnet20_v2_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet20_v2_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet20_v2_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet20_v2_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet20_v2_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet20_v2_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/cifar10_resnet20_v2_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/cifar10_resnet20_v2_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/cifar10_resnet20_v2_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/cifar10_resnet20_v2_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
mv cifar10_resnet20_v2_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
mv cifar10_resnet20_v2_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
mv cifar10_resnet20_v2_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet20_v2_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_dataFormat_w1.pbtxt 2> cifar10_resnet20_v2_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_dataFormat_w2.pbtxt 2> cifar10_resnet20_v2_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/cifar10_resnet20_v2_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/cifar10_resnet20_v2_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/cifar10_resnet20_v2_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/cifar10_resnet20_v2_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
mv cifar10_resnet20_v2_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
mv cifar10_resnet20_v2_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
mv cifar10_resnet20_v2_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet20_v2_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet20_v2_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet20_v2_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_winograd_w1.pbtxt 2> cifar10_resnet20_v2_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_winograd_w2.pbtxt 2> cifar10_resnet20_v2_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/cifar10_resnet20_v2_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/cifar10_resnet20_v2_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/cifar10_resnet20_v2_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/cifar10_resnet20_v2_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
mv cifar10_resnet20_v2_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
mv cifar10_resnet20_v2_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
mv cifar10_resnet20_v2_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
mv /benchmarks/cifar10_resnet20_v2_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
mv /benchmarks/cifar10_resnet20_v2_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/
mv /benchmarks/cifar10_resnet20_v2_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_xla_w1.pbtxt 2> cifar10_resnet20_v2_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_sync_xla_w2.pbtxt 2> cifar10_resnet20_v2_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/cifar10_resnet20_v2_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/cifar10_resnet20_v2_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/cifar10_resnet20_v2_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/cifar10_resnet20_v2_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
mv cifar10_resnet20_v2_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
mv cifar10_resnet20_v2_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
mv cifar10_resnet20_v2_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
mv /benchmarks/cifar10_resnet20_v2_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
mv /benchmarks/cifar10_resnet20_v2_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/
mv /benchmarks/cifar10_resnet20_v2_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch32_w1.pbtxt 2> cifar10_resnet20_v2_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch32_w2.pbtxt 2> cifar10_resnet20_v2_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/cifar10_resnet20_v2_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/cifar10_resnet20_v2_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/cifar10_resnet20_v2_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/cifar10_resnet20_v2_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
mv cifar10_resnet20_v2_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
mv cifar10_resnet20_v2_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
mv cifar10_resnet20_v2_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
mv /benchmarks/cifar10_resnet20_v2_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
mv /benchmarks/cifar10_resnet20_v2_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/
mv /benchmarks/cifar10_resnet20_v2_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch64_w1.pbtxt 2> cifar10_resnet20_v2_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch64_w2.pbtxt 2> cifar10_resnet20_v2_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/cifar10_resnet20_v2_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/cifar10_resnet20_v2_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/cifar10_resnet20_v2_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/cifar10_resnet20_v2_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
mv cifar10_resnet20_v2_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
mv cifar10_resnet20_v2_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
mv cifar10_resnet20_v2_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
mv /benchmarks/cifar10_resnet20_v2_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
mv /benchmarks/cifar10_resnet20_v2_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/
mv /benchmarks/cifar10_resnet20_v2_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch128_w1.pbtxt 2> cifar10_resnet20_v2_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch128_w2.pbtxt 2> cifar10_resnet20_v2_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/cifar10_resnet20_v2_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/cifar10_resnet20_v2_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/cifar10_resnet20_v2_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/cifar10_resnet20_v2_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
mv cifar10_resnet20_v2_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
mv cifar10_resnet20_v2_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
mv cifar10_resnet20_v2_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
mv /benchmarks/cifar10_resnet20_v2_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
mv /benchmarks/cifar10_resnet20_v2_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/
mv /benchmarks/cifar10_resnet20_v2_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch256_w1.pbtxt 2> cifar10_resnet20_v2_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch256_w2.pbtxt 2> cifar10_resnet20_v2_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/cifar10_resnet20_v2_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/cifar10_resnet20_v2_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/cifar10_resnet20_v2_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/cifar10_resnet20_v2_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
mv cifar10_resnet20_v2_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
mv cifar10_resnet20_v2_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
mv cifar10_resnet20_v2_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
mv /benchmarks/cifar10_resnet20_v2_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
mv /benchmarks/cifar10_resnet20_v2_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/
mv /benchmarks/cifar10_resnet20_v2_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch512_w1.pbtxt 2> cifar10_resnet20_v2_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_batch512_w2.pbtxt 2> cifar10_resnet20_v2_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/cifar10_resnet20_v2_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/cifar10_resnet20_v2_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/cifar10_resnet20_v2_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/cifar10_resnet20_v2_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
mv cifar10_resnet20_v2_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
mv cifar10_resnet20_v2_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
mv cifar10_resnet20_v2_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
mv /benchmarks/cifar10_resnet20_v2_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
mv /benchmarks/cifar10_resnet20_v2_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/
mv /benchmarks/cifar10_resnet20_v2_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_use_fp16_w1.pbtxt 2> cifar10_resnet20_v2_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_use_fp16_w2.pbtxt 2> cifar10_resnet20_v2_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/cifar10_resnet20_v2_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/cifar10_resnet20_v2_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/cifar10_resnet20_v2_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/cifar10_resnet20_v2_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
mv cifar10_resnet20_v2_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
mv cifar10_resnet20_v2_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
mv cifar10_resnet20_v2_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet20_v2_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet20_v2_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet20_v2_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_optMomentum_w1.pbtxt 2> cifar10_resnet20_v2_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_optMomentum_w2.pbtxt 2> cifar10_resnet20_v2_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/cifar10_resnet20_v2_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/cifar10_resnet20_v2_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/cifar10_resnet20_v2_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/cifar10_resnet20_v2_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
mv cifar10_resnet20_v2_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
mv cifar10_resnet20_v2_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
mv cifar10_resnet20_v2_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet20_v2_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet20_v2_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet20_v2_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_optRmsprop_w1.pbtxt 2> cifar10_resnet20_v2_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_optRmsprop_w2.pbtxt 2> cifar10_resnet20_v2_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/cifar10_resnet20_v2_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/cifar10_resnet20_v2_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/cifar10_resnet20_v2_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/cifar10_resnet20_v2_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
mv cifar10_resnet20_v2_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
mv cifar10_resnet20_v2_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
mv cifar10_resnet20_v2_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet20_v2_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet20_v2_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet20_v2_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_dataFormat_w1.pbtxt 2> cifar10_resnet20_v2_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_dataFormat_w2.pbtxt 2> cifar10_resnet20_v2_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/cifar10_resnet20_v2_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/cifar10_resnet20_v2_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/cifar10_resnet20_v2_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/cifar10_resnet20_v2_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
mv cifar10_resnet20_v2_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
mv cifar10_resnet20_v2_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
mv cifar10_resnet20_v2_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet20_v2_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet20_v2_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet20_v2_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_winograd_w1.pbtxt 2> cifar10_resnet20_v2_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_winograd_w2.pbtxt 2> cifar10_resnet20_v2_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/cifar10_resnet20_v2_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/cifar10_resnet20_v2_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/cifar10_resnet20_v2_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/cifar10_resnet20_v2_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
mv cifar10_resnet20_v2_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
mv cifar10_resnet20_v2_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
mv cifar10_resnet20_v2_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
mv /benchmarks/cifar10_resnet20_v2_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
mv /benchmarks/cifar10_resnet20_v2_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/
mv /benchmarks/cifar10_resnet20_v2_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet20_v2_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_xla_w1.pbtxt 2> cifar10_resnet20_v2_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet20_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet20_v2_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet20_v2_async_xla_w2.pbtxt 2> cifar10_resnet20_v2_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/cifar10_resnet20_v2_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/cifar10_resnet20_v2_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/cifar10_resnet20_v2_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/cifar10_resnet20_v2_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet20_v2_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
mv cifar10_resnet20_v2_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
mv cifar10_resnet20_v2_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
mv cifar10_resnet20_v2_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet20_v2_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
mv /benchmarks/cifar10_resnet20_v2_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
mv /benchmarks/cifar10_resnet20_v2_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/
mv /benchmarks/cifar10_resnet20_v2_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet20_v2_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch32_w1.pbtxt 2> cifar10_resnet32_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch32_w2.pbtxt 2> cifar10_resnet32_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/cifar10_resnet32_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/cifar10_resnet32_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/cifar10_resnet32_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/cifar10_resnet32_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
mv cifar10_resnet32_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
mv cifar10_resnet32_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
mv cifar10_resnet32_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
mv /benchmarks/cifar10_resnet32_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
mv /benchmarks/cifar10_resnet32_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/
mv /benchmarks/cifar10_resnet32_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch64_w1.pbtxt 2> cifar10_resnet32_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch64_w2.pbtxt 2> cifar10_resnet32_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/cifar10_resnet32_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/cifar10_resnet32_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/cifar10_resnet32_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/cifar10_resnet32_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
mv cifar10_resnet32_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
mv cifar10_resnet32_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
mv cifar10_resnet32_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
mv /benchmarks/cifar10_resnet32_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
mv /benchmarks/cifar10_resnet32_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/
mv /benchmarks/cifar10_resnet32_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch128_w1.pbtxt 2> cifar10_resnet32_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch128_w2.pbtxt 2> cifar10_resnet32_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/cifar10_resnet32_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/cifar10_resnet32_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/cifar10_resnet32_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/cifar10_resnet32_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
mv cifar10_resnet32_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
mv cifar10_resnet32_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
mv cifar10_resnet32_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
mv /benchmarks/cifar10_resnet32_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
mv /benchmarks/cifar10_resnet32_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/
mv /benchmarks/cifar10_resnet32_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch256_w1.pbtxt 2> cifar10_resnet32_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch256_w2.pbtxt 2> cifar10_resnet32_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/cifar10_resnet32_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/cifar10_resnet32_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/cifar10_resnet32_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/cifar10_resnet32_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
mv cifar10_resnet32_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
mv cifar10_resnet32_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
mv cifar10_resnet32_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
mv /benchmarks/cifar10_resnet32_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
mv /benchmarks/cifar10_resnet32_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/
mv /benchmarks/cifar10_resnet32_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch512_w1.pbtxt 2> cifar10_resnet32_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_batch512_w2.pbtxt 2> cifar10_resnet32_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/cifar10_resnet32_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/cifar10_resnet32_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/cifar10_resnet32_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/cifar10_resnet32_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
mv cifar10_resnet32_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
mv cifar10_resnet32_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
mv cifar10_resnet32_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
mv /benchmarks/cifar10_resnet32_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
mv /benchmarks/cifar10_resnet32_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/
mv /benchmarks/cifar10_resnet32_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_use_fp16_w1.pbtxt 2> cifar10_resnet32_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_use_fp16_w2.pbtxt 2> cifar10_resnet32_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/cifar10_resnet32_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/cifar10_resnet32_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/cifar10_resnet32_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/cifar10_resnet32_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
mv cifar10_resnet32_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
mv cifar10_resnet32_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
mv cifar10_resnet32_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
mv /benchmarks/cifar10_resnet32_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
mv /benchmarks/cifar10_resnet32_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/
mv /benchmarks/cifar10_resnet32_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_optMomentum_w1.pbtxt 2> cifar10_resnet32_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_optMomentum_w2.pbtxt 2> cifar10_resnet32_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/cifar10_resnet32_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/cifar10_resnet32_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/cifar10_resnet32_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/cifar10_resnet32_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
mv cifar10_resnet32_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
mv cifar10_resnet32_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
mv cifar10_resnet32_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
mv /benchmarks/cifar10_resnet32_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
mv /benchmarks/cifar10_resnet32_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/
mv /benchmarks/cifar10_resnet32_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet32_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet32_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/cifar10_resnet32_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/cifar10_resnet32_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/cifar10_resnet32_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/cifar10_resnet32_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
mv cifar10_resnet32_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
mv cifar10_resnet32_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
mv cifar10_resnet32_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
mv /benchmarks/cifar10_resnet32_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
mv /benchmarks/cifar10_resnet32_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/
mv /benchmarks/cifar10_resnet32_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_dataFormat_w1.pbtxt 2> cifar10_resnet32_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_dataFormat_w2.pbtxt 2> cifar10_resnet32_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/cifar10_resnet32_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/cifar10_resnet32_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/cifar10_resnet32_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/cifar10_resnet32_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
mv cifar10_resnet32_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
mv cifar10_resnet32_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
mv cifar10_resnet32_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
mv /benchmarks/cifar10_resnet32_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
mv /benchmarks/cifar10_resnet32_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/
mv /benchmarks/cifar10_resnet32_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_winograd_w1.pbtxt 2> cifar10_resnet32_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_winograd_w2.pbtxt 2> cifar10_resnet32_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/cifar10_resnet32_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/cifar10_resnet32_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/cifar10_resnet32_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/cifar10_resnet32_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
mv cifar10_resnet32_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
mv cifar10_resnet32_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
mv cifar10_resnet32_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
mv /benchmarks/cifar10_resnet32_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
mv /benchmarks/cifar10_resnet32_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/
mv /benchmarks/cifar10_resnet32_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet32_sync_xla_w1.pbtxt 2> cifar10_resnet32_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet32_sync_xla_w2.pbtxt 2> cifar10_resnet32_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/cifar10_resnet32_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/cifar10_resnet32_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/cifar10_resnet32_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/cifar10_resnet32_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
mv cifar10_resnet32_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
mv cifar10_resnet32_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
mv cifar10_resnet32_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
mv /benchmarks/cifar10_resnet32_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
mv /benchmarks/cifar10_resnet32_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/
mv /benchmarks/cifar10_resnet32_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_batch32_w1.pbtxt 2> cifar10_resnet32_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_batch32_w2.pbtxt 2> cifar10_resnet32_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/cifar10_resnet32_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/cifar10_resnet32_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/cifar10_resnet32_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/cifar10_resnet32_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
mv cifar10_resnet32_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
mv cifar10_resnet32_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
mv cifar10_resnet32_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
mv /benchmarks/cifar10_resnet32_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
mv /benchmarks/cifar10_resnet32_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/
mv /benchmarks/cifar10_resnet32_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_batch64_w1.pbtxt 2> cifar10_resnet32_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_batch64_w2.pbtxt 2> cifar10_resnet32_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/cifar10_resnet32_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/cifar10_resnet32_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/cifar10_resnet32_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/cifar10_resnet32_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
mv cifar10_resnet32_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
mv cifar10_resnet32_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
mv cifar10_resnet32_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
mv /benchmarks/cifar10_resnet32_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
mv /benchmarks/cifar10_resnet32_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/
mv /benchmarks/cifar10_resnet32_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_batch128_w1.pbtxt 2> cifar10_resnet32_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_batch128_w2.pbtxt 2> cifar10_resnet32_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/cifar10_resnet32_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/cifar10_resnet32_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/cifar10_resnet32_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/cifar10_resnet32_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
mv cifar10_resnet32_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
mv cifar10_resnet32_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
mv cifar10_resnet32_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
mv /benchmarks/cifar10_resnet32_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
mv /benchmarks/cifar10_resnet32_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/
mv /benchmarks/cifar10_resnet32_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_batch256_w1.pbtxt 2> cifar10_resnet32_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_batch256_w2.pbtxt 2> cifar10_resnet32_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/cifar10_resnet32_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/cifar10_resnet32_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/cifar10_resnet32_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/cifar10_resnet32_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
mv cifar10_resnet32_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
mv cifar10_resnet32_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
mv cifar10_resnet32_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
mv /benchmarks/cifar10_resnet32_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
mv /benchmarks/cifar10_resnet32_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/
mv /benchmarks/cifar10_resnet32_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_batch512_w1.pbtxt 2> cifar10_resnet32_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_batch512_w2.pbtxt 2> cifar10_resnet32_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/cifar10_resnet32_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/cifar10_resnet32_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/cifar10_resnet32_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/cifar10_resnet32_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
mv cifar10_resnet32_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
mv cifar10_resnet32_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
mv cifar10_resnet32_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
mv /benchmarks/cifar10_resnet32_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
mv /benchmarks/cifar10_resnet32_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/
mv /benchmarks/cifar10_resnet32_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_use_fp16_w1.pbtxt 2> cifar10_resnet32_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_use_fp16_w2.pbtxt 2> cifar10_resnet32_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/cifar10_resnet32_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/cifar10_resnet32_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/cifar10_resnet32_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/cifar10_resnet32_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
mv cifar10_resnet32_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
mv cifar10_resnet32_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
mv cifar10_resnet32_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
mv /benchmarks/cifar10_resnet32_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
mv /benchmarks/cifar10_resnet32_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/
mv /benchmarks/cifar10_resnet32_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_optMomentum_w1.pbtxt 2> cifar10_resnet32_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_optMomentum_w2.pbtxt 2> cifar10_resnet32_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/cifar10_resnet32_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/cifar10_resnet32_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/cifar10_resnet32_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/cifar10_resnet32_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
mv cifar10_resnet32_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
mv cifar10_resnet32_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
mv cifar10_resnet32_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
mv /benchmarks/cifar10_resnet32_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
mv /benchmarks/cifar10_resnet32_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/
mv /benchmarks/cifar10_resnet32_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_optRmsprop_w1.pbtxt 2> cifar10_resnet32_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_optRmsprop_w2.pbtxt 2> cifar10_resnet32_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/cifar10_resnet32_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/cifar10_resnet32_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/cifar10_resnet32_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/cifar10_resnet32_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
mv cifar10_resnet32_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
mv cifar10_resnet32_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
mv cifar10_resnet32_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
mv /benchmarks/cifar10_resnet32_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
mv /benchmarks/cifar10_resnet32_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/
mv /benchmarks/cifar10_resnet32_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_dataFormat_w1.pbtxt 2> cifar10_resnet32_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_dataFormat_w2.pbtxt 2> cifar10_resnet32_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/cifar10_resnet32_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/cifar10_resnet32_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/cifar10_resnet32_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/cifar10_resnet32_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
mv cifar10_resnet32_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
mv cifar10_resnet32_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
mv cifar10_resnet32_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
mv /benchmarks/cifar10_resnet32_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
mv /benchmarks/cifar10_resnet32_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/
mv /benchmarks/cifar10_resnet32_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_winograd_w1.pbtxt 2> cifar10_resnet32_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_winograd_w2.pbtxt 2> cifar10_resnet32_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/cifar10_resnet32_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/cifar10_resnet32_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/cifar10_resnet32_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/cifar10_resnet32_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
mv cifar10_resnet32_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
mv cifar10_resnet32_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
mv cifar10_resnet32_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
mv /benchmarks/cifar10_resnet32_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
mv /benchmarks/cifar10_resnet32_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/
mv /benchmarks/cifar10_resnet32_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet32_async_xla_w1.pbtxt 2> cifar10_resnet32_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet32_async_xla_w2.pbtxt 2> cifar10_resnet32_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/cifar10_resnet32_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/cifar10_resnet32_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/cifar10_resnet32_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/cifar10_resnet32_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
mv cifar10_resnet32_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
mv cifar10_resnet32_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
mv cifar10_resnet32_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
mv /benchmarks/cifar10_resnet32_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
mv /benchmarks/cifar10_resnet32_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/
mv /benchmarks/cifar10_resnet32_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch32_w1.pbtxt 2> cifar10_resnet32_v2_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch32_w2.pbtxt 2> cifar10_resnet32_v2_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/cifar10_resnet32_v2_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/cifar10_resnet32_v2_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/cifar10_resnet32_v2_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/cifar10_resnet32_v2_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
mv cifar10_resnet32_v2_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
mv cifar10_resnet32_v2_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
mv cifar10_resnet32_v2_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
mv /benchmarks/cifar10_resnet32_v2_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
mv /benchmarks/cifar10_resnet32_v2_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/
mv /benchmarks/cifar10_resnet32_v2_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch64_w1.pbtxt 2> cifar10_resnet32_v2_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch64_w2.pbtxt 2> cifar10_resnet32_v2_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/cifar10_resnet32_v2_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/cifar10_resnet32_v2_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/cifar10_resnet32_v2_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/cifar10_resnet32_v2_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
mv cifar10_resnet32_v2_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
mv cifar10_resnet32_v2_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
mv cifar10_resnet32_v2_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
mv /benchmarks/cifar10_resnet32_v2_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
mv /benchmarks/cifar10_resnet32_v2_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/
mv /benchmarks/cifar10_resnet32_v2_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch128_w1.pbtxt 2> cifar10_resnet32_v2_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch128_w2.pbtxt 2> cifar10_resnet32_v2_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/cifar10_resnet32_v2_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/cifar10_resnet32_v2_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/cifar10_resnet32_v2_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/cifar10_resnet32_v2_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
mv cifar10_resnet32_v2_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
mv cifar10_resnet32_v2_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
mv cifar10_resnet32_v2_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
mv /benchmarks/cifar10_resnet32_v2_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
mv /benchmarks/cifar10_resnet32_v2_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/
mv /benchmarks/cifar10_resnet32_v2_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch256_w1.pbtxt 2> cifar10_resnet32_v2_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch256_w2.pbtxt 2> cifar10_resnet32_v2_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/cifar10_resnet32_v2_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/cifar10_resnet32_v2_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/cifar10_resnet32_v2_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/cifar10_resnet32_v2_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
mv cifar10_resnet32_v2_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
mv cifar10_resnet32_v2_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
mv cifar10_resnet32_v2_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
mv /benchmarks/cifar10_resnet32_v2_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
mv /benchmarks/cifar10_resnet32_v2_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/
mv /benchmarks/cifar10_resnet32_v2_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch512_w1.pbtxt 2> cifar10_resnet32_v2_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_batch512_w2.pbtxt 2> cifar10_resnet32_v2_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/cifar10_resnet32_v2_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/cifar10_resnet32_v2_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/cifar10_resnet32_v2_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/cifar10_resnet32_v2_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
mv cifar10_resnet32_v2_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
mv cifar10_resnet32_v2_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
mv cifar10_resnet32_v2_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
mv /benchmarks/cifar10_resnet32_v2_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
mv /benchmarks/cifar10_resnet32_v2_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/
mv /benchmarks/cifar10_resnet32_v2_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_use_fp16_w1.pbtxt 2> cifar10_resnet32_v2_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_use_fp16_w2.pbtxt 2> cifar10_resnet32_v2_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/cifar10_resnet32_v2_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/cifar10_resnet32_v2_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/cifar10_resnet32_v2_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/cifar10_resnet32_v2_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
mv cifar10_resnet32_v2_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
mv cifar10_resnet32_v2_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
mv cifar10_resnet32_v2_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet32_v2_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet32_v2_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet32_v2_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_optMomentum_w1.pbtxt 2> cifar10_resnet32_v2_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_optMomentum_w2.pbtxt 2> cifar10_resnet32_v2_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/cifar10_resnet32_v2_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/cifar10_resnet32_v2_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/cifar10_resnet32_v2_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/cifar10_resnet32_v2_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
mv cifar10_resnet32_v2_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
mv cifar10_resnet32_v2_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
mv cifar10_resnet32_v2_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet32_v2_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet32_v2_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet32_v2_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet32_v2_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet32_v2_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/cifar10_resnet32_v2_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/cifar10_resnet32_v2_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/cifar10_resnet32_v2_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/cifar10_resnet32_v2_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
mv cifar10_resnet32_v2_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
mv cifar10_resnet32_v2_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
mv cifar10_resnet32_v2_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet32_v2_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_dataFormat_w1.pbtxt 2> cifar10_resnet32_v2_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_dataFormat_w2.pbtxt 2> cifar10_resnet32_v2_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/cifar10_resnet32_v2_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/cifar10_resnet32_v2_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/cifar10_resnet32_v2_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/cifar10_resnet32_v2_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
mv cifar10_resnet32_v2_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
mv cifar10_resnet32_v2_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
mv cifar10_resnet32_v2_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet32_v2_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet32_v2_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet32_v2_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_winograd_w1.pbtxt 2> cifar10_resnet32_v2_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_winograd_w2.pbtxt 2> cifar10_resnet32_v2_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/cifar10_resnet32_v2_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/cifar10_resnet32_v2_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/cifar10_resnet32_v2_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/cifar10_resnet32_v2_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
mv cifar10_resnet32_v2_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
mv cifar10_resnet32_v2_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
mv cifar10_resnet32_v2_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
mv /benchmarks/cifar10_resnet32_v2_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
mv /benchmarks/cifar10_resnet32_v2_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/
mv /benchmarks/cifar10_resnet32_v2_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_xla_w1.pbtxt 2> cifar10_resnet32_v2_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_sync_xla_w2.pbtxt 2> cifar10_resnet32_v2_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/cifar10_resnet32_v2_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/cifar10_resnet32_v2_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/cifar10_resnet32_v2_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/cifar10_resnet32_v2_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
mv cifar10_resnet32_v2_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
mv cifar10_resnet32_v2_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
mv cifar10_resnet32_v2_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
mv /benchmarks/cifar10_resnet32_v2_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
mv /benchmarks/cifar10_resnet32_v2_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/
mv /benchmarks/cifar10_resnet32_v2_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch32_w1.pbtxt 2> cifar10_resnet32_v2_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch32_w2.pbtxt 2> cifar10_resnet32_v2_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/cifar10_resnet32_v2_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/cifar10_resnet32_v2_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/cifar10_resnet32_v2_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/cifar10_resnet32_v2_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
mv cifar10_resnet32_v2_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
mv cifar10_resnet32_v2_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
mv cifar10_resnet32_v2_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
mv /benchmarks/cifar10_resnet32_v2_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
mv /benchmarks/cifar10_resnet32_v2_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/
mv /benchmarks/cifar10_resnet32_v2_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch64_w1.pbtxt 2> cifar10_resnet32_v2_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch64_w2.pbtxt 2> cifar10_resnet32_v2_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/cifar10_resnet32_v2_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/cifar10_resnet32_v2_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/cifar10_resnet32_v2_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/cifar10_resnet32_v2_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
mv cifar10_resnet32_v2_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
mv cifar10_resnet32_v2_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
mv cifar10_resnet32_v2_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
mv /benchmarks/cifar10_resnet32_v2_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
mv /benchmarks/cifar10_resnet32_v2_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/
mv /benchmarks/cifar10_resnet32_v2_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch128_w1.pbtxt 2> cifar10_resnet32_v2_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch128_w2.pbtxt 2> cifar10_resnet32_v2_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/cifar10_resnet32_v2_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/cifar10_resnet32_v2_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/cifar10_resnet32_v2_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/cifar10_resnet32_v2_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
mv cifar10_resnet32_v2_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
mv cifar10_resnet32_v2_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
mv cifar10_resnet32_v2_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
mv /benchmarks/cifar10_resnet32_v2_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
mv /benchmarks/cifar10_resnet32_v2_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/
mv /benchmarks/cifar10_resnet32_v2_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch256_w1.pbtxt 2> cifar10_resnet32_v2_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch256_w2.pbtxt 2> cifar10_resnet32_v2_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/cifar10_resnet32_v2_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/cifar10_resnet32_v2_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/cifar10_resnet32_v2_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/cifar10_resnet32_v2_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
mv cifar10_resnet32_v2_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
mv cifar10_resnet32_v2_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
mv cifar10_resnet32_v2_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
mv /benchmarks/cifar10_resnet32_v2_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
mv /benchmarks/cifar10_resnet32_v2_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/
mv /benchmarks/cifar10_resnet32_v2_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch512_w1.pbtxt 2> cifar10_resnet32_v2_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_batch512_w2.pbtxt 2> cifar10_resnet32_v2_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/cifar10_resnet32_v2_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/cifar10_resnet32_v2_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/cifar10_resnet32_v2_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/cifar10_resnet32_v2_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
mv cifar10_resnet32_v2_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
mv cifar10_resnet32_v2_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
mv cifar10_resnet32_v2_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
mv /benchmarks/cifar10_resnet32_v2_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
mv /benchmarks/cifar10_resnet32_v2_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/
mv /benchmarks/cifar10_resnet32_v2_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_use_fp16_w1.pbtxt 2> cifar10_resnet32_v2_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_use_fp16_w2.pbtxt 2> cifar10_resnet32_v2_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/cifar10_resnet32_v2_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/cifar10_resnet32_v2_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/cifar10_resnet32_v2_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/cifar10_resnet32_v2_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
mv cifar10_resnet32_v2_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
mv cifar10_resnet32_v2_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
mv cifar10_resnet32_v2_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet32_v2_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet32_v2_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet32_v2_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_optMomentum_w1.pbtxt 2> cifar10_resnet32_v2_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_optMomentum_w2.pbtxt 2> cifar10_resnet32_v2_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/cifar10_resnet32_v2_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/cifar10_resnet32_v2_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/cifar10_resnet32_v2_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/cifar10_resnet32_v2_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
mv cifar10_resnet32_v2_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
mv cifar10_resnet32_v2_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
mv cifar10_resnet32_v2_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet32_v2_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet32_v2_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet32_v2_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_optRmsprop_w1.pbtxt 2> cifar10_resnet32_v2_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_optRmsprop_w2.pbtxt 2> cifar10_resnet32_v2_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/cifar10_resnet32_v2_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/cifar10_resnet32_v2_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/cifar10_resnet32_v2_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/cifar10_resnet32_v2_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
mv cifar10_resnet32_v2_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
mv cifar10_resnet32_v2_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
mv cifar10_resnet32_v2_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet32_v2_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet32_v2_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet32_v2_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_dataFormat_w1.pbtxt 2> cifar10_resnet32_v2_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_dataFormat_w2.pbtxt 2> cifar10_resnet32_v2_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/cifar10_resnet32_v2_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/cifar10_resnet32_v2_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/cifar10_resnet32_v2_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/cifar10_resnet32_v2_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
mv cifar10_resnet32_v2_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
mv cifar10_resnet32_v2_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
mv cifar10_resnet32_v2_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet32_v2_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet32_v2_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet32_v2_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_winograd_w1.pbtxt 2> cifar10_resnet32_v2_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_winograd_w2.pbtxt 2> cifar10_resnet32_v2_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/cifar10_resnet32_v2_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/cifar10_resnet32_v2_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/cifar10_resnet32_v2_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/cifar10_resnet32_v2_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
mv cifar10_resnet32_v2_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
mv cifar10_resnet32_v2_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
mv cifar10_resnet32_v2_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
mv /benchmarks/cifar10_resnet32_v2_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
mv /benchmarks/cifar10_resnet32_v2_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/
mv /benchmarks/cifar10_resnet32_v2_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet32_v2_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_xla_w1.pbtxt 2> cifar10_resnet32_v2_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet32_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet32_v2_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet32_v2_async_xla_w2.pbtxt 2> cifar10_resnet32_v2_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/cifar10_resnet32_v2_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/cifar10_resnet32_v2_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/cifar10_resnet32_v2_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/cifar10_resnet32_v2_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet32_v2_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
mv cifar10_resnet32_v2_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
mv cifar10_resnet32_v2_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
mv cifar10_resnet32_v2_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet32_v2_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
mv /benchmarks/cifar10_resnet32_v2_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
mv /benchmarks/cifar10_resnet32_v2_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/
mv /benchmarks/cifar10_resnet32_v2_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet32_v2_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch32_w1.pbtxt 2> cifar10_resnet44_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch32_w2.pbtxt 2> cifar10_resnet44_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/cifar10_resnet44_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/cifar10_resnet44_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/cifar10_resnet44_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/cifar10_resnet44_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
mv cifar10_resnet44_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
mv cifar10_resnet44_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
mv cifar10_resnet44_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
mv /benchmarks/cifar10_resnet44_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
mv /benchmarks/cifar10_resnet44_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/
mv /benchmarks/cifar10_resnet44_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch64_w1.pbtxt 2> cifar10_resnet44_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch64_w2.pbtxt 2> cifar10_resnet44_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/cifar10_resnet44_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/cifar10_resnet44_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/cifar10_resnet44_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/cifar10_resnet44_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
mv cifar10_resnet44_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
mv cifar10_resnet44_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
mv cifar10_resnet44_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
mv /benchmarks/cifar10_resnet44_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
mv /benchmarks/cifar10_resnet44_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/
mv /benchmarks/cifar10_resnet44_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch128_w1.pbtxt 2> cifar10_resnet44_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch128_w2.pbtxt 2> cifar10_resnet44_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/cifar10_resnet44_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/cifar10_resnet44_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/cifar10_resnet44_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/cifar10_resnet44_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
mv cifar10_resnet44_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
mv cifar10_resnet44_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
mv cifar10_resnet44_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
mv /benchmarks/cifar10_resnet44_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
mv /benchmarks/cifar10_resnet44_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/
mv /benchmarks/cifar10_resnet44_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch256_w1.pbtxt 2> cifar10_resnet44_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch256_w2.pbtxt 2> cifar10_resnet44_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/cifar10_resnet44_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/cifar10_resnet44_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/cifar10_resnet44_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/cifar10_resnet44_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
mv cifar10_resnet44_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
mv cifar10_resnet44_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
mv cifar10_resnet44_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
mv /benchmarks/cifar10_resnet44_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
mv /benchmarks/cifar10_resnet44_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/
mv /benchmarks/cifar10_resnet44_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch512_w1.pbtxt 2> cifar10_resnet44_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_batch512_w2.pbtxt 2> cifar10_resnet44_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/cifar10_resnet44_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/cifar10_resnet44_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/cifar10_resnet44_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/cifar10_resnet44_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
mv cifar10_resnet44_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
mv cifar10_resnet44_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
mv cifar10_resnet44_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
mv /benchmarks/cifar10_resnet44_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
mv /benchmarks/cifar10_resnet44_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/
mv /benchmarks/cifar10_resnet44_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_use_fp16_w1.pbtxt 2> cifar10_resnet44_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_use_fp16_w2.pbtxt 2> cifar10_resnet44_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/cifar10_resnet44_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/cifar10_resnet44_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/cifar10_resnet44_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/cifar10_resnet44_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
mv cifar10_resnet44_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
mv cifar10_resnet44_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
mv cifar10_resnet44_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
mv /benchmarks/cifar10_resnet44_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
mv /benchmarks/cifar10_resnet44_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/
mv /benchmarks/cifar10_resnet44_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_optMomentum_w1.pbtxt 2> cifar10_resnet44_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_optMomentum_w2.pbtxt 2> cifar10_resnet44_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/cifar10_resnet44_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/cifar10_resnet44_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/cifar10_resnet44_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/cifar10_resnet44_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
mv cifar10_resnet44_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
mv cifar10_resnet44_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
mv cifar10_resnet44_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
mv /benchmarks/cifar10_resnet44_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
mv /benchmarks/cifar10_resnet44_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/
mv /benchmarks/cifar10_resnet44_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet44_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet44_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/cifar10_resnet44_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/cifar10_resnet44_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/cifar10_resnet44_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/cifar10_resnet44_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
mv cifar10_resnet44_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
mv cifar10_resnet44_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
mv cifar10_resnet44_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
mv /benchmarks/cifar10_resnet44_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
mv /benchmarks/cifar10_resnet44_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/
mv /benchmarks/cifar10_resnet44_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_dataFormat_w1.pbtxt 2> cifar10_resnet44_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_dataFormat_w2.pbtxt 2> cifar10_resnet44_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/cifar10_resnet44_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/cifar10_resnet44_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/cifar10_resnet44_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/cifar10_resnet44_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
mv cifar10_resnet44_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
mv cifar10_resnet44_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
mv cifar10_resnet44_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
mv /benchmarks/cifar10_resnet44_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
mv /benchmarks/cifar10_resnet44_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/
mv /benchmarks/cifar10_resnet44_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_winograd_w1.pbtxt 2> cifar10_resnet44_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_winograd_w2.pbtxt 2> cifar10_resnet44_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/cifar10_resnet44_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/cifar10_resnet44_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/cifar10_resnet44_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/cifar10_resnet44_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
mv cifar10_resnet44_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
mv cifar10_resnet44_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
mv cifar10_resnet44_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
mv /benchmarks/cifar10_resnet44_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
mv /benchmarks/cifar10_resnet44_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/
mv /benchmarks/cifar10_resnet44_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet44_sync_xla_w1.pbtxt 2> cifar10_resnet44_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet44_sync_xla_w2.pbtxt 2> cifar10_resnet44_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/cifar10_resnet44_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/cifar10_resnet44_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/cifar10_resnet44_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/cifar10_resnet44_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
mv cifar10_resnet44_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
mv cifar10_resnet44_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
mv cifar10_resnet44_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
mv /benchmarks/cifar10_resnet44_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
mv /benchmarks/cifar10_resnet44_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/
mv /benchmarks/cifar10_resnet44_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_batch32_w1.pbtxt 2> cifar10_resnet44_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_batch32_w2.pbtxt 2> cifar10_resnet44_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/cifar10_resnet44_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/cifar10_resnet44_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/cifar10_resnet44_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/cifar10_resnet44_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
mv cifar10_resnet44_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
mv cifar10_resnet44_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
mv cifar10_resnet44_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
mv /benchmarks/cifar10_resnet44_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
mv /benchmarks/cifar10_resnet44_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/
mv /benchmarks/cifar10_resnet44_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_batch64_w1.pbtxt 2> cifar10_resnet44_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_batch64_w2.pbtxt 2> cifar10_resnet44_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/cifar10_resnet44_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/cifar10_resnet44_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/cifar10_resnet44_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/cifar10_resnet44_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
mv cifar10_resnet44_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
mv cifar10_resnet44_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
mv cifar10_resnet44_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
mv /benchmarks/cifar10_resnet44_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
mv /benchmarks/cifar10_resnet44_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/
mv /benchmarks/cifar10_resnet44_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_batch128_w1.pbtxt 2> cifar10_resnet44_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_batch128_w2.pbtxt 2> cifar10_resnet44_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/cifar10_resnet44_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/cifar10_resnet44_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/cifar10_resnet44_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/cifar10_resnet44_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
mv cifar10_resnet44_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
mv cifar10_resnet44_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
mv cifar10_resnet44_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
mv /benchmarks/cifar10_resnet44_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
mv /benchmarks/cifar10_resnet44_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/
mv /benchmarks/cifar10_resnet44_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_batch256_w1.pbtxt 2> cifar10_resnet44_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_batch256_w2.pbtxt 2> cifar10_resnet44_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/cifar10_resnet44_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/cifar10_resnet44_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/cifar10_resnet44_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/cifar10_resnet44_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
mv cifar10_resnet44_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
mv cifar10_resnet44_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
mv cifar10_resnet44_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
mv /benchmarks/cifar10_resnet44_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
mv /benchmarks/cifar10_resnet44_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/
mv /benchmarks/cifar10_resnet44_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_batch512_w1.pbtxt 2> cifar10_resnet44_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_batch512_w2.pbtxt 2> cifar10_resnet44_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/cifar10_resnet44_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/cifar10_resnet44_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/cifar10_resnet44_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/cifar10_resnet44_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
mv cifar10_resnet44_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
mv cifar10_resnet44_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
mv cifar10_resnet44_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
mv /benchmarks/cifar10_resnet44_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
mv /benchmarks/cifar10_resnet44_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/
mv /benchmarks/cifar10_resnet44_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_use_fp16_w1.pbtxt 2> cifar10_resnet44_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_use_fp16_w2.pbtxt 2> cifar10_resnet44_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/cifar10_resnet44_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/cifar10_resnet44_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/cifar10_resnet44_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/cifar10_resnet44_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
mv cifar10_resnet44_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
mv cifar10_resnet44_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
mv cifar10_resnet44_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
mv /benchmarks/cifar10_resnet44_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
mv /benchmarks/cifar10_resnet44_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/
mv /benchmarks/cifar10_resnet44_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_optMomentum_w1.pbtxt 2> cifar10_resnet44_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_optMomentum_w2.pbtxt 2> cifar10_resnet44_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/cifar10_resnet44_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/cifar10_resnet44_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/cifar10_resnet44_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/cifar10_resnet44_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
mv cifar10_resnet44_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
mv cifar10_resnet44_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
mv cifar10_resnet44_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
mv /benchmarks/cifar10_resnet44_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
mv /benchmarks/cifar10_resnet44_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/
mv /benchmarks/cifar10_resnet44_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_optRmsprop_w1.pbtxt 2> cifar10_resnet44_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_optRmsprop_w2.pbtxt 2> cifar10_resnet44_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/cifar10_resnet44_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/cifar10_resnet44_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/cifar10_resnet44_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/cifar10_resnet44_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
mv cifar10_resnet44_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
mv cifar10_resnet44_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
mv cifar10_resnet44_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
mv /benchmarks/cifar10_resnet44_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
mv /benchmarks/cifar10_resnet44_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/
mv /benchmarks/cifar10_resnet44_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_dataFormat_w1.pbtxt 2> cifar10_resnet44_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_dataFormat_w2.pbtxt 2> cifar10_resnet44_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/cifar10_resnet44_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/cifar10_resnet44_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/cifar10_resnet44_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/cifar10_resnet44_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
mv cifar10_resnet44_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
mv cifar10_resnet44_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
mv cifar10_resnet44_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
mv /benchmarks/cifar10_resnet44_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
mv /benchmarks/cifar10_resnet44_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/
mv /benchmarks/cifar10_resnet44_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_winograd_w1.pbtxt 2> cifar10_resnet44_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_winograd_w2.pbtxt 2> cifar10_resnet44_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/cifar10_resnet44_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/cifar10_resnet44_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/cifar10_resnet44_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/cifar10_resnet44_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
mv cifar10_resnet44_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
mv cifar10_resnet44_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
mv cifar10_resnet44_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
mv /benchmarks/cifar10_resnet44_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
mv /benchmarks/cifar10_resnet44_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/
mv /benchmarks/cifar10_resnet44_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet44_async_xla_w1.pbtxt 2> cifar10_resnet44_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet44_async_xla_w2.pbtxt 2> cifar10_resnet44_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/cifar10_resnet44_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/cifar10_resnet44_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/cifar10_resnet44_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/cifar10_resnet44_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
mv cifar10_resnet44_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
mv cifar10_resnet44_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
mv cifar10_resnet44_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
mv /benchmarks/cifar10_resnet44_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
mv /benchmarks/cifar10_resnet44_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/
mv /benchmarks/cifar10_resnet44_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch32_w1.pbtxt 2> cifar10_resnet44_v2_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch32_w2.pbtxt 2> cifar10_resnet44_v2_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/cifar10_resnet44_v2_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/cifar10_resnet44_v2_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/cifar10_resnet44_v2_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/cifar10_resnet44_v2_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
mv cifar10_resnet44_v2_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
mv cifar10_resnet44_v2_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
mv cifar10_resnet44_v2_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
mv /benchmarks/cifar10_resnet44_v2_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
mv /benchmarks/cifar10_resnet44_v2_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/
mv /benchmarks/cifar10_resnet44_v2_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch64_w1.pbtxt 2> cifar10_resnet44_v2_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch64_w2.pbtxt 2> cifar10_resnet44_v2_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/cifar10_resnet44_v2_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/cifar10_resnet44_v2_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/cifar10_resnet44_v2_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/cifar10_resnet44_v2_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
mv cifar10_resnet44_v2_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
mv cifar10_resnet44_v2_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
mv cifar10_resnet44_v2_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
mv /benchmarks/cifar10_resnet44_v2_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
mv /benchmarks/cifar10_resnet44_v2_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/
mv /benchmarks/cifar10_resnet44_v2_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch128_w1.pbtxt 2> cifar10_resnet44_v2_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch128_w2.pbtxt 2> cifar10_resnet44_v2_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/cifar10_resnet44_v2_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/cifar10_resnet44_v2_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/cifar10_resnet44_v2_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/cifar10_resnet44_v2_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
mv cifar10_resnet44_v2_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
mv cifar10_resnet44_v2_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
mv cifar10_resnet44_v2_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
mv /benchmarks/cifar10_resnet44_v2_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
mv /benchmarks/cifar10_resnet44_v2_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/
mv /benchmarks/cifar10_resnet44_v2_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch256_w1.pbtxt 2> cifar10_resnet44_v2_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch256_w2.pbtxt 2> cifar10_resnet44_v2_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/cifar10_resnet44_v2_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/cifar10_resnet44_v2_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/cifar10_resnet44_v2_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/cifar10_resnet44_v2_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
mv cifar10_resnet44_v2_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
mv cifar10_resnet44_v2_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
mv cifar10_resnet44_v2_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
mv /benchmarks/cifar10_resnet44_v2_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
mv /benchmarks/cifar10_resnet44_v2_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/
mv /benchmarks/cifar10_resnet44_v2_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch512_w1.pbtxt 2> cifar10_resnet44_v2_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_batch512_w2.pbtxt 2> cifar10_resnet44_v2_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/cifar10_resnet44_v2_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/cifar10_resnet44_v2_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/cifar10_resnet44_v2_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/cifar10_resnet44_v2_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
mv cifar10_resnet44_v2_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
mv cifar10_resnet44_v2_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
mv cifar10_resnet44_v2_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
mv /benchmarks/cifar10_resnet44_v2_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
mv /benchmarks/cifar10_resnet44_v2_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/
mv /benchmarks/cifar10_resnet44_v2_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_use_fp16_w1.pbtxt 2> cifar10_resnet44_v2_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_use_fp16_w2.pbtxt 2> cifar10_resnet44_v2_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/cifar10_resnet44_v2_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/cifar10_resnet44_v2_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/cifar10_resnet44_v2_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/cifar10_resnet44_v2_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
mv cifar10_resnet44_v2_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
mv cifar10_resnet44_v2_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
mv cifar10_resnet44_v2_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet44_v2_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet44_v2_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet44_v2_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_optMomentum_w1.pbtxt 2> cifar10_resnet44_v2_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_optMomentum_w2.pbtxt 2> cifar10_resnet44_v2_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/cifar10_resnet44_v2_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/cifar10_resnet44_v2_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/cifar10_resnet44_v2_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/cifar10_resnet44_v2_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
mv cifar10_resnet44_v2_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
mv cifar10_resnet44_v2_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
mv cifar10_resnet44_v2_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet44_v2_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet44_v2_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet44_v2_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet44_v2_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet44_v2_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/cifar10_resnet44_v2_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/cifar10_resnet44_v2_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/cifar10_resnet44_v2_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/cifar10_resnet44_v2_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
mv cifar10_resnet44_v2_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
mv cifar10_resnet44_v2_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
mv cifar10_resnet44_v2_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet44_v2_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_dataFormat_w1.pbtxt 2> cifar10_resnet44_v2_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_dataFormat_w2.pbtxt 2> cifar10_resnet44_v2_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/cifar10_resnet44_v2_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/cifar10_resnet44_v2_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/cifar10_resnet44_v2_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/cifar10_resnet44_v2_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
mv cifar10_resnet44_v2_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
mv cifar10_resnet44_v2_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
mv cifar10_resnet44_v2_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet44_v2_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet44_v2_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet44_v2_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_winograd_w1.pbtxt 2> cifar10_resnet44_v2_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_winograd_w2.pbtxt 2> cifar10_resnet44_v2_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/cifar10_resnet44_v2_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/cifar10_resnet44_v2_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/cifar10_resnet44_v2_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/cifar10_resnet44_v2_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
mv cifar10_resnet44_v2_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
mv cifar10_resnet44_v2_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
mv cifar10_resnet44_v2_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
mv /benchmarks/cifar10_resnet44_v2_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
mv /benchmarks/cifar10_resnet44_v2_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/
mv /benchmarks/cifar10_resnet44_v2_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_xla_w1.pbtxt 2> cifar10_resnet44_v2_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_sync_xla_w2.pbtxt 2> cifar10_resnet44_v2_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/cifar10_resnet44_v2_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/cifar10_resnet44_v2_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/cifar10_resnet44_v2_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/cifar10_resnet44_v2_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
mv cifar10_resnet44_v2_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
mv cifar10_resnet44_v2_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
mv cifar10_resnet44_v2_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
mv /benchmarks/cifar10_resnet44_v2_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
mv /benchmarks/cifar10_resnet44_v2_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/
mv /benchmarks/cifar10_resnet44_v2_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch32_w1.pbtxt 2> cifar10_resnet44_v2_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch32_w2.pbtxt 2> cifar10_resnet44_v2_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/cifar10_resnet44_v2_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/cifar10_resnet44_v2_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/cifar10_resnet44_v2_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/cifar10_resnet44_v2_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
mv cifar10_resnet44_v2_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
mv cifar10_resnet44_v2_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
mv cifar10_resnet44_v2_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
mv /benchmarks/cifar10_resnet44_v2_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
mv /benchmarks/cifar10_resnet44_v2_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/
mv /benchmarks/cifar10_resnet44_v2_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch64_w1.pbtxt 2> cifar10_resnet44_v2_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch64_w2.pbtxt 2> cifar10_resnet44_v2_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/cifar10_resnet44_v2_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/cifar10_resnet44_v2_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/cifar10_resnet44_v2_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/cifar10_resnet44_v2_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
mv cifar10_resnet44_v2_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
mv cifar10_resnet44_v2_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
mv cifar10_resnet44_v2_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
mv /benchmarks/cifar10_resnet44_v2_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
mv /benchmarks/cifar10_resnet44_v2_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/
mv /benchmarks/cifar10_resnet44_v2_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch128_w1.pbtxt 2> cifar10_resnet44_v2_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch128_w2.pbtxt 2> cifar10_resnet44_v2_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/cifar10_resnet44_v2_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/cifar10_resnet44_v2_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/cifar10_resnet44_v2_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/cifar10_resnet44_v2_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
mv cifar10_resnet44_v2_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
mv cifar10_resnet44_v2_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
mv cifar10_resnet44_v2_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
mv /benchmarks/cifar10_resnet44_v2_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
mv /benchmarks/cifar10_resnet44_v2_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/
mv /benchmarks/cifar10_resnet44_v2_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch256_w1.pbtxt 2> cifar10_resnet44_v2_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch256_w2.pbtxt 2> cifar10_resnet44_v2_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/cifar10_resnet44_v2_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/cifar10_resnet44_v2_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/cifar10_resnet44_v2_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/cifar10_resnet44_v2_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
mv cifar10_resnet44_v2_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
mv cifar10_resnet44_v2_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
mv cifar10_resnet44_v2_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
mv /benchmarks/cifar10_resnet44_v2_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
mv /benchmarks/cifar10_resnet44_v2_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/
mv /benchmarks/cifar10_resnet44_v2_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch512_w1.pbtxt 2> cifar10_resnet44_v2_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_batch512_w2.pbtxt 2> cifar10_resnet44_v2_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/cifar10_resnet44_v2_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/cifar10_resnet44_v2_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/cifar10_resnet44_v2_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/cifar10_resnet44_v2_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
mv cifar10_resnet44_v2_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
mv cifar10_resnet44_v2_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
mv cifar10_resnet44_v2_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
mv /benchmarks/cifar10_resnet44_v2_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
mv /benchmarks/cifar10_resnet44_v2_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/
mv /benchmarks/cifar10_resnet44_v2_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_use_fp16_w1.pbtxt 2> cifar10_resnet44_v2_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_use_fp16_w2.pbtxt 2> cifar10_resnet44_v2_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/cifar10_resnet44_v2_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/cifar10_resnet44_v2_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/cifar10_resnet44_v2_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/cifar10_resnet44_v2_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
mv cifar10_resnet44_v2_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
mv cifar10_resnet44_v2_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
mv cifar10_resnet44_v2_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet44_v2_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet44_v2_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet44_v2_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_optMomentum_w1.pbtxt 2> cifar10_resnet44_v2_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_optMomentum_w2.pbtxt 2> cifar10_resnet44_v2_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/cifar10_resnet44_v2_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/cifar10_resnet44_v2_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/cifar10_resnet44_v2_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/cifar10_resnet44_v2_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
mv cifar10_resnet44_v2_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
mv cifar10_resnet44_v2_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
mv cifar10_resnet44_v2_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet44_v2_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet44_v2_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet44_v2_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_optRmsprop_w1.pbtxt 2> cifar10_resnet44_v2_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_optRmsprop_w2.pbtxt 2> cifar10_resnet44_v2_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/cifar10_resnet44_v2_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/cifar10_resnet44_v2_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/cifar10_resnet44_v2_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/cifar10_resnet44_v2_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
mv cifar10_resnet44_v2_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
mv cifar10_resnet44_v2_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
mv cifar10_resnet44_v2_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet44_v2_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet44_v2_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet44_v2_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_dataFormat_w1.pbtxt 2> cifar10_resnet44_v2_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_dataFormat_w2.pbtxt 2> cifar10_resnet44_v2_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/cifar10_resnet44_v2_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/cifar10_resnet44_v2_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/cifar10_resnet44_v2_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/cifar10_resnet44_v2_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
mv cifar10_resnet44_v2_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
mv cifar10_resnet44_v2_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
mv cifar10_resnet44_v2_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet44_v2_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet44_v2_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet44_v2_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_winograd_w1.pbtxt 2> cifar10_resnet44_v2_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_winograd_w2.pbtxt 2> cifar10_resnet44_v2_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/cifar10_resnet44_v2_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/cifar10_resnet44_v2_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/cifar10_resnet44_v2_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/cifar10_resnet44_v2_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
mv cifar10_resnet44_v2_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
mv cifar10_resnet44_v2_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
mv cifar10_resnet44_v2_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
mv /benchmarks/cifar10_resnet44_v2_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
mv /benchmarks/cifar10_resnet44_v2_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/
mv /benchmarks/cifar10_resnet44_v2_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet44_v2_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_xla_w1.pbtxt 2> cifar10_resnet44_v2_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet44_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet44_v2_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet44_v2_async_xla_w2.pbtxt 2> cifar10_resnet44_v2_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/cifar10_resnet44_v2_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/cifar10_resnet44_v2_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/cifar10_resnet44_v2_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/cifar10_resnet44_v2_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet44_v2_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
mv cifar10_resnet44_v2_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
mv cifar10_resnet44_v2_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
mv cifar10_resnet44_v2_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet44_v2_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
mv /benchmarks/cifar10_resnet44_v2_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
mv /benchmarks/cifar10_resnet44_v2_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/
mv /benchmarks/cifar10_resnet44_v2_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet44_v2_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch32_w1.pbtxt 2> cifar10_resnet56_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch32_w2.pbtxt 2> cifar10_resnet56_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/cifar10_resnet56_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/cifar10_resnet56_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/cifar10_resnet56_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/cifar10_resnet56_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
mv cifar10_resnet56_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
mv cifar10_resnet56_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
mv cifar10_resnet56_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
mv /benchmarks/cifar10_resnet56_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
mv /benchmarks/cifar10_resnet56_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/
mv /benchmarks/cifar10_resnet56_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch64_w1.pbtxt 2> cifar10_resnet56_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch64_w2.pbtxt 2> cifar10_resnet56_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/cifar10_resnet56_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/cifar10_resnet56_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/cifar10_resnet56_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/cifar10_resnet56_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
mv cifar10_resnet56_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
mv cifar10_resnet56_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
mv cifar10_resnet56_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
mv /benchmarks/cifar10_resnet56_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
mv /benchmarks/cifar10_resnet56_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/
mv /benchmarks/cifar10_resnet56_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch128_w1.pbtxt 2> cifar10_resnet56_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch128_w2.pbtxt 2> cifar10_resnet56_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/cifar10_resnet56_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/cifar10_resnet56_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/cifar10_resnet56_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/cifar10_resnet56_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
mv cifar10_resnet56_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
mv cifar10_resnet56_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
mv cifar10_resnet56_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
mv /benchmarks/cifar10_resnet56_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
mv /benchmarks/cifar10_resnet56_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/
mv /benchmarks/cifar10_resnet56_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch256_w1.pbtxt 2> cifar10_resnet56_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch256_w2.pbtxt 2> cifar10_resnet56_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/cifar10_resnet56_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/cifar10_resnet56_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/cifar10_resnet56_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/cifar10_resnet56_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
mv cifar10_resnet56_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
mv cifar10_resnet56_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
mv cifar10_resnet56_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
mv /benchmarks/cifar10_resnet56_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
mv /benchmarks/cifar10_resnet56_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/
mv /benchmarks/cifar10_resnet56_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch512_w1.pbtxt 2> cifar10_resnet56_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_batch512_w2.pbtxt 2> cifar10_resnet56_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/cifar10_resnet56_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/cifar10_resnet56_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/cifar10_resnet56_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/cifar10_resnet56_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
mv cifar10_resnet56_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
mv cifar10_resnet56_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
mv cifar10_resnet56_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
mv /benchmarks/cifar10_resnet56_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
mv /benchmarks/cifar10_resnet56_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/
mv /benchmarks/cifar10_resnet56_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_use_fp16_w1.pbtxt 2> cifar10_resnet56_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_use_fp16_w2.pbtxt 2> cifar10_resnet56_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/cifar10_resnet56_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/cifar10_resnet56_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/cifar10_resnet56_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/cifar10_resnet56_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
mv cifar10_resnet56_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
mv cifar10_resnet56_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
mv cifar10_resnet56_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
mv /benchmarks/cifar10_resnet56_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
mv /benchmarks/cifar10_resnet56_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/
mv /benchmarks/cifar10_resnet56_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_optMomentum_w1.pbtxt 2> cifar10_resnet56_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_optMomentum_w2.pbtxt 2> cifar10_resnet56_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/cifar10_resnet56_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/cifar10_resnet56_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/cifar10_resnet56_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/cifar10_resnet56_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
mv cifar10_resnet56_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
mv cifar10_resnet56_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
mv cifar10_resnet56_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
mv /benchmarks/cifar10_resnet56_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
mv /benchmarks/cifar10_resnet56_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/
mv /benchmarks/cifar10_resnet56_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet56_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet56_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/cifar10_resnet56_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/cifar10_resnet56_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/cifar10_resnet56_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/cifar10_resnet56_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
mv cifar10_resnet56_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
mv cifar10_resnet56_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
mv cifar10_resnet56_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
mv /benchmarks/cifar10_resnet56_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
mv /benchmarks/cifar10_resnet56_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/
mv /benchmarks/cifar10_resnet56_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_dataFormat_w1.pbtxt 2> cifar10_resnet56_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_dataFormat_w2.pbtxt 2> cifar10_resnet56_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/cifar10_resnet56_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/cifar10_resnet56_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/cifar10_resnet56_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/cifar10_resnet56_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
mv cifar10_resnet56_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
mv cifar10_resnet56_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
mv cifar10_resnet56_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
mv /benchmarks/cifar10_resnet56_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
mv /benchmarks/cifar10_resnet56_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/
mv /benchmarks/cifar10_resnet56_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_winograd_w1.pbtxt 2> cifar10_resnet56_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_winograd_w2.pbtxt 2> cifar10_resnet56_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/cifar10_resnet56_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/cifar10_resnet56_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/cifar10_resnet56_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/cifar10_resnet56_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
mv cifar10_resnet56_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
mv cifar10_resnet56_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
mv cifar10_resnet56_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
mv /benchmarks/cifar10_resnet56_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
mv /benchmarks/cifar10_resnet56_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/
mv /benchmarks/cifar10_resnet56_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet56_sync_xla_w1.pbtxt 2> cifar10_resnet56_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet56_sync_xla_w2.pbtxt 2> cifar10_resnet56_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/cifar10_resnet56_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/cifar10_resnet56_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/cifar10_resnet56_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/cifar10_resnet56_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
mv cifar10_resnet56_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
mv cifar10_resnet56_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
mv cifar10_resnet56_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
mv /benchmarks/cifar10_resnet56_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
mv /benchmarks/cifar10_resnet56_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/
mv /benchmarks/cifar10_resnet56_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_batch32_w1.pbtxt 2> cifar10_resnet56_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_batch32_w2.pbtxt 2> cifar10_resnet56_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/cifar10_resnet56_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/cifar10_resnet56_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/cifar10_resnet56_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/cifar10_resnet56_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
mv cifar10_resnet56_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
mv cifar10_resnet56_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
mv cifar10_resnet56_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
mv /benchmarks/cifar10_resnet56_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
mv /benchmarks/cifar10_resnet56_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/
mv /benchmarks/cifar10_resnet56_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_batch64_w1.pbtxt 2> cifar10_resnet56_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_batch64_w2.pbtxt 2> cifar10_resnet56_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/cifar10_resnet56_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/cifar10_resnet56_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/cifar10_resnet56_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/cifar10_resnet56_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
mv cifar10_resnet56_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
mv cifar10_resnet56_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
mv cifar10_resnet56_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
mv /benchmarks/cifar10_resnet56_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
mv /benchmarks/cifar10_resnet56_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/
mv /benchmarks/cifar10_resnet56_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_batch128_w1.pbtxt 2> cifar10_resnet56_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_batch128_w2.pbtxt 2> cifar10_resnet56_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/cifar10_resnet56_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/cifar10_resnet56_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/cifar10_resnet56_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/cifar10_resnet56_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
mv cifar10_resnet56_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
mv cifar10_resnet56_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
mv cifar10_resnet56_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
mv /benchmarks/cifar10_resnet56_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
mv /benchmarks/cifar10_resnet56_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/
mv /benchmarks/cifar10_resnet56_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_batch256_w1.pbtxt 2> cifar10_resnet56_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_batch256_w2.pbtxt 2> cifar10_resnet56_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/cifar10_resnet56_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/cifar10_resnet56_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/cifar10_resnet56_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/cifar10_resnet56_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
mv cifar10_resnet56_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
mv cifar10_resnet56_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
mv cifar10_resnet56_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
mv /benchmarks/cifar10_resnet56_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
mv /benchmarks/cifar10_resnet56_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/
mv /benchmarks/cifar10_resnet56_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_batch512_w1.pbtxt 2> cifar10_resnet56_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_batch512_w2.pbtxt 2> cifar10_resnet56_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/cifar10_resnet56_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/cifar10_resnet56_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/cifar10_resnet56_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/cifar10_resnet56_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
mv cifar10_resnet56_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
mv cifar10_resnet56_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
mv cifar10_resnet56_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
mv /benchmarks/cifar10_resnet56_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
mv /benchmarks/cifar10_resnet56_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/
mv /benchmarks/cifar10_resnet56_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_use_fp16_w1.pbtxt 2> cifar10_resnet56_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_use_fp16_w2.pbtxt 2> cifar10_resnet56_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/cifar10_resnet56_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/cifar10_resnet56_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/cifar10_resnet56_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/cifar10_resnet56_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
mv cifar10_resnet56_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
mv cifar10_resnet56_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
mv cifar10_resnet56_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
mv /benchmarks/cifar10_resnet56_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
mv /benchmarks/cifar10_resnet56_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/
mv /benchmarks/cifar10_resnet56_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_optMomentum_w1.pbtxt 2> cifar10_resnet56_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_optMomentum_w2.pbtxt 2> cifar10_resnet56_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/cifar10_resnet56_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/cifar10_resnet56_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/cifar10_resnet56_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/cifar10_resnet56_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
mv cifar10_resnet56_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
mv cifar10_resnet56_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
mv cifar10_resnet56_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
mv /benchmarks/cifar10_resnet56_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
mv /benchmarks/cifar10_resnet56_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/
mv /benchmarks/cifar10_resnet56_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_optRmsprop_w1.pbtxt 2> cifar10_resnet56_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_optRmsprop_w2.pbtxt 2> cifar10_resnet56_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/cifar10_resnet56_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/cifar10_resnet56_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/cifar10_resnet56_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/cifar10_resnet56_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
mv cifar10_resnet56_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
mv cifar10_resnet56_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
mv cifar10_resnet56_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
mv /benchmarks/cifar10_resnet56_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
mv /benchmarks/cifar10_resnet56_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/
mv /benchmarks/cifar10_resnet56_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_dataFormat_w1.pbtxt 2> cifar10_resnet56_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_dataFormat_w2.pbtxt 2> cifar10_resnet56_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/cifar10_resnet56_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/cifar10_resnet56_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/cifar10_resnet56_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/cifar10_resnet56_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
mv cifar10_resnet56_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
mv cifar10_resnet56_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
mv cifar10_resnet56_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
mv /benchmarks/cifar10_resnet56_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
mv /benchmarks/cifar10_resnet56_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/
mv /benchmarks/cifar10_resnet56_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_winograd_w1.pbtxt 2> cifar10_resnet56_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_winograd_w2.pbtxt 2> cifar10_resnet56_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/cifar10_resnet56_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/cifar10_resnet56_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/cifar10_resnet56_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/cifar10_resnet56_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
mv cifar10_resnet56_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
mv cifar10_resnet56_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
mv cifar10_resnet56_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
mv /benchmarks/cifar10_resnet56_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
mv /benchmarks/cifar10_resnet56_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/
mv /benchmarks/cifar10_resnet56_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet56_async_xla_w1.pbtxt 2> cifar10_resnet56_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet56_async_xla_w2.pbtxt 2> cifar10_resnet56_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/cifar10_resnet56_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/cifar10_resnet56_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/cifar10_resnet56_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/cifar10_resnet56_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
mv cifar10_resnet56_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
mv cifar10_resnet56_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
mv cifar10_resnet56_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
mv /benchmarks/cifar10_resnet56_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
mv /benchmarks/cifar10_resnet56_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/
mv /benchmarks/cifar10_resnet56_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch32_w1.pbtxt 2> cifar10_resnet56_v2_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch32_w2.pbtxt 2> cifar10_resnet56_v2_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/cifar10_resnet56_v2_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/cifar10_resnet56_v2_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/cifar10_resnet56_v2_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/cifar10_resnet56_v2_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
mv cifar10_resnet56_v2_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
mv cifar10_resnet56_v2_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
mv cifar10_resnet56_v2_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
mv /benchmarks/cifar10_resnet56_v2_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
mv /benchmarks/cifar10_resnet56_v2_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/
mv /benchmarks/cifar10_resnet56_v2_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch64_w1.pbtxt 2> cifar10_resnet56_v2_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch64_w2.pbtxt 2> cifar10_resnet56_v2_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/cifar10_resnet56_v2_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/cifar10_resnet56_v2_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/cifar10_resnet56_v2_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/cifar10_resnet56_v2_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
mv cifar10_resnet56_v2_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
mv cifar10_resnet56_v2_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
mv cifar10_resnet56_v2_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
mv /benchmarks/cifar10_resnet56_v2_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
mv /benchmarks/cifar10_resnet56_v2_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/
mv /benchmarks/cifar10_resnet56_v2_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch128_w1.pbtxt 2> cifar10_resnet56_v2_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch128_w2.pbtxt 2> cifar10_resnet56_v2_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/cifar10_resnet56_v2_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/cifar10_resnet56_v2_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/cifar10_resnet56_v2_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/cifar10_resnet56_v2_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
mv cifar10_resnet56_v2_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
mv cifar10_resnet56_v2_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
mv cifar10_resnet56_v2_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
mv /benchmarks/cifar10_resnet56_v2_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
mv /benchmarks/cifar10_resnet56_v2_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/
mv /benchmarks/cifar10_resnet56_v2_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch256_w1.pbtxt 2> cifar10_resnet56_v2_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch256_w2.pbtxt 2> cifar10_resnet56_v2_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/cifar10_resnet56_v2_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/cifar10_resnet56_v2_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/cifar10_resnet56_v2_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/cifar10_resnet56_v2_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
mv cifar10_resnet56_v2_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
mv cifar10_resnet56_v2_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
mv cifar10_resnet56_v2_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
mv /benchmarks/cifar10_resnet56_v2_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
mv /benchmarks/cifar10_resnet56_v2_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/
mv /benchmarks/cifar10_resnet56_v2_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch512_w1.pbtxt 2> cifar10_resnet56_v2_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_batch512_w2.pbtxt 2> cifar10_resnet56_v2_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/cifar10_resnet56_v2_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/cifar10_resnet56_v2_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/cifar10_resnet56_v2_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/cifar10_resnet56_v2_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
mv cifar10_resnet56_v2_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
mv cifar10_resnet56_v2_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
mv cifar10_resnet56_v2_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
mv /benchmarks/cifar10_resnet56_v2_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
mv /benchmarks/cifar10_resnet56_v2_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/
mv /benchmarks/cifar10_resnet56_v2_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_use_fp16_w1.pbtxt 2> cifar10_resnet56_v2_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_use_fp16_w2.pbtxt 2> cifar10_resnet56_v2_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/cifar10_resnet56_v2_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/cifar10_resnet56_v2_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/cifar10_resnet56_v2_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/cifar10_resnet56_v2_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
mv cifar10_resnet56_v2_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
mv cifar10_resnet56_v2_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
mv cifar10_resnet56_v2_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet56_v2_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet56_v2_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet56_v2_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_optMomentum_w1.pbtxt 2> cifar10_resnet56_v2_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_optMomentum_w2.pbtxt 2> cifar10_resnet56_v2_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/cifar10_resnet56_v2_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/cifar10_resnet56_v2_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/cifar10_resnet56_v2_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/cifar10_resnet56_v2_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
mv cifar10_resnet56_v2_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
mv cifar10_resnet56_v2_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
mv cifar10_resnet56_v2_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet56_v2_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet56_v2_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet56_v2_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet56_v2_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet56_v2_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/cifar10_resnet56_v2_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/cifar10_resnet56_v2_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/cifar10_resnet56_v2_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/cifar10_resnet56_v2_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
mv cifar10_resnet56_v2_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
mv cifar10_resnet56_v2_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
mv cifar10_resnet56_v2_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet56_v2_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_dataFormat_w1.pbtxt 2> cifar10_resnet56_v2_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_dataFormat_w2.pbtxt 2> cifar10_resnet56_v2_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/cifar10_resnet56_v2_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/cifar10_resnet56_v2_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/cifar10_resnet56_v2_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/cifar10_resnet56_v2_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
mv cifar10_resnet56_v2_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
mv cifar10_resnet56_v2_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
mv cifar10_resnet56_v2_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet56_v2_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet56_v2_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet56_v2_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_winograd_w1.pbtxt 2> cifar10_resnet56_v2_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_winograd_w2.pbtxt 2> cifar10_resnet56_v2_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/cifar10_resnet56_v2_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/cifar10_resnet56_v2_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/cifar10_resnet56_v2_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/cifar10_resnet56_v2_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
mv cifar10_resnet56_v2_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
mv cifar10_resnet56_v2_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
mv cifar10_resnet56_v2_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
mv /benchmarks/cifar10_resnet56_v2_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
mv /benchmarks/cifar10_resnet56_v2_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/
mv /benchmarks/cifar10_resnet56_v2_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_xla_w1.pbtxt 2> cifar10_resnet56_v2_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_sync_xla_w2.pbtxt 2> cifar10_resnet56_v2_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/cifar10_resnet56_v2_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/cifar10_resnet56_v2_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/cifar10_resnet56_v2_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/cifar10_resnet56_v2_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
mv cifar10_resnet56_v2_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
mv cifar10_resnet56_v2_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
mv cifar10_resnet56_v2_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
mv /benchmarks/cifar10_resnet56_v2_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
mv /benchmarks/cifar10_resnet56_v2_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/
mv /benchmarks/cifar10_resnet56_v2_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch32_w1.pbtxt 2> cifar10_resnet56_v2_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch32_w2.pbtxt 2> cifar10_resnet56_v2_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/cifar10_resnet56_v2_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/cifar10_resnet56_v2_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/cifar10_resnet56_v2_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/cifar10_resnet56_v2_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
mv cifar10_resnet56_v2_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
mv cifar10_resnet56_v2_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
mv cifar10_resnet56_v2_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
mv /benchmarks/cifar10_resnet56_v2_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
mv /benchmarks/cifar10_resnet56_v2_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/
mv /benchmarks/cifar10_resnet56_v2_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch64_w1.pbtxt 2> cifar10_resnet56_v2_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch64_w2.pbtxt 2> cifar10_resnet56_v2_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/cifar10_resnet56_v2_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/cifar10_resnet56_v2_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/cifar10_resnet56_v2_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/cifar10_resnet56_v2_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
mv cifar10_resnet56_v2_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
mv cifar10_resnet56_v2_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
mv cifar10_resnet56_v2_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
mv /benchmarks/cifar10_resnet56_v2_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
mv /benchmarks/cifar10_resnet56_v2_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/
mv /benchmarks/cifar10_resnet56_v2_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch128_w1.pbtxt 2> cifar10_resnet56_v2_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch128_w2.pbtxt 2> cifar10_resnet56_v2_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/cifar10_resnet56_v2_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/cifar10_resnet56_v2_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/cifar10_resnet56_v2_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/cifar10_resnet56_v2_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
mv cifar10_resnet56_v2_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
mv cifar10_resnet56_v2_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
mv cifar10_resnet56_v2_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
mv /benchmarks/cifar10_resnet56_v2_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
mv /benchmarks/cifar10_resnet56_v2_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/
mv /benchmarks/cifar10_resnet56_v2_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch256_w1.pbtxt 2> cifar10_resnet56_v2_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch256_w2.pbtxt 2> cifar10_resnet56_v2_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/cifar10_resnet56_v2_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/cifar10_resnet56_v2_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/cifar10_resnet56_v2_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/cifar10_resnet56_v2_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
mv cifar10_resnet56_v2_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
mv cifar10_resnet56_v2_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
mv cifar10_resnet56_v2_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
mv /benchmarks/cifar10_resnet56_v2_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
mv /benchmarks/cifar10_resnet56_v2_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/
mv /benchmarks/cifar10_resnet56_v2_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch512_w1.pbtxt 2> cifar10_resnet56_v2_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_batch512_w2.pbtxt 2> cifar10_resnet56_v2_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/cifar10_resnet56_v2_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/cifar10_resnet56_v2_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/cifar10_resnet56_v2_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/cifar10_resnet56_v2_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
mv cifar10_resnet56_v2_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
mv cifar10_resnet56_v2_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
mv cifar10_resnet56_v2_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
mv /benchmarks/cifar10_resnet56_v2_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
mv /benchmarks/cifar10_resnet56_v2_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/
mv /benchmarks/cifar10_resnet56_v2_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_use_fp16_w1.pbtxt 2> cifar10_resnet56_v2_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_use_fp16_w2.pbtxt 2> cifar10_resnet56_v2_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/cifar10_resnet56_v2_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/cifar10_resnet56_v2_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/cifar10_resnet56_v2_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/cifar10_resnet56_v2_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
mv cifar10_resnet56_v2_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
mv cifar10_resnet56_v2_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
mv cifar10_resnet56_v2_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet56_v2_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet56_v2_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet56_v2_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_optMomentum_w1.pbtxt 2> cifar10_resnet56_v2_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_optMomentum_w2.pbtxt 2> cifar10_resnet56_v2_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/cifar10_resnet56_v2_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/cifar10_resnet56_v2_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/cifar10_resnet56_v2_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/cifar10_resnet56_v2_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
mv cifar10_resnet56_v2_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
mv cifar10_resnet56_v2_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
mv cifar10_resnet56_v2_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet56_v2_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet56_v2_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet56_v2_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_optRmsprop_w1.pbtxt 2> cifar10_resnet56_v2_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_optRmsprop_w2.pbtxt 2> cifar10_resnet56_v2_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/cifar10_resnet56_v2_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/cifar10_resnet56_v2_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/cifar10_resnet56_v2_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/cifar10_resnet56_v2_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
mv cifar10_resnet56_v2_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
mv cifar10_resnet56_v2_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
mv cifar10_resnet56_v2_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet56_v2_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet56_v2_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet56_v2_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_dataFormat_w1.pbtxt 2> cifar10_resnet56_v2_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_dataFormat_w2.pbtxt 2> cifar10_resnet56_v2_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/cifar10_resnet56_v2_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/cifar10_resnet56_v2_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/cifar10_resnet56_v2_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/cifar10_resnet56_v2_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
mv cifar10_resnet56_v2_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
mv cifar10_resnet56_v2_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
mv cifar10_resnet56_v2_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet56_v2_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet56_v2_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet56_v2_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_winograd_w1.pbtxt 2> cifar10_resnet56_v2_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_winograd_w2.pbtxt 2> cifar10_resnet56_v2_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/cifar10_resnet56_v2_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/cifar10_resnet56_v2_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/cifar10_resnet56_v2_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/cifar10_resnet56_v2_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
mv cifar10_resnet56_v2_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
mv cifar10_resnet56_v2_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
mv cifar10_resnet56_v2_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
mv /benchmarks/cifar10_resnet56_v2_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
mv /benchmarks/cifar10_resnet56_v2_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/
mv /benchmarks/cifar10_resnet56_v2_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet56_v2_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_xla_w1.pbtxt 2> cifar10_resnet56_v2_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet56_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet56_v2_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet56_v2_async_xla_w2.pbtxt 2> cifar10_resnet56_v2_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/cifar10_resnet56_v2_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/cifar10_resnet56_v2_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/cifar10_resnet56_v2_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/cifar10_resnet56_v2_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet56_v2_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
mv cifar10_resnet56_v2_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
mv cifar10_resnet56_v2_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
mv cifar10_resnet56_v2_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet56_v2_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
mv /benchmarks/cifar10_resnet56_v2_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
mv /benchmarks/cifar10_resnet56_v2_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/
mv /benchmarks/cifar10_resnet56_v2_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet56_v2_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch32_w1.pbtxt 2> cifar10_resnet110_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch32_w2.pbtxt 2> cifar10_resnet110_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/cifar10_resnet110_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/cifar10_resnet110_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/cifar10_resnet110_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/cifar10_resnet110_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
mv cifar10_resnet110_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
mv cifar10_resnet110_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
mv cifar10_resnet110_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
mv /benchmarks/cifar10_resnet110_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
mv /benchmarks/cifar10_resnet110_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/
mv /benchmarks/cifar10_resnet110_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch64_w1.pbtxt 2> cifar10_resnet110_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch64_w2.pbtxt 2> cifar10_resnet110_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/cifar10_resnet110_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/cifar10_resnet110_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/cifar10_resnet110_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/cifar10_resnet110_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
mv cifar10_resnet110_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
mv cifar10_resnet110_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
mv cifar10_resnet110_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
mv /benchmarks/cifar10_resnet110_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
mv /benchmarks/cifar10_resnet110_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/
mv /benchmarks/cifar10_resnet110_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch128_w1.pbtxt 2> cifar10_resnet110_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch128_w2.pbtxt 2> cifar10_resnet110_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/cifar10_resnet110_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/cifar10_resnet110_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/cifar10_resnet110_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/cifar10_resnet110_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
mv cifar10_resnet110_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
mv cifar10_resnet110_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
mv cifar10_resnet110_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
mv /benchmarks/cifar10_resnet110_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
mv /benchmarks/cifar10_resnet110_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/
mv /benchmarks/cifar10_resnet110_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch256_w1.pbtxt 2> cifar10_resnet110_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch256_w2.pbtxt 2> cifar10_resnet110_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/cifar10_resnet110_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/cifar10_resnet110_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/cifar10_resnet110_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/cifar10_resnet110_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
mv cifar10_resnet110_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
mv cifar10_resnet110_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
mv cifar10_resnet110_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
mv /benchmarks/cifar10_resnet110_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
mv /benchmarks/cifar10_resnet110_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/
mv /benchmarks/cifar10_resnet110_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch512_w1.pbtxt 2> cifar10_resnet110_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_batch512_w2.pbtxt 2> cifar10_resnet110_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/cifar10_resnet110_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/cifar10_resnet110_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/cifar10_resnet110_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/cifar10_resnet110_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
mv cifar10_resnet110_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
mv cifar10_resnet110_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
mv cifar10_resnet110_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
mv /benchmarks/cifar10_resnet110_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
mv /benchmarks/cifar10_resnet110_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/
mv /benchmarks/cifar10_resnet110_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_use_fp16_w1.pbtxt 2> cifar10_resnet110_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_use_fp16_w2.pbtxt 2> cifar10_resnet110_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/cifar10_resnet110_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/cifar10_resnet110_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/cifar10_resnet110_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/cifar10_resnet110_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
mv cifar10_resnet110_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
mv cifar10_resnet110_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
mv cifar10_resnet110_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
mv /benchmarks/cifar10_resnet110_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
mv /benchmarks/cifar10_resnet110_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/
mv /benchmarks/cifar10_resnet110_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_optMomentum_w1.pbtxt 2> cifar10_resnet110_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_optMomentum_w2.pbtxt 2> cifar10_resnet110_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/cifar10_resnet110_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/cifar10_resnet110_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/cifar10_resnet110_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/cifar10_resnet110_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
mv cifar10_resnet110_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
mv cifar10_resnet110_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
mv cifar10_resnet110_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
mv /benchmarks/cifar10_resnet110_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
mv /benchmarks/cifar10_resnet110_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/
mv /benchmarks/cifar10_resnet110_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet110_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet110_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/cifar10_resnet110_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/cifar10_resnet110_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/cifar10_resnet110_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/cifar10_resnet110_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
mv cifar10_resnet110_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
mv cifar10_resnet110_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
mv cifar10_resnet110_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
mv /benchmarks/cifar10_resnet110_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
mv /benchmarks/cifar10_resnet110_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/
mv /benchmarks/cifar10_resnet110_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_dataFormat_w1.pbtxt 2> cifar10_resnet110_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_dataFormat_w2.pbtxt 2> cifar10_resnet110_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/cifar10_resnet110_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/cifar10_resnet110_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/cifar10_resnet110_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/cifar10_resnet110_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
mv cifar10_resnet110_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
mv cifar10_resnet110_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
mv cifar10_resnet110_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
mv /benchmarks/cifar10_resnet110_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
mv /benchmarks/cifar10_resnet110_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/
mv /benchmarks/cifar10_resnet110_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_winograd_w1.pbtxt 2> cifar10_resnet110_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_winograd_w2.pbtxt 2> cifar10_resnet110_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/cifar10_resnet110_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/cifar10_resnet110_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/cifar10_resnet110_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/cifar10_resnet110_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
mv cifar10_resnet110_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
mv cifar10_resnet110_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
mv cifar10_resnet110_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
mv /benchmarks/cifar10_resnet110_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
mv /benchmarks/cifar10_resnet110_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/
mv /benchmarks/cifar10_resnet110_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet110_sync_xla_w1.pbtxt 2> cifar10_resnet110_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet110_sync_xla_w2.pbtxt 2> cifar10_resnet110_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/cifar10_resnet110_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/cifar10_resnet110_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/cifar10_resnet110_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/cifar10_resnet110_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
mv cifar10_resnet110_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
mv cifar10_resnet110_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
mv cifar10_resnet110_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
mv /benchmarks/cifar10_resnet110_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
mv /benchmarks/cifar10_resnet110_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/
mv /benchmarks/cifar10_resnet110_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_batch32_w1.pbtxt 2> cifar10_resnet110_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_batch32_w2.pbtxt 2> cifar10_resnet110_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/cifar10_resnet110_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/cifar10_resnet110_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/cifar10_resnet110_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/cifar10_resnet110_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
mv cifar10_resnet110_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
mv cifar10_resnet110_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
mv cifar10_resnet110_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
mv /benchmarks/cifar10_resnet110_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
mv /benchmarks/cifar10_resnet110_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/
mv /benchmarks/cifar10_resnet110_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_batch64_w1.pbtxt 2> cifar10_resnet110_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_batch64_w2.pbtxt 2> cifar10_resnet110_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/cifar10_resnet110_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/cifar10_resnet110_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/cifar10_resnet110_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/cifar10_resnet110_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
mv cifar10_resnet110_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
mv cifar10_resnet110_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
mv cifar10_resnet110_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
mv /benchmarks/cifar10_resnet110_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
mv /benchmarks/cifar10_resnet110_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/
mv /benchmarks/cifar10_resnet110_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_batch128_w1.pbtxt 2> cifar10_resnet110_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_batch128_w2.pbtxt 2> cifar10_resnet110_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/cifar10_resnet110_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/cifar10_resnet110_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/cifar10_resnet110_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/cifar10_resnet110_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
mv cifar10_resnet110_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
mv cifar10_resnet110_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
mv cifar10_resnet110_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
mv /benchmarks/cifar10_resnet110_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
mv /benchmarks/cifar10_resnet110_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/
mv /benchmarks/cifar10_resnet110_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_batch256_w1.pbtxt 2> cifar10_resnet110_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_batch256_w2.pbtxt 2> cifar10_resnet110_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/cifar10_resnet110_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/cifar10_resnet110_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/cifar10_resnet110_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/cifar10_resnet110_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
mv cifar10_resnet110_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
mv cifar10_resnet110_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
mv cifar10_resnet110_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
mv /benchmarks/cifar10_resnet110_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
mv /benchmarks/cifar10_resnet110_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/
mv /benchmarks/cifar10_resnet110_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_batch512_w1.pbtxt 2> cifar10_resnet110_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_batch512_w2.pbtxt 2> cifar10_resnet110_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/cifar10_resnet110_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/cifar10_resnet110_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/cifar10_resnet110_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/cifar10_resnet110_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
mv cifar10_resnet110_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
mv cifar10_resnet110_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
mv cifar10_resnet110_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
mv /benchmarks/cifar10_resnet110_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
mv /benchmarks/cifar10_resnet110_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/
mv /benchmarks/cifar10_resnet110_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_use_fp16_w1.pbtxt 2> cifar10_resnet110_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_use_fp16_w2.pbtxt 2> cifar10_resnet110_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/cifar10_resnet110_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/cifar10_resnet110_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/cifar10_resnet110_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/cifar10_resnet110_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
mv cifar10_resnet110_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
mv cifar10_resnet110_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
mv cifar10_resnet110_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
mv /benchmarks/cifar10_resnet110_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
mv /benchmarks/cifar10_resnet110_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/
mv /benchmarks/cifar10_resnet110_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_optMomentum_w1.pbtxt 2> cifar10_resnet110_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_optMomentum_w2.pbtxt 2> cifar10_resnet110_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/cifar10_resnet110_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/cifar10_resnet110_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/cifar10_resnet110_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/cifar10_resnet110_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
mv cifar10_resnet110_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
mv cifar10_resnet110_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
mv cifar10_resnet110_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
mv /benchmarks/cifar10_resnet110_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
mv /benchmarks/cifar10_resnet110_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/
mv /benchmarks/cifar10_resnet110_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_optRmsprop_w1.pbtxt 2> cifar10_resnet110_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_optRmsprop_w2.pbtxt 2> cifar10_resnet110_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/cifar10_resnet110_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/cifar10_resnet110_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/cifar10_resnet110_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/cifar10_resnet110_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
mv cifar10_resnet110_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
mv cifar10_resnet110_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
mv cifar10_resnet110_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
mv /benchmarks/cifar10_resnet110_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
mv /benchmarks/cifar10_resnet110_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/
mv /benchmarks/cifar10_resnet110_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_dataFormat_w1.pbtxt 2> cifar10_resnet110_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_dataFormat_w2.pbtxt 2> cifar10_resnet110_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/cifar10_resnet110_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/cifar10_resnet110_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/cifar10_resnet110_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/cifar10_resnet110_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
mv cifar10_resnet110_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
mv cifar10_resnet110_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
mv cifar10_resnet110_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
mv /benchmarks/cifar10_resnet110_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
mv /benchmarks/cifar10_resnet110_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/
mv /benchmarks/cifar10_resnet110_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_winograd_w1.pbtxt 2> cifar10_resnet110_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_winograd_w2.pbtxt 2> cifar10_resnet110_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/cifar10_resnet110_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/cifar10_resnet110_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/cifar10_resnet110_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/cifar10_resnet110_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
mv cifar10_resnet110_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
mv cifar10_resnet110_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
mv cifar10_resnet110_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
mv /benchmarks/cifar10_resnet110_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
mv /benchmarks/cifar10_resnet110_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/
mv /benchmarks/cifar10_resnet110_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet110_async_xla_w1.pbtxt 2> cifar10_resnet110_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet110_async_xla_w2.pbtxt 2> cifar10_resnet110_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/cifar10_resnet110_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/cifar10_resnet110_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/cifar10_resnet110_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/cifar10_resnet110_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
mv cifar10_resnet110_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
mv cifar10_resnet110_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
mv cifar10_resnet110_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
mv /benchmarks/cifar10_resnet110_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
mv /benchmarks/cifar10_resnet110_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/
mv /benchmarks/cifar10_resnet110_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch32_w1.pbtxt 2> cifar10_resnet110_v2_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch32_w2.pbtxt 2> cifar10_resnet110_v2_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/cifar10_resnet110_v2_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/cifar10_resnet110_v2_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/cifar10_resnet110_v2_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/cifar10_resnet110_v2_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
mv cifar10_resnet110_v2_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
mv cifar10_resnet110_v2_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
mv cifar10_resnet110_v2_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
mv /benchmarks/cifar10_resnet110_v2_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
mv /benchmarks/cifar10_resnet110_v2_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/
mv /benchmarks/cifar10_resnet110_v2_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch64_w1.pbtxt 2> cifar10_resnet110_v2_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch64_w2.pbtxt 2> cifar10_resnet110_v2_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/cifar10_resnet110_v2_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/cifar10_resnet110_v2_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/cifar10_resnet110_v2_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/cifar10_resnet110_v2_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
mv cifar10_resnet110_v2_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
mv cifar10_resnet110_v2_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
mv cifar10_resnet110_v2_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
mv /benchmarks/cifar10_resnet110_v2_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
mv /benchmarks/cifar10_resnet110_v2_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/
mv /benchmarks/cifar10_resnet110_v2_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch128_w1.pbtxt 2> cifar10_resnet110_v2_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch128_w2.pbtxt 2> cifar10_resnet110_v2_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/cifar10_resnet110_v2_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/cifar10_resnet110_v2_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/cifar10_resnet110_v2_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/cifar10_resnet110_v2_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
mv cifar10_resnet110_v2_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
mv cifar10_resnet110_v2_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
mv cifar10_resnet110_v2_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
mv /benchmarks/cifar10_resnet110_v2_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
mv /benchmarks/cifar10_resnet110_v2_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/
mv /benchmarks/cifar10_resnet110_v2_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch256_w1.pbtxt 2> cifar10_resnet110_v2_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch256_w2.pbtxt 2> cifar10_resnet110_v2_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/cifar10_resnet110_v2_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/cifar10_resnet110_v2_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/cifar10_resnet110_v2_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/cifar10_resnet110_v2_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
mv cifar10_resnet110_v2_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
mv cifar10_resnet110_v2_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
mv cifar10_resnet110_v2_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
mv /benchmarks/cifar10_resnet110_v2_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
mv /benchmarks/cifar10_resnet110_v2_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/
mv /benchmarks/cifar10_resnet110_v2_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch512_w1.pbtxt 2> cifar10_resnet110_v2_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_batch512_w2.pbtxt 2> cifar10_resnet110_v2_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/cifar10_resnet110_v2_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/cifar10_resnet110_v2_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/cifar10_resnet110_v2_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/cifar10_resnet110_v2_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
mv cifar10_resnet110_v2_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
mv cifar10_resnet110_v2_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
mv cifar10_resnet110_v2_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
mv /benchmarks/cifar10_resnet110_v2_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
mv /benchmarks/cifar10_resnet110_v2_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/
mv /benchmarks/cifar10_resnet110_v2_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_use_fp16_w1.pbtxt 2> cifar10_resnet110_v2_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_use_fp16_w2.pbtxt 2> cifar10_resnet110_v2_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/cifar10_resnet110_v2_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/cifar10_resnet110_v2_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/cifar10_resnet110_v2_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/cifar10_resnet110_v2_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
mv cifar10_resnet110_v2_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
mv cifar10_resnet110_v2_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
mv cifar10_resnet110_v2_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet110_v2_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet110_v2_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/
mv /benchmarks/cifar10_resnet110_v2_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_optMomentum_w1.pbtxt 2> cifar10_resnet110_v2_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_optMomentum_w2.pbtxt 2> cifar10_resnet110_v2_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/cifar10_resnet110_v2_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/cifar10_resnet110_v2_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/cifar10_resnet110_v2_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/cifar10_resnet110_v2_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
mv cifar10_resnet110_v2_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
mv cifar10_resnet110_v2_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
mv cifar10_resnet110_v2_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet110_v2_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet110_v2_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/
mv /benchmarks/cifar10_resnet110_v2_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w1.pbtxt 2> cifar10_resnet110_v2_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w2.pbtxt 2> cifar10_resnet110_v2_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/cifar10_resnet110_v2_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/cifar10_resnet110_v2_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/cifar10_resnet110_v2_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/cifar10_resnet110_v2_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
mv cifar10_resnet110_v2_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
mv cifar10_resnet110_v2_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
mv cifar10_resnet110_v2_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/
mv /benchmarks/cifar10_resnet110_v2_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_dataFormat_w1.pbtxt 2> cifar10_resnet110_v2_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_dataFormat_w2.pbtxt 2> cifar10_resnet110_v2_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/cifar10_resnet110_v2_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/cifar10_resnet110_v2_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/cifar10_resnet110_v2_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/cifar10_resnet110_v2_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
mv cifar10_resnet110_v2_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
mv cifar10_resnet110_v2_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
mv cifar10_resnet110_v2_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet110_v2_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet110_v2_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/
mv /benchmarks/cifar10_resnet110_v2_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_winograd_w1.pbtxt 2> cifar10_resnet110_v2_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_winograd_w2.pbtxt 2> cifar10_resnet110_v2_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/cifar10_resnet110_v2_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/cifar10_resnet110_v2_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/cifar10_resnet110_v2_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/cifar10_resnet110_v2_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
mv cifar10_resnet110_v2_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
mv cifar10_resnet110_v2_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
mv cifar10_resnet110_v2_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
mv /benchmarks/cifar10_resnet110_v2_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
mv /benchmarks/cifar10_resnet110_v2_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/
mv /benchmarks/cifar10_resnet110_v2_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_xla_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_xla_w1.pbtxt 2> cifar10_resnet110_v2_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_sync_xla_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_sync_xla_w2.pbtxt 2> cifar10_resnet110_v2_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/cifar10_resnet110_v2_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/cifar10_resnet110_v2_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/cifar10_resnet110_v2_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/cifar10_resnet110_v2_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
mv cifar10_resnet110_v2_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
mv cifar10_resnet110_v2_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
mv cifar10_resnet110_v2_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
mv /benchmarks/cifar10_resnet110_v2_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
mv /benchmarks/cifar10_resnet110_v2_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/
mv /benchmarks/cifar10_resnet110_v2_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch32_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch32_w1.pbtxt 2> cifar10_resnet110_v2_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch32_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch32_w2.pbtxt 2> cifar10_resnet110_v2_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/cifar10_resnet110_v2_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/cifar10_resnet110_v2_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/cifar10_resnet110_v2_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/cifar10_resnet110_v2_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
mv cifar10_resnet110_v2_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
mv cifar10_resnet110_v2_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
mv cifar10_resnet110_v2_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
mv /benchmarks/cifar10_resnet110_v2_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
mv /benchmarks/cifar10_resnet110_v2_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/
mv /benchmarks/cifar10_resnet110_v2_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch64_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch64_w1.pbtxt 2> cifar10_resnet110_v2_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch64_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch64_w2.pbtxt 2> cifar10_resnet110_v2_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/cifar10_resnet110_v2_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/cifar10_resnet110_v2_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/cifar10_resnet110_v2_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/cifar10_resnet110_v2_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
mv cifar10_resnet110_v2_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
mv cifar10_resnet110_v2_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
mv cifar10_resnet110_v2_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
mv /benchmarks/cifar10_resnet110_v2_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
mv /benchmarks/cifar10_resnet110_v2_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/
mv /benchmarks/cifar10_resnet110_v2_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch128_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch128_w1.pbtxt 2> cifar10_resnet110_v2_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch128_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch128_w2.pbtxt 2> cifar10_resnet110_v2_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/cifar10_resnet110_v2_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/cifar10_resnet110_v2_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/cifar10_resnet110_v2_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/cifar10_resnet110_v2_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
mv cifar10_resnet110_v2_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
mv cifar10_resnet110_v2_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
mv cifar10_resnet110_v2_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
mv /benchmarks/cifar10_resnet110_v2_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
mv /benchmarks/cifar10_resnet110_v2_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/
mv /benchmarks/cifar10_resnet110_v2_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch256_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch256_w1.pbtxt 2> cifar10_resnet110_v2_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch256_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch256_w2.pbtxt 2> cifar10_resnet110_v2_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/cifar10_resnet110_v2_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/cifar10_resnet110_v2_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/cifar10_resnet110_v2_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/cifar10_resnet110_v2_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
mv cifar10_resnet110_v2_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
mv cifar10_resnet110_v2_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
mv cifar10_resnet110_v2_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
mv /benchmarks/cifar10_resnet110_v2_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
mv /benchmarks/cifar10_resnet110_v2_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/
mv /benchmarks/cifar10_resnet110_v2_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch512_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch512_w1.pbtxt 2> cifar10_resnet110_v2_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_batch512_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_batch512_w2.pbtxt 2> cifar10_resnet110_v2_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/cifar10_resnet110_v2_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/cifar10_resnet110_v2_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/cifar10_resnet110_v2_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/cifar10_resnet110_v2_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
mv cifar10_resnet110_v2_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
mv cifar10_resnet110_v2_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
mv cifar10_resnet110_v2_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
mv /benchmarks/cifar10_resnet110_v2_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
mv /benchmarks/cifar10_resnet110_v2_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/
mv /benchmarks/cifar10_resnet110_v2_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_use_fp16_w1.pbtxt 2> cifar10_resnet110_v2_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_use_fp16_w2.pbtxt 2> cifar10_resnet110_v2_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/cifar10_resnet110_v2_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/cifar10_resnet110_v2_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/cifar10_resnet110_v2_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/cifar10_resnet110_v2_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
mv cifar10_resnet110_v2_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
mv cifar10_resnet110_v2_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
mv cifar10_resnet110_v2_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet110_v2_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet110_v2_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/
mv /benchmarks/cifar10_resnet110_v2_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_optMomentum_w1.pbtxt 2> cifar10_resnet110_v2_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_optMomentum_w2.pbtxt 2> cifar10_resnet110_v2_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/cifar10_resnet110_v2_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/cifar10_resnet110_v2_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/cifar10_resnet110_v2_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/cifar10_resnet110_v2_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
mv cifar10_resnet110_v2_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
mv cifar10_resnet110_v2_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
mv cifar10_resnet110_v2_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet110_v2_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet110_v2_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/
mv /benchmarks/cifar10_resnet110_v2_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_optRmsprop_w1.pbtxt 2> cifar10_resnet110_v2_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_optRmsprop_w2.pbtxt 2> cifar10_resnet110_v2_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/cifar10_resnet110_v2_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/cifar10_resnet110_v2_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/cifar10_resnet110_v2_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/cifar10_resnet110_v2_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
mv cifar10_resnet110_v2_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
mv cifar10_resnet110_v2_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
mv cifar10_resnet110_v2_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet110_v2_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet110_v2_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/
mv /benchmarks/cifar10_resnet110_v2_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_dataFormat_w1.pbtxt 2> cifar10_resnet110_v2_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_dataFormat_w2.pbtxt 2> cifar10_resnet110_v2_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/cifar10_resnet110_v2_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/cifar10_resnet110_v2_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/cifar10_resnet110_v2_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/cifar10_resnet110_v2_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
mv cifar10_resnet110_v2_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
mv cifar10_resnet110_v2_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
mv cifar10_resnet110_v2_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet110_v2_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet110_v2_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/
mv /benchmarks/cifar10_resnet110_v2_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_winograd_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_winograd_w1.pbtxt 2> cifar10_resnet110_v2_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_winograd_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_winograd_w2.pbtxt 2> cifar10_resnet110_v2_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/cifar10_resnet110_v2_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/cifar10_resnet110_v2_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/cifar10_resnet110_v2_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/cifar10_resnet110_v2_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
mv cifar10_resnet110_v2_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
mv cifar10_resnet110_v2_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
mv cifar10_resnet110_v2_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
mv /benchmarks/cifar10_resnet110_v2_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
mv /benchmarks/cifar10_resnet110_v2_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/
mv /benchmarks/cifar10_resnet110_v2_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_resnet110_v2_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_xla_w1.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_xla_w1.pbtxt 2> cifar10_resnet110_v2_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=resnet110_v2 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_resnet110_v2_async_xla_w2.json --graph_file=/benchmarks/cifar10_resnet110_v2_async_xla_w2.pbtxt 2> cifar10_resnet110_v2_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/cifar10_resnet110_v2_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/cifar10_resnet110_v2_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/cifar10_resnet110_v2_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/cifar10_resnet110_v2_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_resnet110_v2_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
mv cifar10_resnet110_v2_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
mv cifar10_resnet110_v2_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
mv cifar10_resnet110_v2_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_resnet110_v2_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
mv /benchmarks/cifar10_resnet110_v2_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
mv /benchmarks/cifar10_resnet110_v2_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/
mv /benchmarks/cifar10_resnet110_v2_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_resnet110_v2_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch32_w1.pbtxt 2> cifar10_alexnet_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch32_w2.pbtxt 2> cifar10_alexnet_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/cifar10_alexnet_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/cifar10_alexnet_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/cifar10_alexnet_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/cifar10_alexnet_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
mv cifar10_alexnet_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
mv cifar10_alexnet_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
mv cifar10_alexnet_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
mv /benchmarks/cifar10_alexnet_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
mv /benchmarks/cifar10_alexnet_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/
mv /benchmarks/cifar10_alexnet_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch64_w1.pbtxt 2> cifar10_alexnet_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch64_w2.pbtxt 2> cifar10_alexnet_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/cifar10_alexnet_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/cifar10_alexnet_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/cifar10_alexnet_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/cifar10_alexnet_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
mv cifar10_alexnet_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
mv cifar10_alexnet_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
mv cifar10_alexnet_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
mv /benchmarks/cifar10_alexnet_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
mv /benchmarks/cifar10_alexnet_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/
mv /benchmarks/cifar10_alexnet_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch128_w1.pbtxt 2> cifar10_alexnet_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch128_w2.pbtxt 2> cifar10_alexnet_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/cifar10_alexnet_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/cifar10_alexnet_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/cifar10_alexnet_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/cifar10_alexnet_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
mv cifar10_alexnet_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
mv cifar10_alexnet_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
mv cifar10_alexnet_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
mv /benchmarks/cifar10_alexnet_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
mv /benchmarks/cifar10_alexnet_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/
mv /benchmarks/cifar10_alexnet_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch256_w1.pbtxt 2> cifar10_alexnet_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch256_w2.pbtxt 2> cifar10_alexnet_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/cifar10_alexnet_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/cifar10_alexnet_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/cifar10_alexnet_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/cifar10_alexnet_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
mv cifar10_alexnet_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
mv cifar10_alexnet_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
mv cifar10_alexnet_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
mv /benchmarks/cifar10_alexnet_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
mv /benchmarks/cifar10_alexnet_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/
mv /benchmarks/cifar10_alexnet_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch512_w1.pbtxt 2> cifar10_alexnet_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_batch512_w2.pbtxt 2> cifar10_alexnet_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/cifar10_alexnet_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/cifar10_alexnet_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/cifar10_alexnet_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/cifar10_alexnet_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
mv cifar10_alexnet_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
mv cifar10_alexnet_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
mv cifar10_alexnet_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
mv /benchmarks/cifar10_alexnet_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
mv /benchmarks/cifar10_alexnet_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/
mv /benchmarks/cifar10_alexnet_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_use_fp16_w1.pbtxt 2> cifar10_alexnet_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_use_fp16_w2.pbtxt 2> cifar10_alexnet_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/cifar10_alexnet_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/cifar10_alexnet_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/cifar10_alexnet_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/cifar10_alexnet_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
mv cifar10_alexnet_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
mv cifar10_alexnet_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
mv cifar10_alexnet_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
mv /benchmarks/cifar10_alexnet_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
mv /benchmarks/cifar10_alexnet_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/
mv /benchmarks/cifar10_alexnet_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_optMomentum_w1.pbtxt 2> cifar10_alexnet_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_optMomentum_w2.pbtxt 2> cifar10_alexnet_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/cifar10_alexnet_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/cifar10_alexnet_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/cifar10_alexnet_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/cifar10_alexnet_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
mv cifar10_alexnet_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
mv cifar10_alexnet_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
mv cifar10_alexnet_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
mv /benchmarks/cifar10_alexnet_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
mv /benchmarks/cifar10_alexnet_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/
mv /benchmarks/cifar10_alexnet_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_optRmsprop_w1.pbtxt 2> cifar10_alexnet_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_optRmsprop_w2.pbtxt 2> cifar10_alexnet_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/cifar10_alexnet_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/cifar10_alexnet_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/cifar10_alexnet_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/cifar10_alexnet_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
mv cifar10_alexnet_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
mv cifar10_alexnet_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
mv cifar10_alexnet_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
mv /benchmarks/cifar10_alexnet_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
mv /benchmarks/cifar10_alexnet_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/
mv /benchmarks/cifar10_alexnet_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_dataFormat_w1.pbtxt 2> cifar10_alexnet_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_dataFormat_w2.pbtxt 2> cifar10_alexnet_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/cifar10_alexnet_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/cifar10_alexnet_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/cifar10_alexnet_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/cifar10_alexnet_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
mv cifar10_alexnet_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
mv cifar10_alexnet_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
mv cifar10_alexnet_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
mv /benchmarks/cifar10_alexnet_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
mv /benchmarks/cifar10_alexnet_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/
mv /benchmarks/cifar10_alexnet_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_winograd_w1.pbtxt 2> cifar10_alexnet_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_winograd_w2.pbtxt 2> cifar10_alexnet_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/cifar10_alexnet_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/cifar10_alexnet_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/cifar10_alexnet_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/cifar10_alexnet_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
mv cifar10_alexnet_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
mv cifar10_alexnet_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
mv cifar10_alexnet_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
mv /benchmarks/cifar10_alexnet_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
mv /benchmarks/cifar10_alexnet_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/
mv /benchmarks/cifar10_alexnet_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_xla_w1.json --graph_file=/benchmarks/cifar10_alexnet_sync_xla_w1.pbtxt 2> cifar10_alexnet_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_sync_xla_w2.json --graph_file=/benchmarks/cifar10_alexnet_sync_xla_w2.pbtxt 2> cifar10_alexnet_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/cifar10_alexnet_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/cifar10_alexnet_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/cifar10_alexnet_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/cifar10_alexnet_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
mv cifar10_alexnet_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
mv cifar10_alexnet_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
mv cifar10_alexnet_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
mv /benchmarks/cifar10_alexnet_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
mv /benchmarks/cifar10_alexnet_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/
mv /benchmarks/cifar10_alexnet_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch32_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_batch32_w1.pbtxt 2> cifar10_alexnet_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch32_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_batch32_w2.pbtxt 2> cifar10_alexnet_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/cifar10_alexnet_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/cifar10_alexnet_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/cifar10_alexnet_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/cifar10_alexnet_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
mv cifar10_alexnet_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
mv cifar10_alexnet_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
mv cifar10_alexnet_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
mv /benchmarks/cifar10_alexnet_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
mv /benchmarks/cifar10_alexnet_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/
mv /benchmarks/cifar10_alexnet_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch64_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_batch64_w1.pbtxt 2> cifar10_alexnet_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch64_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_batch64_w2.pbtxt 2> cifar10_alexnet_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/cifar10_alexnet_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/cifar10_alexnet_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/cifar10_alexnet_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/cifar10_alexnet_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
mv cifar10_alexnet_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
mv cifar10_alexnet_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
mv cifar10_alexnet_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
mv /benchmarks/cifar10_alexnet_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
mv /benchmarks/cifar10_alexnet_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/
mv /benchmarks/cifar10_alexnet_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch128_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_batch128_w1.pbtxt 2> cifar10_alexnet_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch128_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_batch128_w2.pbtxt 2> cifar10_alexnet_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/cifar10_alexnet_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/cifar10_alexnet_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/cifar10_alexnet_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/cifar10_alexnet_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
mv cifar10_alexnet_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
mv cifar10_alexnet_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
mv cifar10_alexnet_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
mv /benchmarks/cifar10_alexnet_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
mv /benchmarks/cifar10_alexnet_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/
mv /benchmarks/cifar10_alexnet_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch256_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_batch256_w1.pbtxt 2> cifar10_alexnet_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch256_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_batch256_w2.pbtxt 2> cifar10_alexnet_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/cifar10_alexnet_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/cifar10_alexnet_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/cifar10_alexnet_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/cifar10_alexnet_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
mv cifar10_alexnet_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
mv cifar10_alexnet_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
mv cifar10_alexnet_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
mv /benchmarks/cifar10_alexnet_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
mv /benchmarks/cifar10_alexnet_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/
mv /benchmarks/cifar10_alexnet_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch512_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_batch512_w1.pbtxt 2> cifar10_alexnet_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_batch512_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_batch512_w2.pbtxt 2> cifar10_alexnet_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/cifar10_alexnet_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/cifar10_alexnet_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/cifar10_alexnet_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/cifar10_alexnet_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
mv cifar10_alexnet_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
mv cifar10_alexnet_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
mv cifar10_alexnet_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
mv /benchmarks/cifar10_alexnet_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
mv /benchmarks/cifar10_alexnet_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/
mv /benchmarks/cifar10_alexnet_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_use_fp16_w1.pbtxt 2> cifar10_alexnet_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_use_fp16_w2.pbtxt 2> cifar10_alexnet_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/cifar10_alexnet_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/cifar10_alexnet_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/cifar10_alexnet_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/cifar10_alexnet_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
mv cifar10_alexnet_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
mv cifar10_alexnet_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
mv cifar10_alexnet_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
mv /benchmarks/cifar10_alexnet_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
mv /benchmarks/cifar10_alexnet_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/
mv /benchmarks/cifar10_alexnet_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_optMomentum_w1.pbtxt 2> cifar10_alexnet_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_optMomentum_w2.pbtxt 2> cifar10_alexnet_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/cifar10_alexnet_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/cifar10_alexnet_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/cifar10_alexnet_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/cifar10_alexnet_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
mv cifar10_alexnet_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
mv cifar10_alexnet_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
mv cifar10_alexnet_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
mv /benchmarks/cifar10_alexnet_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
mv /benchmarks/cifar10_alexnet_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/
mv /benchmarks/cifar10_alexnet_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_optRmsprop_w1.pbtxt 2> cifar10_alexnet_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_optRmsprop_w2.pbtxt 2> cifar10_alexnet_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/cifar10_alexnet_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/cifar10_alexnet_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/cifar10_alexnet_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/cifar10_alexnet_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
mv cifar10_alexnet_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
mv cifar10_alexnet_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
mv cifar10_alexnet_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
mv /benchmarks/cifar10_alexnet_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
mv /benchmarks/cifar10_alexnet_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/
mv /benchmarks/cifar10_alexnet_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_dataFormat_w1.pbtxt 2> cifar10_alexnet_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_dataFormat_w2.pbtxt 2> cifar10_alexnet_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/cifar10_alexnet_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/cifar10_alexnet_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/cifar10_alexnet_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/cifar10_alexnet_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
mv cifar10_alexnet_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
mv cifar10_alexnet_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
mv cifar10_alexnet_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
mv /benchmarks/cifar10_alexnet_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
mv /benchmarks/cifar10_alexnet_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/
mv /benchmarks/cifar10_alexnet_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_winograd_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_winograd_w1.pbtxt 2> cifar10_alexnet_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_winograd_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_winograd_w2.pbtxt 2> cifar10_alexnet_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/cifar10_alexnet_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/cifar10_alexnet_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/cifar10_alexnet_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/cifar10_alexnet_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
mv cifar10_alexnet_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
mv cifar10_alexnet_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
mv cifar10_alexnet_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
mv /benchmarks/cifar10_alexnet_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
mv /benchmarks/cifar10_alexnet_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/
mv /benchmarks/cifar10_alexnet_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=alexnet --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_alexnet_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_xla_w1.json --graph_file=/benchmarks/cifar10_alexnet_async_xla_w1.pbtxt 2> cifar10_alexnet_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=alexnet --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_alexnet_async_xla_w2.json --graph_file=/benchmarks/cifar10_alexnet_async_xla_w2.pbtxt 2> cifar10_alexnet_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/cifar10_alexnet_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/cifar10_alexnet_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/cifar10_alexnet_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/cifar10_alexnet_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_alexnet_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
mv cifar10_alexnet_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
mv cifar10_alexnet_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
mv cifar10_alexnet_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_alexnet_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
mv /benchmarks/cifar10_alexnet_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
mv /benchmarks/cifar10_alexnet_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/
mv /benchmarks/cifar10_alexnet_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_alexnet_async_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch32_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch32_w1.pbtxt 2> cifar10_vgg16_sync_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch32_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch32_w2.pbtxt 2> cifar10_vgg16_sync_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/cifar10_vgg16_sync_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/cifar10_vgg16_sync_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/cifar10_vgg16_sync_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/cifar10_vgg16_sync_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
mv cifar10_vgg16_sync_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
mv cifar10_vgg16_sync_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
mv cifar10_vgg16_sync_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
mv /benchmarks/cifar10_vgg16_sync_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
mv /benchmarks/cifar10_vgg16_sync_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/
mv /benchmarks/cifar10_vgg16_sync_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch64_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch64_w1.pbtxt 2> cifar10_vgg16_sync_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch64_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch64_w2.pbtxt 2> cifar10_vgg16_sync_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/cifar10_vgg16_sync_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/cifar10_vgg16_sync_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/cifar10_vgg16_sync_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/cifar10_vgg16_sync_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
mv cifar10_vgg16_sync_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
mv cifar10_vgg16_sync_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
mv cifar10_vgg16_sync_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
mv /benchmarks/cifar10_vgg16_sync_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
mv /benchmarks/cifar10_vgg16_sync_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/
mv /benchmarks/cifar10_vgg16_sync_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch128_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch128_w1.pbtxt 2> cifar10_vgg16_sync_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch128_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch128_w2.pbtxt 2> cifar10_vgg16_sync_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/cifar10_vgg16_sync_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/cifar10_vgg16_sync_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/cifar10_vgg16_sync_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/cifar10_vgg16_sync_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
mv cifar10_vgg16_sync_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
mv cifar10_vgg16_sync_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
mv cifar10_vgg16_sync_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
mv /benchmarks/cifar10_vgg16_sync_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
mv /benchmarks/cifar10_vgg16_sync_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/
mv /benchmarks/cifar10_vgg16_sync_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch256_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch256_w1.pbtxt 2> cifar10_vgg16_sync_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch256_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch256_w2.pbtxt 2> cifar10_vgg16_sync_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/cifar10_vgg16_sync_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/cifar10_vgg16_sync_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/cifar10_vgg16_sync_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/cifar10_vgg16_sync_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
mv cifar10_vgg16_sync_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
mv cifar10_vgg16_sync_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
mv cifar10_vgg16_sync_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
mv /benchmarks/cifar10_vgg16_sync_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
mv /benchmarks/cifar10_vgg16_sync_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/
mv /benchmarks/cifar10_vgg16_sync_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch512_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch512_w1.pbtxt 2> cifar10_vgg16_sync_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_batch512_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_batch512_w2.pbtxt 2> cifar10_vgg16_sync_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/cifar10_vgg16_sync_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/cifar10_vgg16_sync_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/cifar10_vgg16_sync_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/cifar10_vgg16_sync_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
mv cifar10_vgg16_sync_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
mv cifar10_vgg16_sync_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
mv cifar10_vgg16_sync_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
mv /benchmarks/cifar10_vgg16_sync_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
mv /benchmarks/cifar10_vgg16_sync_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/
mv /benchmarks/cifar10_vgg16_sync_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_use_fp16_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_use_fp16_w1.pbtxt 2> cifar10_vgg16_sync_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_use_fp16_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_use_fp16_w2.pbtxt 2> cifar10_vgg16_sync_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/cifar10_vgg16_sync_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/cifar10_vgg16_sync_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/cifar10_vgg16_sync_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/cifar10_vgg16_sync_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
mv cifar10_vgg16_sync_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
mv cifar10_vgg16_sync_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
mv cifar10_vgg16_sync_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
mv /benchmarks/cifar10_vgg16_sync_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
mv /benchmarks/cifar10_vgg16_sync_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/
mv /benchmarks/cifar10_vgg16_sync_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_optMomentum_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_optMomentum_w1.pbtxt 2> cifar10_vgg16_sync_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_optMomentum_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_optMomentum_w2.pbtxt 2> cifar10_vgg16_sync_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/cifar10_vgg16_sync_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/cifar10_vgg16_sync_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/cifar10_vgg16_sync_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/cifar10_vgg16_sync_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
mv cifar10_vgg16_sync_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
mv cifar10_vgg16_sync_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
mv cifar10_vgg16_sync_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
mv /benchmarks/cifar10_vgg16_sync_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
mv /benchmarks/cifar10_vgg16_sync_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/
mv /benchmarks/cifar10_vgg16_sync_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_optRmsprop_w1.pbtxt 2> cifar10_vgg16_sync_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_optRmsprop_w2.pbtxt 2> cifar10_vgg16_sync_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/cifar10_vgg16_sync_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/cifar10_vgg16_sync_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/cifar10_vgg16_sync_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/cifar10_vgg16_sync_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
mv cifar10_vgg16_sync_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
mv cifar10_vgg16_sync_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
mv cifar10_vgg16_sync_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
mv /benchmarks/cifar10_vgg16_sync_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
mv /benchmarks/cifar10_vgg16_sync_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/
mv /benchmarks/cifar10_vgg16_sync_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_dataFormat_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_dataFormat_w1.pbtxt 2> cifar10_vgg16_sync_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_dataFormat_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_dataFormat_w2.pbtxt 2> cifar10_vgg16_sync_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/cifar10_vgg16_sync_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/cifar10_vgg16_sync_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/cifar10_vgg16_sync_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/cifar10_vgg16_sync_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
mv cifar10_vgg16_sync_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
mv cifar10_vgg16_sync_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
mv cifar10_vgg16_sync_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
mv /benchmarks/cifar10_vgg16_sync_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
mv /benchmarks/cifar10_vgg16_sync_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/
mv /benchmarks/cifar10_vgg16_sync_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_winograd_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_winograd_w1.pbtxt 2> cifar10_vgg16_sync_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_winograd_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_winograd_w2.pbtxt 2> cifar10_vgg16_sync_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/cifar10_vgg16_sync_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/cifar10_vgg16_sync_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/cifar10_vgg16_sync_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/cifar10_vgg16_sync_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
mv cifar10_vgg16_sync_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
mv cifar10_vgg16_sync_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
mv cifar10_vgg16_sync_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
mv /benchmarks/cifar10_vgg16_sync_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
mv /benchmarks/cifar10_vgg16_sync_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/
mv /benchmarks/cifar10_vgg16_sync_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_sync_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_xla_w1.json --graph_file=/benchmarks/cifar10_vgg16_sync_xla_w1.pbtxt 2> cifar10_vgg16_sync_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=true --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_sync_xla_w2.json --graph_file=/benchmarks/cifar10_vgg16_sync_xla_w2.pbtxt 2> cifar10_vgg16_sync_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/cifar10_vgg16_sync_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/cifar10_vgg16_sync_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/cifar10_vgg16_sync_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/cifar10_vgg16_sync_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_sync_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
mv cifar10_vgg16_sync_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
mv cifar10_vgg16_sync_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
mv cifar10_vgg16_sync_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_sync_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
mv /benchmarks/cifar10_vgg16_sync_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
mv /benchmarks/cifar10_vgg16_sync_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/
mv /benchmarks/cifar10_vgg16_sync_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_sync_xla/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch32_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch32_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch32_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_batch32_w1.pbtxt 2> cifar10_vgg16_async_batch32_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=32 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch32_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_batch32_w2.pbtxt 2> cifar10_vgg16_async_batch32_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/cifar10_vgg16_async_batch32_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/cifar10_vgg16_async_batch32_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/cifar10_vgg16_async_batch32_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/cifar10_vgg16_async_batch32_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_batch32_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
mv cifar10_vgg16_async_batch32_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
mv cifar10_vgg16_async_batch32_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
mv cifar10_vgg16_async_batch32_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_batch32_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
mv /benchmarks/cifar10_vgg16_async_batch32_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
mv /benchmarks/cifar10_vgg16_async_batch32_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/
mv /benchmarks/cifar10_vgg16_async_batch32_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch32/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch64_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch64_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch64_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_batch64_w1.pbtxt 2> cifar10_vgg16_async_batch64_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch64_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_batch64_w2.pbtxt 2> cifar10_vgg16_async_batch64_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/cifar10_vgg16_async_batch64_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/cifar10_vgg16_async_batch64_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/cifar10_vgg16_async_batch64_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/cifar10_vgg16_async_batch64_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_batch64_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
mv cifar10_vgg16_async_batch64_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
mv cifar10_vgg16_async_batch64_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
mv cifar10_vgg16_async_batch64_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_batch64_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
mv /benchmarks/cifar10_vgg16_async_batch64_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
mv /benchmarks/cifar10_vgg16_async_batch64_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/
mv /benchmarks/cifar10_vgg16_async_batch64_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch64/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch128_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch128_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch128_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_batch128_w1.pbtxt 2> cifar10_vgg16_async_batch128_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=128 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch128_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_batch128_w2.pbtxt 2> cifar10_vgg16_async_batch128_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/cifar10_vgg16_async_batch128_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/cifar10_vgg16_async_batch128_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/cifar10_vgg16_async_batch128_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/cifar10_vgg16_async_batch128_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_batch128_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
mv cifar10_vgg16_async_batch128_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
mv cifar10_vgg16_async_batch128_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
mv cifar10_vgg16_async_batch128_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_batch128_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
mv /benchmarks/cifar10_vgg16_async_batch128_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
mv /benchmarks/cifar10_vgg16_async_batch128_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/
mv /benchmarks/cifar10_vgg16_async_batch128_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch128/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch256_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch256_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch256_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_batch256_w1.pbtxt 2> cifar10_vgg16_async_batch256_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=256 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch256_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_batch256_w2.pbtxt 2> cifar10_vgg16_async_batch256_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/cifar10_vgg16_async_batch256_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/cifar10_vgg16_async_batch256_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/cifar10_vgg16_async_batch256_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/cifar10_vgg16_async_batch256_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_batch256_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
mv cifar10_vgg16_async_batch256_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
mv cifar10_vgg16_async_batch256_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
mv cifar10_vgg16_async_batch256_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_batch256_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
mv /benchmarks/cifar10_vgg16_async_batch256_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
mv /benchmarks/cifar10_vgg16_async_batch256_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/
mv /benchmarks/cifar10_vgg16_async_batch256_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch256/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch512_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_batch512_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch512_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_batch512_w1.pbtxt 2> cifar10_vgg16_async_batch512_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=512 --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_batch512_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_batch512_w2.pbtxt 2> cifar10_vgg16_async_batch512_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/cifar10_vgg16_async_batch512_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/cifar10_vgg16_async_batch512_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/cifar10_vgg16_async_batch512_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/cifar10_vgg16_async_batch512_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_batch512_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
mv cifar10_vgg16_async_batch512_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
mv cifar10_vgg16_async_batch512_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
mv cifar10_vgg16_async_batch512_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_batch512_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
mv /benchmarks/cifar10_vgg16_async_batch512_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
mv /benchmarks/cifar10_vgg16_async_batch512_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/
mv /benchmarks/cifar10_vgg16_async_batch512_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_batch512/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_use_fp16_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_use_fp16_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_use_fp16_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_use_fp16_w1.pbtxt 2> cifar10_vgg16_async_use_fp16_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --use_fp16=true --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_use_fp16_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_use_fp16_w2.pbtxt 2> cifar10_vgg16_async_use_fp16_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/cifar10_vgg16_async_use_fp16_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/cifar10_vgg16_async_use_fp16_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/cifar10_vgg16_async_use_fp16_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/cifar10_vgg16_async_use_fp16_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_use_fp16_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
mv cifar10_vgg16_async_use_fp16_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
mv cifar10_vgg16_async_use_fp16_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
mv cifar10_vgg16_async_use_fp16_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_use_fp16_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
mv /benchmarks/cifar10_vgg16_async_use_fp16_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
mv /benchmarks/cifar10_vgg16_async_use_fp16_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/
mv /benchmarks/cifar10_vgg16_async_use_fp16_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_use_fp16/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_optMomentum_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_optMomentum_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_optMomentum_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_optMomentum_w1.pbtxt 2> cifar10_vgg16_async_optMomentum_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=momentum --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_optMomentum_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_optMomentum_w2.pbtxt 2> cifar10_vgg16_async_optMomentum_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/cifar10_vgg16_async_optMomentum_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/cifar10_vgg16_async_optMomentum_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/cifar10_vgg16_async_optMomentum_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/cifar10_vgg16_async_optMomentum_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_optMomentum_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
mv cifar10_vgg16_async_optMomentum_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
mv cifar10_vgg16_async_optMomentum_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
mv cifar10_vgg16_async_optMomentum_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_optMomentum_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
mv /benchmarks/cifar10_vgg16_async_optMomentum_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
mv /benchmarks/cifar10_vgg16_async_optMomentum_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/
mv /benchmarks/cifar10_vgg16_async_optMomentum_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optMomentum/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_optRmsprop_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_optRmsprop_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_optRmsprop_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_optRmsprop_w1.pbtxt 2> cifar10_vgg16_async_optRmsprop_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --optimizer=rmsprop --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_optRmsprop_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_optRmsprop_w2.pbtxt 2> cifar10_vgg16_async_optRmsprop_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/cifar10_vgg16_async_optRmsprop_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/cifar10_vgg16_async_optRmsprop_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/cifar10_vgg16_async_optRmsprop_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/cifar10_vgg16_async_optRmsprop_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_optRmsprop_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
mv cifar10_vgg16_async_optRmsprop_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
mv cifar10_vgg16_async_optRmsprop_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
mv cifar10_vgg16_async_optRmsprop_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_optRmsprop_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
mv /benchmarks/cifar10_vgg16_async_optRmsprop_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
mv /benchmarks/cifar10_vgg16_async_optRmsprop_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/
mv /benchmarks/cifar10_vgg16_async_optRmsprop_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_optRmsprop/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_dataFormat_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_dataFormat_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_dataFormat_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_dataFormat_w1.pbtxt 2> cifar10_vgg16_async_dataFormat_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --data_format=NCHW --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_dataFormat_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_dataFormat_w2.pbtxt 2> cifar10_vgg16_async_dataFormat_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/cifar10_vgg16_async_dataFormat_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/cifar10_vgg16_async_dataFormat_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/cifar10_vgg16_async_dataFormat_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/cifar10_vgg16_async_dataFormat_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_dataFormat_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
mv cifar10_vgg16_async_dataFormat_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
mv cifar10_vgg16_async_dataFormat_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
mv cifar10_vgg16_async_dataFormat_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_dataFormat_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
mv /benchmarks/cifar10_vgg16_async_dataFormat_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
mv /benchmarks/cifar10_vgg16_async_dataFormat_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/
mv /benchmarks/cifar10_vgg16_async_dataFormat_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_dataFormat/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_winograd_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_winograd_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_winograd_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_winograd_w1.pbtxt 2> cifar10_vgg16_async_winograd_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --winograd_nonfused=false --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_winograd_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_winograd_w2.pbtxt 2> cifar10_vgg16_async_winograd_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/cifar10_vgg16_async_winograd_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/cifar10_vgg16_async_winograd_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/cifar10_vgg16_async_winograd_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/cifar10_vgg16_async_winograd_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_winograd_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
mv cifar10_vgg16_async_winograd_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
mv cifar10_vgg16_async_winograd_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
mv cifar10_vgg16_async_winograd_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_winograd_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
mv /benchmarks/cifar10_vgg16_async_winograd_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
mv /benchmarks/cifar10_vgg16_async_winograd_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/
mv /benchmarks/cifar10_vgg16_async_winograd_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_winograd/

mkdir /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla
sleep 1s;
#------------------Start Time Stamping-------------
STARTTIME=$(date +%s%N)
#------------------Training Section-----------------
sudo docker exec bench_ps1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_xla_corelog_ps1.txt &
sudo docker exec bench_ps2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=ps --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=vgg16 --data_name=cifar10 --num_batches=10 --display_every=1  2> cifar10_vgg16_async_xla_corelog_ps2.txt &
W1STARTTIME=$(date +%s%N)
W1ENDTIME=0
sudo docker exec bench_w1 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=0 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_xla_w1.json --graph_file=/benchmarks/cifar10_vgg16_async_xla_w1.pbtxt 2> cifar10_vgg16_async_xla_corelog_w1.txt &
W2STARTTIME=$(date +%s%N)
W2ENDTIME=0
sudo docker exec bench_w2 /root/anaconda3/envs/tfbuild/bin/python3.6 /benchmarks/scripts/tf_cnn_benchmarks/tf_cnn_benchmarks.py --job_name=worker --task_index=1 --variable_update=parameter_server --ps_hosts=172.20.3.1:5300,172.20.3.2:5302 --worker_hosts=172.20.3.4:5304,172.20.3.5:5306 --batch_size=64 --xla=True --cross_replica_sync=false --model=vgg16 --data_name=cifar10  --num_batches=10 --display_every=1 --trace_file=/benchmarks/cifar10_vgg16_async_xla_w2.json --graph_file=/benchmarks/cifar10_vgg16_async_xla_w2.pbtxt 2> cifar10_vgg16_async_xla_corelog_w2.txt &
#--------------Wait for end of Training-------------
DURATION=0
while [ $DURATION -lt 300000000000 ]
do
NOW=$(date +%s%N)
DURATION=$(($NOW - $STARTTIME))
a=`ps -ef | grep "job_name=worker --task_index=0" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
b=`ps -ef | grep "job_name=worker --task_index=1" |grep -v color | grep -v grep | awk '{print $2}' | sed -n '1p'`;
if [ -z "$a" ] && [ $W1ENDTIME -eq 0 ]; then W1ENDTIME=$NOW; fi
if [ -z "$b" ] && [ $W2ENDTIME -eq 0 ]; then W2ENDTIME=$NOW; fi
if [ -z "$a" ] && [ -z "$b" ]; then ENDTIME=$NOW; break; fi
done
sleep 1s;
echo "TOTAL: $(($(($ENDTIME - $STARTTIME))/1000000))" > /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/cifar10_vgg16_async_xla_time.txt
echo "W1: $(($(($W1ENDTIME - $W1STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/cifar10_vgg16_async_xla_w1_time.txt
echo "W2: $(($(($W2ENDTIME - $W2STARTTIME))/1000000))" | sudo tee -a  /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/cifar10_vgg16_async_xla_w2_time.txt
ENDTIME=$(date +%s)
echo "$(($ENDTIME-$STARTTIME))" >/home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/cifar10_vgg16_async_xla_time.txt;
sleep 1s;
#--------------------kill python------------------
PYTHONPID=$(sudo docker exec bench_ps1 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps1 kill -9 $PYTHONPID
PYTHONPID=$(sudo docker exec bench_ps2 ps -ef | grep python | awk '{print $2}')
sudo docker exec bench_ps2 kill -9 $PYTHONPID
sleep 1s;
#------------------move core log-------------------
mv cifar10_vgg16_async_xla_corelog_ps1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
mv cifar10_vgg16_async_xla_corelog_ps2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
mv cifar10_vgg16_async_xla_corelog_w1.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
mv cifar10_vgg16_async_xla_corelog_w2.txt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
#------------------move pbtxt, json-------------------
mv /benchmarks/cifar10_vgg16_async_xla_w1.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
mv /benchmarks/cifar10_vgg16_async_xla_w2.json /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
mv /benchmarks/cifar10_vgg16_async_xla_w1.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/
mv /benchmarks/cifar10_vgg16_async_xla_w2.pbtxt /home/xsailor4/cyshin/benchmarks/results/cifar10_vgg16_async_xla/

